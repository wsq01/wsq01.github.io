<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Spring Ioc容器 |  学海无涯</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?b1b5dee3bb1719c8a439f8070118dc80";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <!-- <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script> -->
      <link href="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.css" rel="stylesheet">
      <script src="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-java/Spring/Spring IoC容器"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Spring Ioc容器
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/05/16/java/Spring/Spring%20IoC%E5%AE%B9%E5%99%A8/" class="article-date">
  <time datetime="2021-05-16T09:43:22.000Z" itemprop="datePublished">2021-05-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">6.6k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">29 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="IoC容器"><a href="#IoC容器" class="headerlink" title="IoC容器"></a>IoC容器</h1><p>IoC 容器（也叫 Spring 容器）是 Spring 的核心。Spring 通过 IoC 容器来管理对象的实例化和初始化，以及对象从创建到销毁的整个生命周期。</p>
<p>Spring 中使用的对象都由 IoC 容器管理，不需要手动使用<code>new</code>运算符创建对象。由 IoC 容器管理的对象称为<code>Spring Bean</code>，<code>Spring Bean</code>就是 Java 对象，和使用<code>new</code>运算符创建的对象没有区别。</p>
<p>Spring 通过读取 XML 或 Java 注解中的信息来获取哪些对象需要实例化。</p>
<p>Spring 提供 2 种不同类型的 IoC 容器，即<code>BeanFactory</code>和<code>ApplicationContext</code>容器。</p>
<h2 id="BeanFactory容器"><a href="#BeanFactory容器" class="headerlink" title="BeanFactory容器"></a>BeanFactory容器</h2><p><code>BeanFactory</code>由<code>org.springframework.beans.facytory.BeanFactory</code>接口定义，采用懒加载，所以容器启动比较快。</p>
<p>简单来说，<code>BeanFactory</code>就是一个管理<code>Bean</code>的工厂，它主要负责初始化各种<code>Bean</code>，并调用它们的生命周期方法。</p>
<p><code>BeanFactory</code>接口有多个实现类，最常见的是<code>org.springframework.beans.factory.xml.XmlBeanFactory</code>，它是根据 XML 配置文件中的定义装配<code>Bean</code>的。</p>
<p>使用<code>BeanFactory</code>需要创建<code>XmlBeanFactory</code>类的实例，通过<code>XmlBeanFactory</code>类的构造函数来传递<code>Resource</code>对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;applicationContext.xml&quot;</span>); </span><br><span class="line"><span class="type">BeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(resource);  </span><br></pre></td></tr></table></figure>
<h2 id="ApplicationContext容器"><a href="#ApplicationContext容器" class="headerlink" title="ApplicationContext容器"></a>ApplicationContext容器</h2><p><code>ApplicationContext</code>继承了<code>BeanFactory</code>接口，由<code>org.springframework.context.ApplicationContext</code>接口定义，对象在启动容器时加载。</p>
<p><code>ApplicationContext</code>在<code>BeanFactory</code>的基础上增加了很多企业级功能，例如 AOP、国际化、事件支持等。</p>
<p><code>ApplicationContext</code>接口有两个常用的实现类。</p>
<h3 id="1-ClassPathXmlApplicationContext"><a href="#1-ClassPathXmlApplicationContext" class="headerlink" title="1.ClassPathXmlApplicationContext"></a>1.ClassPathXmlApplicationContext</h3><p>该类从类路径<code>ClassPath</code>中寻找指定的 XML 配置文件，并完成<code>ApplicationContext</code>的实例化工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(String configLocation);</span><br></pre></td></tr></table></figure>
<p><code>configLocation</code>参数用于指定 Spring 配置文件的名称和位置，如<code>applicationContext.xml</code>。</p>
<h3 id="2-FileSystemXmlApplicationContext"><a href="#2-FileSystemXmlApplicationContext" class="headerlink" title="2. FileSystemXmlApplicationContext"></a>2. FileSystemXmlApplicationContext</h3><p>该类从指定的文件系统路径中寻找指定的 XML 配置文件，并完成<code>ApplicationContext</code>的实例化工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(String configLocation);</span><br></pre></td></tr></table></figure>
<p>它与<code>ClassPathXmlApplicationContext</code>的区别是：在读取 Spring 的配置文件时，<code>FileSystemXmlApplicationContext</code>不再从类路径中读取配置文件，而是通过参数指定配置文件的位置，它可以获取类路径之外的资源，如<code>F:/workspaces/applicationContext.xml</code>。</p>
<p>在使用 Spring 框架时，可以通过实例化其中任何一个类创建 Spring 的<code>ApplicationContext</code>容器。通常会采用通过<code>ClassPathXmlApplicationContext</code>类实例化<code>ApplicationContext</code>容器的方式。</p>
<p>需要注意的是，<code>BeanFactory</code>和<code>ApplicationContext</code>都是通过 XML 配置文件加载<code>Bean</code>的。二者的主要区别在于，如果<code>Bean</code>的某一个属性没有注入，则使用<code>BeanFacotry</code>加载后，在第一次调用<code>getBean()</code>方法时会抛出异常，而<code>ApplicationContext</code>则在初始化时自检，这样有利于检查所依赖的属性是否注入。</p>
<p>因此，在实际开发中，通常都选择使用<code>ApplicationContext</code>，而只有在系统资源较少时，才考虑使用<code>BeanFactory</code>。</p>
<h1 id="Bean定义"><a href="#Bean定义" class="headerlink" title="Bean定义"></a>Bean定义</h1><p>由 IoC 容器管理的对象称为<code>Bean</code>，<code>Bean</code>根据 Spring 配置文件中的信息创建。</p>
<p>Spring 容器可以被看作一个大工厂，而容器中的<code>Bean</code>就相当于该工厂的产品。如果希望这个大工厂能够生产和管理<code>Bean</code>，则需要告诉容器需要哪些<code>Bean</code>，以及需要以何种方式将这些<code>Bean</code>装配到一起。</p>
<p>Spring 配置文件支持两种格式，分别是<code>XML</code>文件格式和<code>Properties</code>文件格式。</p>
<ul>
<li><code>Properties</code>配置文件主要以<code>key-value</code>键值对的形式存在，只能赋值，不能进行其他操作，适用于简单的属性配置。</li>
<li><code>XML</code>配置文件是树形结构，相对于<code>Properties</code>文件来说更加灵活。<code>XML</code>配置文件结构清晰，但是内容比较繁琐，适用于大型复杂的项目。</li>
</ul>
<p>通常情况下，Spring 的配置文件使用<code>XML</code>格式，<code>XML</code>配置文件的根元素是<code>&lt;beans&gt;</code>，该元素包含了多个<code>&lt;bean&gt;</code>子元素，每一个<code>&lt;bean&gt;</code>子元素定义了一个<code>Bean</code>，并描述了该<code>Bean</code>如何被装配到容器中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用id属性定义person1，其对应的实现类为com.mengma.person1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.damain.Person1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--使用name属性定义person2，其对应的实现类为com.mengma.domain.Person2--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;Person2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.domain.Person2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;bean&gt;</code>元素常用属性：</p>
<table>
<thead>
<tr>
<th align="center">属性名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>id</code></td>
<td align="center">是一个<code>Bean</code>的唯一标识符，Spring 容器对<code>Bean</code>的配置和管理都通过该属性完成</td>
</tr>
<tr>
<td align="center"><code>name</code></td>
<td align="center">Spring 容器同样可以通过此属性对容器中的<code>Bean</code>进行配置和管理，<code>name</code>属性中可以为<code>Bean</code>指定多个名称，每个名称之间用逗号或分号隔开</td>
</tr>
<tr>
<td align="center"><code>class</code></td>
<td align="center">该属性指定了<code>Bean</code>的具体实现类，它必须是一个完整的类名，使用类的全限定名</td>
</tr>
<tr>
<td align="center"><code>scope</code></td>
<td align="center">用于设定<code>Bean</code>实例的作用域，其属性值有<code>singleton</code>（单例）、<code>prototype</code>（原型）、<code>request、session</code>和<code>global Session</code>。默认值是<code>singleton</code></td>
</tr>
<tr>
<td align="center"><code>constructor-arg</code></td>
<td align="center"><code>&lt;bean&gt;</code>元素的子元素，可以使用此元素传入构造参数进行实例化。该元素的<code>index</code>属性指定构造参数的序号（从 0 开始），<code>type</code>属性指定构造参数的类型</td>
</tr>
<tr>
<td align="center"><code>property</code></td>
<td align="center"><code>&lt;bean&gt;</code>元素的子元素，用于调用<code>Bean</code>实例中的<code>Set</code>方法完成属性赋值，从而完成依赖注入。该元素的<code>name</code>属性指定<code>Bean</code>实例中的相应属性名</td>
</tr>
<tr>
<td align="center"><code>ref</code></td>
<td align="center"><code>&lt;property&gt;</code>和<code>&lt;constructor-arg&gt;</code>等元素的子元素，该元素中的<code>bean</code>属性用于指定对<code>Bean</code>工厂中某个<code>Bean</code>实例的引用</td>
</tr>
<tr>
<td align="center"><code>value</code></td>
<td align="center"><code>&lt;property&gt;</code>和<code>&lt;constractor-arg&gt;</code>等元素的子元素，用于直接指定一个常量值</td>
</tr>
<tr>
<td align="center"><code>list</code></td>
<td align="center">用于封装<code>List</code>或数组类型的依赖注入</td>
</tr>
<tr>
<td align="center"><code>set</code></td>
<td align="center">用于封装<code>Set</code>类型属性的依赖注入</td>
</tr>
<tr>
<td align="center"><code>map</code></td>
<td align="center">用于封装<code>Map</code>类型属性的依赖注入</td>
</tr>
<tr>
<td align="center"><code>entry</code></td>
<td align="center"><code>&lt;map&gt;</code>元素的子元素，用于设置一个键值对。其<code>key</code>属性指定字符串类型的键值，<code>ref</code>或<code>value</code>子元素指定其值</td>
</tr>
<tr>
<td align="center"><code>init-method</code></td>
<td align="center">容器加载<code>Bean</code>时调用该方法</td>
</tr>
<tr>
<td align="center"><code>destroy-method</code></td>
<td align="center">容器删除<code>Bean</code>时调用该方法，该方法只在<code>scope=singleton</code>时有效</td>
</tr>
<tr>
<td align="center"><code>lazy-init</code></td>
<td align="center">懒加载，值为<code>true</code>，容器在首次请求时才会创建<code>Bean</code>实例；值为<code>false</code>，容器在启动时创建<code>Bean</code>实例。该方法只在<code>scope=singleton</code>时有效</td>
</tr>
</tbody></table>
<h1 id="Bean作用域"><a href="#Bean作用域" class="headerlink" title="Bean作用域"></a>Bean作用域</h1><p>在配置文件中，除了可以定义<code>Bean</code>的属性值和相互之间的依赖关系，还可以声明<code>Bean</code>的作用域。例如，如果每次获取<code>Bean</code>时，都需要一个<code>Bean</code>实例，那么应该将<code>Bean</code>的<code>scope</code>属性定义为<code>prototype</code>，如果 Spring 需要每次都返回一个相同的<code>Bean</code>实例，则应将<code>Bean</code>的<code>scope</code>属性定义为<code>singleton</code>。</p>
<h2 id="作用域的种类"><a href="#作用域的种类" class="headerlink" title="作用域的种类"></a>作用域的种类</h2><p>Spring 容器在初始化一个<code>Bean</code>的实例时，同时会指定该实例的作用域。Spring 支持以下 6 种作用域。</p>
<ol>
<li><code>singleton</code><br>默认值，单例模式，表示在容器中只有一个<code>Bean</code>实例，<code>Bean</code>以单例的方式存在。</li>
<li><code>prototype</code><br>原型模式，表示每次通过容器获取<code>Bean</code>时，容器都会创建一个<code>Bean</code>实例。</li>
<li><code>request</code><br>每次 HTTP 请求，容器都会创建一个<code>Bean</code>实例。该作用域只在当前 HTTP <code>Request</code>内有效。</li>
<li><code>session</code><br>同一个 HTTP <code>Session</code>共享一个<code>Bean</code>实例，不同的<code>Session</code>使用不同的<code>Bean</code>实例。该作用域仅在当前 HTTP <code>Session</code>内有效。</li>
<li><code>application</code><br>同一个 Web 应用共享一个<code>Bean</code>实例，该作用域在当前<code>ServletContext</code>内有效。<br>类似于<code>singleton</code>，不同的是，<code>singleton</code>表示每个 IoC 容器中仅有一个<code>Bean</code>实例，而同一个 Web 应用中可能会有多个 IoC 容器，但一个 Web 应用只会有一个<code>ServletContext</code>，也可以说<code>application</code>才是 Web 应用中货真价实的单例模式。</li>
<li><code>websocket</code><br><code>websocket</code>的作用域是<code>WebSocket</code>，即在整个<code>WebSocket</code>中有效。</li>
</ol>
<p><code>request、session、application、websocket</code>作用域只能在 Web 环境下使用，如果使用<code>ClassPathXmlApplicationContext</code>加载这些作用域中的任意一个的<code>Bean</code>，就会抛出以下异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: No Scope registered for scope name &#x27;xxx&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="singleton"><a href="#singleton" class="headerlink" title="singleton"></a>singleton</h2><p><code>singleton</code>是 Spring 容器默认的作用域，当<code>Bean</code>的作用域为<code>singleton</code>时，Spring 容器中只会存在一个共享的<code>Bean</code>实例，该<code>Bean</code>实例将存储在高速缓存中，并且所有对<code>Bean</code>的请求，只要<code>id</code>与该<code>Bean</code>定义相匹配，都会返回该缓存对象。</p>
<p>通常情况下，这种单例模式对于无会话状态的<code>Bean</code>（如 DAO 层、Service 层）来说，是最理想的选择。</p>
<p>在 Spring 配置文件中，可以使用<code>&lt;bean&gt;</code>元素的<code>scope</code>属性，将<code>Bean</code>的作用域定义成<code>singleton</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h2><p>使用<code>prototype</code>作用域的<code>Bean</code>会在每次请求该<code>Bean</code>时都会创建一个新的<code>Bean</code>实例。<code>prototype</code>作用域适用于需要保持会话状态的 <code>Bean</code>。</p>
<p>在 Spring 配置文件中，可以使用<code>&lt;bean&gt;</code>元素的<code>scope</code>属性，将<code>Bean</code>的作用域定义成<code>prototype</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="Bean生命周期"><a href="#Bean生命周期" class="headerlink" title="Bean生命周期"></a>Bean生命周期</h1><p>Spring 根据<code>Bean</code>的作用域来选择管理方式。对于<code>singleton</code>作用域的<code>Bean</code>，Spring 能够精确地知道该<code>Bean</code>何时被创建，何时初始化完成，以及何时被销毁；而对于<code>prototype</code>作用域的<code>Bean</code>，Spring 只负责创建，当容器创建了<code>Bean</code>的实例后，<code>Bean</code>的实例就交给客户端代码管理，Spring 容器将不再跟踪其生命周期。</p>
<h2 id="Bean生命周期执行流程"><a href="#Bean生命周期执行流程" class="headerlink" title="Bean生命周期执行流程"></a>Bean生命周期执行流程</h2><p>Spring 容器在确保一个<code>Bean</code>能够使用之前，会进行很多工作。<code>Bean</code>的生命周期流程：</p>
<img src="/2021/05/16/java/Spring/Spring%20IoC%E5%AE%B9%E5%99%A8/1.png" class="" title="Bean 的生命周期">

<p><code>Bean</code>生命周期的整个执行过程描述如下：</p>
<ol>
<li>Spring 启动，查找并加载需要被 Spring 管理的<code>Bean</code>，并实例化<code>Bean</code>。</li>
<li>利用依赖注入完成<code>Bean</code>中所有属性值的配置注入。</li>
<li>如果<code>Bean</code>实现了<code>BeanNameAware</code>接口，则 Spring 调用<code>Bean</code>的<code>setBeanName()</code>方法传入当前<code>Bean</code>的<code>id</code>值。</li>
<li>如果<code>Bean</code>实现了<code>BeanFactoryAware</code>接口，则 Spring 调用<code>setBeanFactory()</code>方法传入当前工厂实例的引用。</li>
<li>如果<code>Bean</code>实现了<code>ApplicationContextAware</code>接口，则 Spring 调用<code>setApplicationContext()</code>方法传入当前<code>ApplicationContext</code>实例的引用。</li>
<li>如果<code>Bean</code>实现了<code>BeanPostProcessor</code>接口，则 Spring 将调用该接口的预初始化方法<code>postProcessBeforeInitialzation()</code>对<code>Bean</code>进行加工操作，此处非常重要，Spring 的 AOP 就是利用它实现的。</li>
<li>如果<code>Bean</code>实现了<code>InitializingBean</code>接口，则 Spring 将调用<code>afterPropertiesSet()</code>方法。</li>
<li>如果在配置文件中通过<code>init-method</code>属性指定了初始化方法，则调用该初始化方法。</li>
<li>如果<code>BeanPostProcessor</code>和<code>Bean</code>关联，则 Spring 将调用该接口的初始化方法<code>postProcessAfterInitialization()</code>。此时，<code>Bean</code>已经可以被应用系统使用了。</li>
<li>如果在<code>&lt;bean&gt;</code>中指定了该<code>Bean</code>的作用范围为<code>scope=&quot;singleton&quot;</code>，则将该<code>Bean</code>放入 Spring IoC 的缓存池中，将触发 Spring 对该<code>Bean</code>的生命周期管理；如果在<code>&lt;bean&gt;</code>中指定了该<code>Bean</code>的作用范围为<code>scope=&quot;prototype&quot;</code>，则将该<code>Bean</code>交给调用者，调用者管理该<code>Bean</code>的生命周期，Spring 不再管理该<code>Bean</code>。</li>
<li>如果<code>Bean</code>实现了<code>DisposableBean</code>接口，则 Spring 会调用<code>destory()</code>方法将 Spring 中的<code>Bean</code>销毁；如果在配置文件中通过<code>destory-method</code>属性指定了<code>Bean</code>的销毁方法，则 Spring 将调用该方法对<code>Bean</code>进行销毁。</li>
</ol>
<p>Spring 为<code>Bean</code>提供了细致全面的生命周期过程，通过实现特定的接口或<code>&lt;bean&gt;</code>的属性设置，都可以对<code>Bean</code>的生命周期过程产生影响。</p>
<p>了解 Spring 生命周期的意义就在于，可以利用<code>Bean</code>在其存活期间的指定时刻完成一些相关操作。一般情况下，会在<code>Bean</code>被初始化后和被销毁前执行一些相关操作。</p>
<p>Spring 提供了 3 种方法实现初始化回调和销毁回调：</p>
<ul>
<li>实现<code>InitializingBean</code>和<code>DisposableBean</code>接口；</li>
<li>在 XML 中配置<code>init-method</code>和<code>destory-method</code>；</li>
<li>使用<code>@PostConstruct</code>和<code>@PreDestory</code>注解。</li>
</ul>
<p>在一个<code>Bean</code>中有多种生命周期回调方法时，优先级为：注解 &gt; 接口 &gt; XML。不建议使用接口和注解，这会让<code>pojo</code>类和 Spring 框架紧耦合。</p>
<h2 id="初始化回调"><a href="#初始化回调" class="headerlink" title="初始化回调"></a>初始化回调</h2><h3 id="1-使用接口"><a href="#1-使用接口" class="headerlink" title="1. 使用接口"></a>1. 使用接口</h3><p><code>org.springframework.beans.factory.InitializingBean</code>接口提供了以下方法：<code>void afterPropertiesSet() throws Exception;</code>。</p>
<p>可以实现以上接口，在<code>afterPropertiesSet</code>方法内指定<code>Bean</code>初始化后需要执行的操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用接口：InitializingBean，方法：afterPropertiesSet，无参数&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-配置XML"><a href="#2-配置XML" class="headerlink" title="2. 配置XML"></a>2. 配置XML</h3><p>可以通过<code>init-method</code>属性指定<code>Bean</code>初始化后执行的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> init-method=<span class="string">&quot;init&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用init-method指定的初始化方法:init&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-使用注解"><a href="#3-使用注解" class="headerlink" title="3. 使用注解"></a>3. 使用注解</h3><p>使用<code>@PostConstruct</code>注解标明该方法为<code>Bean</code>初始化后的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;@PostConstruct注解指定的初始化方法:init&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="销毁回调"><a href="#销毁回调" class="headerlink" title="销毁回调"></a>销毁回调</h2><h3 id="1-使用接口-1"><a href="#1-使用接口-1" class="headerlink" title="1. 使用接口"></a>1. 使用接口</h3><p><code>org.springframework.beans.factory.DisposableBean</code>接口提供了以下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>
<p>您可以实现以上接口，在<code>destroy</code>方法内指定<code>Bean</code>初始化后需要执行的操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> /&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用接口：DisposableBean，方法：destroy，无参数&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-配置XML-1"><a href="#2-配置XML-1" class="headerlink" title="2. 配置XML"></a>2. 配置XML</h3><p>可以通过<code>destroy-method</code>属性指定<code>Bean</code>销毁后执行的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> destroy-method=<span class="string">&quot;destroy&quot;</span>/&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用destroy-method指定的销毁方法:destroy&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-使用注解-1"><a href="#3-使用注解-1" class="headerlink" title="3. 使用注解"></a>3. 使用注解</h3><p>使用<code>@PreDestory</code>注解标明该方法为 Bean 销毁前执行的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line">  <span class="meta">@PreDestory</span> </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;@PreDestory注解指定的初始化方法:destroy&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="默认的初始化和销毁方法"><a href="#默认的初始化和销毁方法" class="headerlink" title="默认的初始化和销毁方法"></a>默认的初始化和销毁方法</h2><p>如果多个<code>Bean</code>需要使用相同的初始化或者销毁方法，不用为每个<code>bean</code>声明初始化和销毁方法，可以使用<code>default-init-method</code>和<code>default-destroy-method</code>属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default-init-method</span>=<span class="string">&quot;init&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default-destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="后置处理器BeanPostProcessor"><a href="#后置处理器BeanPostProcessor" class="headerlink" title="后置处理器BeanPostProcessor"></a>后置处理器BeanPostProcessor</h1><p><code>BeanPostProcessor</code>接口也被称为后置处理器，通过该接口可以自定义调用初始化前后执行的操作方法。</p>
<p><code>BeanPostProcessor</code>接口源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">  Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">  Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>postProcessBeforeInitialization</code>在<code>Bean</code>实例化、依赖注入后，初始化前调用。<code>postProcessAfterInitialization</code>在<code>Bean</code>实例化、依赖注入、初始化都完成后调用。</p>
<p>当需要添加多个后置处理器实现类时，默认情况下 Spring 容器会根据后置处理器的定义顺序来依次调用。也可以通过实现<code>Ordered</code>接口的<code>getOrder</code>方法指定后置处理器的执行顺序。该方法返回值为整数，默认值为 0，值越大优先级越低。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String message;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message = message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Message : &quot;</span> + message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Bean正在初始化&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Bean将要被销毁&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitHelloWorld</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, Ordered &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;A Before : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;A After : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitHelloWorld2</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, Ordered &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B Before : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B After : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloWorld&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World！&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注册处理器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.InitHelloWorld&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.InitHelloWorld2&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.AbstractApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AbstractApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;Beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">HelloWorld</span> <span class="variable">obj</span> <span class="operator">=</span> (HelloWorld) context.getBean(<span class="string">&quot;helloWorld&quot;</span>);</span><br><span class="line">    obj.getMessage();</span><br><span class="line">    context.registerShutdownHook();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">B Before : helloWorld</span><br><span class="line">A Before : helloWorld</span><br><span class="line">Bean正在初始化</span><br><span class="line">B After : helloWorld</span><br><span class="line">A After : helloWorld</span><br><span class="line">Message : Hello World！</span><br><span class="line">Bean将要被销毁</span><br></pre></td></tr></table></figure>
<p>由运行结果可以看出，<code>postProcessBeforeInitialization</code>方法是在<code>Bean</code>实例化和依赖注入后，自定义初始化方法前执行的。而<code>postProcessAfterInitialization</code>方法是在自定义初始化方法后执行的。由于<code>getOrder</code>方法返回值越大，优先级越低，所以<code>InitHelloWorld2</code>先执行。</p>
<h1 id="Bean继承"><a href="#Bean继承" class="headerlink" title="Bean继承"></a>Bean继承</h1><p><code>Bean</code>定义可以包含很多配置信息，包括构造函数参数、属性值和容器的一些具体信息，如初始化方法、销毁方法等。子<code>Bean</code>可以继承父<code>Bean</code>的配置数据，根据需要，子<code>Bean</code>可以重写值或添加其它值。</p>
<p>需要注意的是，<code>Spring Bean</code>定义的继承与 Java 中的继承无关。您可以将父<code>Bean</code>的定义作为一个模板，其它子<code>Bean</code>从父<code>Bean</code>中继承所需的配置。</p>
<p>在配置文件中通过<code>parent</code>属性来指定继承的父<code>Bean</code>。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String message1;</span><br><span class="line">  <span class="keyword">private</span> String message2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage1</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message1 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage2</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message2 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;World Message1 : &quot;</span> + message1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;World Message2 : &quot;</span> + message2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloChina</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String message1;</span><br><span class="line">  <span class="keyword">private</span> String message2;</span><br><span class="line">  <span class="keyword">private</span> String message3;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage1</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message1 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage2</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message2 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage3</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message3 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;China Message1 : &quot;</span> + message1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;China Message2 : &quot;</span> + message2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage3</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;China Message3 : &quot;</span> + message3);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在配置文件中，分别为<code>HelloWorld</code>中的<code>message1</code>和<code>message2</code>赋值。使用<code>parent</code>属性将<code>HelloChain</code>定义为<code>HelloWorld</code>的子类，并为<code>HelloChain</code>中的<code>message1</code>和<code>message3</code>赋值。<code>Beans.xml</code>文件代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloWorld&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World！&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World2！&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloChina&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloChina&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;helloWorld&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China！&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China3！&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;Beans.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">HelloWorld</span> <span class="variable">objA</span> <span class="operator">=</span> (HelloWorld) context.getBean(<span class="string">&quot;helloWorld&quot;</span>);</span><br><span class="line">    objA.getMessage1();</span><br><span class="line">    objA.getMessage2();</span><br><span class="line"></span><br><span class="line">    <span class="type">HelloChina</span> <span class="variable">objB</span> <span class="operator">=</span> (HelloChina) context.getBean(<span class="string">&quot;helloChina&quot;</span>);</span><br><span class="line">    objB.getMessage1();</span><br><span class="line">    objB.getMessage2();</span><br><span class="line">    objB.getMessage3();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果如下。</span></span><br><span class="line"><span class="comment">//World Message1 : Hello World！</span></span><br><span class="line"><span class="comment">//World Message2 : Hello World2！</span></span><br><span class="line"><span class="comment">//China Message1 : Hello China！</span></span><br><span class="line"><span class="comment">//China Message2 : Hello World2！</span></span><br><span class="line"><span class="comment">//China Message3 : Hello China3！</span></span><br></pre></td></tr></table></figure>
<p>由结果可以看出，我们在创建<code>helloChina</code>时并没有给<code>message2</code>赋值，但是由于<code>Bean</code>的继承，将值传递给了<code>message2</code>。</p>
<h2 id="Bean定义模板"><a href="#Bean定义模板" class="headerlink" title="Bean定义模板"></a>Bean定义模板</h2><p>您可以创建一个<code>Bean</code>定义模板，该模板只能被继承，不能被实例化。创建<code>Bean</code>定义模板时，不用指定<code>class</code>属性，而是指定<code>abstarct=&quot;true&quot;</code>将该<code>Bean</code>定义为抽象<code>Bean</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanTeamplate&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World!&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World2!&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World3!&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloChina&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloChina&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;beanTeamplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China!&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China!&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="Spring实例化Bean"><a href="#Spring实例化Bean" class="headerlink" title="Spring实例化Bean"></a>Spring实例化Bean</h1><p>在 Spring 中，实例化<code>Bean</code>有三种方式，分别是构造器实例化、静态工厂方式实例化和实例工厂方式实例化。</p>
<h2 id="构造器实例化"><a href="#构造器实例化" class="headerlink" title="构造器实例化"></a>构造器实例化</h2><p>构造器实例化是指 Spring 容器通过<code>Bean</code>对应的类中默认的构造函数实例化<code>Bean</code>。</p>
<p>在项目的<code>src</code>目录下创建一个名为<code>com.mengma.instance.constructor</code>的包，在该包下创建一个实体类<code>Person1</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.constructor;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person1</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>com.mengma.instance.constructor</code>包下创建 Spring 的配置文件<code>applicationContext.xml</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.instance.constructor.Person1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上述配置中，定义了一个<code>id</code>为<code>person1</code>的<code>Bean</code>，其中<code>class</code>属性指定了其对应的类为<code>Person1</code>。</p>
<p>在<code>com.mengma.instance.constructor</code>包下创建一个名为<code>InstanceTest1</code>的测试类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.constructor;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceTest1</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义Spring配置文件的路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="string">&quot;com/mengma/instance/constructor/ApplicationContext.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化Spring容器，加载配置文件，并对bean进行实例化</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(xmlPath);</span><br><span class="line">    <span class="comment">// 通过容器获取id为person1的实例</span></span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">&quot;person1&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述文件中，首先在<code>test()</code>方法中定义了 Spring 配置文件的路径，然后 Spring 容器会加载配置文件。在加载的同时，Spring 容器会通过实现类<code>Person1</code>中默认的无参构造函数对<code>Bean</code>进行实例化。</p>
<h2 id="静态工厂方式实例化"><a href="#静态工厂方式实例化" class="headerlink" title="静态工厂方式实例化"></a>静态工厂方式实例化</h2><p>也可以使用静态工厂的方式实例化<code>Bean</code>。此种方式需要提供一个静态工厂方法创建<code>Bean</code>的实例。</p>
<h3 id="1-创建实体类"><a href="#1-创建实体类" class="headerlink" title="1. 创建实体类"></a>1. 创建实体类</h3><p>在项目的<code>src</code>目录下创建一个名为<code>com.mengma.instance.static_factory </code>的包，并在该包下创建一个实体类<code>Person2</code>。</p>
<h3 id="2-创建静态工厂类"><a href="#2-创建静态工厂类" class="headerlink" title="2. 创建静态工厂类"></a>2. 创建静态工厂类</h3><p>在<code>com.mengma.instance.static_factory</code>包下创建一个名为<code>MyBeanFactory</code>的类，并在该类中创建一个名为<code>createBean()</code>的静态方法，用于创建<code>Bean</code>的实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.static_factory;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line">  <span class="comment">// 创建Bean实例的静态工厂方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Person2 <span class="title function_">createBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person2</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-创建-Spring-配置文件"><a href="#3-创建-Spring-配置文件" class="headerlink" title="3. 创建 Spring 配置文件"></a>3. 创建 Spring 配置文件</h3><p>在<code>com.mengma.instance.static_factory</code>包下创建 Spring 的配置文件<code>applicationContext.xml</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.instance.static_factory.MyBeanFactory&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">factory-method</span>=<span class="string">&quot;createBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码中，定义了一个<code>id</code>为<code>person2</code>的<code>Bean</code>，其中<code>class</code>属性指定了其对应的工厂实现类为<code>MyBeanFactory</code>，而<code>factory-method</code>属性用于告诉 Spring 容器调用工厂类中的<code>createBean()</code>方法获取<code>Bean</code>的实例。</p>
<h3 id="4-创建测试类"><a href="#4-创建测试类" class="headerlink" title="4. 创建测试类"></a>4. 创建测试类</h3><p>在<code>com.mengma.instance.static_factory</code>包下创建一个名为<code>InstanceTest2</code>的测试类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.static_factory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceTest2</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义Spring配置文件的路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="string">&quot;com/mengma/instance/static_factory/applicationContext.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化Spring容器，加载配置文件，并对bean进行实例化</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(xmlPath);</span><br><span class="line">    <span class="comment">// 通过容器获取id为person2实例</span></span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">&quot;person2&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实例工厂方式实例化"><a href="#实例工厂方式实例化" class="headerlink" title="实例工厂方式实例化"></a>实例工厂方式实例化</h2><p>还有一种实例化<code>Bean</code>的方式就是采用实例工厂。在这种方式中，工厂类不再使用静态方法创建<code>Bean</code>的实例，而是直接在成员方法中创建<code>Bean</code>的实例。</p>
<p>同时，在配置文件中，需要实例化的<code>Bean</code>也不是通过<code>class</code>属性直接指向其实例化的类，而是通过<code>factory-bean</code>属性配置一个实例工厂，然后使用<code>factory-method</code>属性确定使用工厂中的哪个方法。</p>
<h3 id="1-创建实体类-1"><a href="#1-创建实体类-1" class="headerlink" title="1. 创建实体类"></a>1. 创建实体类</h3><p>在<code>src</code>目录下创建一个名为<code>com.mengma.instance.factory</code>的包，在该包下创建一个<code>Person3</code>类。</p>
<h3 id="2-创建实例工厂类"><a href="#2-创建实例工厂类" class="headerlink" title="2. 创建实例工厂类"></a>2. 创建实例工厂类</h3><p>在<code>com.mengma.instance.factory</code>包下创建一个名为<code>MyBeanFactory</code>的类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.factory;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MyBeanFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;person3工厂实例化中&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 创建Bean的方法</span></span><br><span class="line">  <span class="keyword">public</span> Person3 <span class="title function_">createBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person3</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码中，使用默认无参的构造方法输出<code>person3</code>工厂实例化中语句，使用<code>createBean</code>成员方法创建<code>Bean</code>的实例。</p>
<h3 id="3-创建-Spring-配置文件-1"><a href="#3-创建-Spring-配置文件-1" class="headerlink" title="3. 创建 Spring 配置文件"></a>3. 创建 Spring 配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置实例工厂 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.instance.factory.MyBeanFactory&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- factory-bean属性指定一个实例工厂，factory-method属性确定使用工厂中的哪个方法 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person3&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;createBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码中，首先配置了一个实例工厂<code>Bean</code>，然后配置了需要实例化的<code>Bean</code>。在<code>id</code>为<code>person3</code>的<code>Bean</code>中，使用<code>factory-bean</code>属性指定一个实例工厂，该属性值就是实例工厂的<code>id</code>属性值。使用<code>factory-method</code>属性确定使用工厂中的<code>createBean()</code>方法。</p>
<h3 id="4-创建测试类-1"><a href="#4-创建测试类-1" class="headerlink" title="4. 创建测试类"></a>4. 创建测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.factory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceTest3</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义Spring配置文件的路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="string">&quot;com/mengma/instance/factory/applicationContext.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化Spring容器，加载配置文件，并对bean进行实例化</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(xmlPath);</span><br><span class="line">    <span class="comment">// 通过容器获取id为person3实例</span></span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">&quot;person3&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2021/05/16/java/Spring/Spring%20IoC%E5%AE%B9%E5%99%A8/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            MySQL 执行流程
          
        </div>
      </a>
    
    
      <a href="/2021/05/15/java/Spring/Spring%20%E5%85%A5%E9%97%A8/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Spring 入门</div>
      </a>
    
  </nav>

  
   
  
    
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2017-2023
        <i class="ri-heart-fill heart_icon"></i> WSQ
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="学海无涯"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>