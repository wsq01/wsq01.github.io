<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 学海无涯</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?b1b5dee3bb1719c8a439f8070118dc80";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <!-- <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script> -->
      <link href="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.css" rel="stylesheet">
      <script src="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-计算机网络/OSPF实战"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/" class="article-date">
  <time datetime="2023-05-11T09:24:30.447Z" itemprop="datePublished">2023-05-11</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">3.9k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">17 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="OSPF-基础命令"><a href="#OSPF-基础命令" class="headerlink" title="OSPF 基础命令"></a>OSPF 基础命令</h1><p>掌握三条命令，就能玩转 OSPF：</p>
<ul>
<li>创建 OSPF 进程，进入配置视图</li>
<li>创建 OSPF 区域</li>
<li>接口激活 OSPF</li>
</ul>
<h2 id="创建-OSPF-进程"><a href="#创建-OSPF-进程" class="headerlink" title="创建 OSPF 进程"></a>创建 OSPF 进程</h2><p>在系统视图下，使用 OSPF 命令，创建 OSPF 进程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Router]ospf 1 Router-id 1.1.1.1</span><br></pre></td></tr></table></figure>
<p>上面的命令，是在<code>Router</code>上创建<code>Process-ID</code>为 1 的 OSPF 进程，并进入配置视图。使用的<code>Router-ID</code>是<code>1.1.1.1</code>。</p>
<p><code>Process-ID</code>是可选参数，表示 OSPF 进程的编号，只在设备本身生效，也就是说，两台设备建立 OSPF 邻居时，不要求双方的<code>Process-ID</code>一样。如果不指定<code>Process-ID</code>，会分配一个默认值作为<code>Process-ID</code>。</p>
<p><code>router-id</code>也是可选参数，用来指定设备的<code>Router-ID</code>。通常，手动配置<code>Router-ID</code>，不会使用默认值。</p>
<h2 id="创建-OSPF-区域"><a href="#创建-OSPF-区域" class="headerlink" title="创建 OSPF 区域"></a>创建 OSPF 区域</h2><p>创建完 OSPF 进程后，就需要创建 OSPF 区域。在配置视图下，使用<code>area</code>命令创建区域，并指定区域 ID。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Router]ospf 1 Router-id 1.1.1.1</span><br><span class="line">[Router-ospf-1]area 1</span><br></pre></td></tr></table></figure>
<p>在 OSPF 进程 1 中，创建<code>Area1</code>。</p>
<h2 id="接口激活-OSPF"><a href="#接口激活-OSPF" class="headerlink" title="接口激活 OSPF"></a>接口激活 OSPF</h2><p>默认状态下，所有接口都没有激活 OSPF，要在接口激活 OSPF，有两种方法：</p>
<h3 id="在区域视图激活-OSPF"><a href="#在区域视图激活-OSPF" class="headerlink" title="在区域视图激活 OSPF"></a>在区域视图激活 OSPF</h3><p>在区域视图下，使用<code>network</code>命令，再加上 IP 地址和通配符掩码，满足条件的接口激活 OSPF。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Router]ospf 1 Router-id 1.1.1.1</span><br><span class="line">[Router-ospf-1]area 0</span><br><span class="line">[Router-ospf-1-area-0.0.0.0]network 192.168.1.0 0.0.0.255</span><br></pre></td></tr></table></figure>
<p>举个栗子：<code>network 192.168.1.0 0.0.0.255</code>，IP 地址是<code>192.168.1.0</code>，通配符掩码是<code>0.0.0.255</code>。通配符掩码中，比特位为 0 的需要匹配，比特位为 1 的不需要匹配。命令中匹配的 IP 地址是<code>192.168.1.0</code>至<code>192.168.1.255</code>。</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/1.png" class="">

<p>计算方法是，把<code>192.168.1.0</code>用二进制表示，把通配符掩码<code>0.0.0.255</code>也换算成二进制，每个比特位对应。前 24 位全为 0，后 8 位全为 1。匹配的 IP 地址，以<code>192.168.1</code>开头，后面是 0 至 255 的任意值。接口 IP 地址在这个范围内，且 IP 地址掩码长度大于或等于<code>network</code>命令的 0 比特位数，就在接口上激活 OSPF。</p>
<p>有两个特殊的<code>network</code>命令，一个是<code>network x.x.x.x 0.0.0.0</code>，比如<code>network 192.168.1.1 0.0.0.0</code>，IP 地址是<code>192.168.1.1</code>的接口激活 OSPF，无论网络掩码长度多少。另一个是<code>network 0.0.0.0 255.255.255.255</code>，匹配任意 IP 地址，所有配置了 IP 地址的接口，都会激活 OSPF。</p>
<h3 id="在指定接口激活-OSPF"><a href="#在指定接口激活-OSPF" class="headerlink" title="在指定接口激活 OSPF"></a>在指定接口激活 OSPF</h3><p>上面的方法，可以使用一条命令，在多个接口激活 OSPF。另一个方法就是在指定接口激活 OSPF。先创建 OSPF 进程和区域，然后进入接口视图，使用<code>ospf enable</code>命令激活。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Router]ospf 1 Router-<span class="built_in">id</span> 1.1.1.1 <span class="comment">#创建OSPF进程</span></span><br><span class="line">[Router-ospf-1]area 0 <span class="comment">#创建Area0</span></span><br><span class="line">[Router-ospf-1-area-0.0.0.0]quit</span><br><span class="line">[Router-ospf-1]quit</span><br><span class="line">[Router]interface GigabitEthernet 0/0 <span class="comment">#进入GE0/0接口视图</span></span><br><span class="line">[Router-GigabitEthernet0/0]ospf <span class="built_in">enable</span> 1 area 0 <span class="comment">#激活OSPF</span></span><br></pre></td></tr></table></figure>
<h1 id="OSPF-单区域实验"><a href="#OSPF-单区域实验" class="headerlink" title="OSPF 单区域实验"></a>OSPF 单区域实验</h1><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/2.png" class="">

<p>路由器 RT1 的两个接口分别连接<code>172.16.1.0/24</code>和<code>172.16.2.0/24</code>网段，另一个接口连接路由器 RT2。RT2 创建 Loopback 接口，配置 IP 地址<code>172.16.255.2/24</code>，模拟 RT2 的直连网段。在 RT1 和 RT2 上运行 OSPF，让 PC 可以访问全部网段。</p>
<p>RT1 配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[RT1]ospf 1 router-id 1.1.1.1</span><br><span class="line">[RT1-ospf-1]area 0</span><br><span class="line">[RT1-ospf-1-area-0.0.0.0]network 172.16.1.0 0.0.0.255</span><br><span class="line">[RT1-ospf-1-area-0.0.0.0]network172.16.2.0 0.0.0.255</span><br><span class="line">[RT1-ospf-1-area-0.0.0.0]network 172.16.12.0 0.0.0.3</span><br></pre></td></tr></table></figure>
<p>RT2 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[RT2]ospf 1 router-id 2.2.2.2</span><br><span class="line">[RT2-ospf-1]area 0</span><br><span class="line">[RT2-ospf-1-area-0.0.0.0]network 172.16.12.0 0.0.0.3</span><br><span class="line">[RT2-ospf-1-area-0.0.0.]network 172.16.255.0 0.0.0.255</span><br></pre></td></tr></table></figure>
<p>配置完成后，RT1 和 RT2 建立邻接关系，交换 LSA。查看 RT1 的邻居表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/3.png" class="">

<p>邻接表中，RT1 在<code>Area0</code>发现邻居，<code>Router-ID</code>是<code>2.2.2.2</code>，接口 IP 地址是<code>172.16.12.2</code>，邻居状态是<code>Full</code>，对端是<code>Master</code>。</p>
<p>再看 RT1 的 OSPF 路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/4.png" class="">

<p>命令<code>display ospf routing</code>，是查看 OSPF 路由表，并不是路由器的全局路由器。这些 OSPF 路由表能否加载到全局路由表，还要看路由表优先级等因素。这里发现 R2 的 Loopback0 接口路由，是一条主机路由，实际上，Loopback0 接口的掩码长度是 24，而不是 32。这是因为 OSPF 把 Loopback 接口作为末梢网络，无论实际掩码是多少，Type-1 LSA 中，都以<code>255.255.255.255</code>进行通告。</p>
<p>查看 RT2 的 Type-1 LSA ：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/5.png" class="">

<p>如果希望 RT2 的 Type-1 LSA 描述 Loopback 接口的实际掩码信息，可以把接口的网络类型改成 Broadcast 或 NBMA，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[RT2]interface LoopBack 0</span><br><span class="line">[RT2-LoopBack0]ospf network-type broadcast</span><br></pre></td></tr></table></figure>
<p>再看 RT2 的 Type-1 LSA：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/6.png" class="">

<p>RT2 以实际掩码信息通告<code>Loopback0</code>接口。现在看下 RT1 的路由表中 OSPF 路由：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/7.png" class="">

<p>RT1 把<code>172.16.255.0/24</code>网段加载到路由表。同时，RT2 也获得到达<code>172.16.1.0/24</code>和<code>172.16.2.0/24</code>的路由。这样 PC 就能访问网络中的各个网段。</p>
<h1 id="Silent-Interface"><a href="#Silent-Interface" class="headerlink" title="Silent-Interface"></a>Silent-Interface</h1><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/8.png" class="">

<p>上个实验的拓扑图中，RT1 的<code>GE0/0/0</code>和<code>GE0/0/1</code>接口连接终端网段，只有终端 PC，没有 OSPF 路由器。然而，接口已经激活了 OSPF，会周期性的发送<code>Hello</code>报文，但是 PC 无法识别、也不需要识别<code>Hello</code>报文。这时，可以把 RT1 的<code>GE0/0/0</code>和<code>GE0/0/1</code>配置成静默接口（<code>Silent-Interface</code>），接口就会禁止收发<code>Hello</code>报文。</p>
<p>R1 的配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[RT1]ospf 1</span><br><span class="line">[RT1-ospf-1]silent-interface GigabitEthernet 0/0/0</span><br><span class="line">[RT1-ospf-1]silent-interface GigabitEthernet 0/0/1</span><br></pre></td></tr></table></figure>
<p>虽然两个接口指定为<code>Silent-Interface</code>，但是已经使用 network 命令激活 OSPF，因此 RT2 还是能通过 OSPF 学习到这两个接口网段的路由。</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/9.png" class="">

<h1 id="OSPF-多区域实验"><a href="#OSPF-多区域实验" class="headerlink" title="OSPF 多区域实验"></a>OSPF 多区域实验</h1><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/10.png" class="">

<p>RT1 和 RT2 是两台汇聚交换机，各自下挂两个终端网段，同时上连核心交换机 RT3 。在三台路由器上部署 OSPF ，使用多区域 OSPF 的设计，实现全网各个网段的数据互通。</p>
<p>RT1 的配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[RT1]ospf 1 router-id 1.1.1.1</span><br><span class="line">[RT1-ospf-1]area 1</span><br><span class="line">[RT1-ospf-1-area-0.0.0.1]network 172.16.1.0 0.0.0.255</span><br><span class="line">[RT1-ospf-1-area-0.0.0.1]network 172.16.2.0 0.0.0.255</span><br><span class="line">[RT1-ospf-area-0.0.0.1]quit</span><br><span class="line">[RT1-ospf-1]area 0</span><br><span class="line">[RT1-ospf-1-area-0.0.0.o]network 172.16.0.0 0.0.0.3</span><br></pre></td></tr></table></figure>
<p>RT2 的配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[RT2]ospf 1 router-id 2.2.2.2</span><br><span class="line">[RT2-ospf-1]area 2</span><br><span class="line">[RT2-ospf-1-area-0.0.0.2]network 172.16.9.0 0.0.0.255</span><br><span class="line">[RT2-ospf-1-area-0.0.0.2]network 172.16.10.0 0.0.0.255</span><br><span class="line">[RT2-ospf-1-area-0.0.0.2]quit</span><br><span class="line">[RT2-ospf-1]area 0</span><br><span class="line">[RT2-ospf-1-area-0.0.0.o]network 172.16.0.4 0.0.0.3</span><br></pre></td></tr></table></figure>
<p>RT3 的配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[RT3]ospf 1 router-id 3.3.3.3</span><br><span class="line">[RT3-ospf-1]area 0</span><br><span class="line">[RT3-ospf-1-area-0.0.0.0]network 172.16.0.0 0.0.0.3</span><br><span class="line">[RT3-ospf-1-area-0.0.0.0]network 172.16.0.4 0.0.0.3</span><br></pre></td></tr></table></figure>
<p>查看 RT3 的 OSPF 邻居表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/11.png" class="">

<p>RT3 和 RT1、RT2 建立的 FULL 的邻接关系，我们再看看 RT3 的路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/12.png" class="">

<p><code>Area0</code>的路由器 RT3，已经学到了 RT1 和 RT2 下连的终端网段路由。这些路由都是区域间路由，根据 RT1 和 RT2 在<code>Area0</code>泛洪的 Type-3 LSA 计算得出，而 RT3 要计算到达<code>Area1</code>和<code>Area2</code>的区域间路由，除了这些网段的 Type-3 LSA，还需要指定 ABR 的位置。作为 ABR，RT1 和 RT2 在泛洪 Type-1 LSA 时，会把 B 比特位设置为 1。因此，通过 Area0 内泛洪的<code>Type-1</code>、<code>Type-2</code>LSA ，RT3 能计算到达 ABR 的最佳路径。使用<code>display ospf abr-asbr</code>命令查看 ABR 和 ASBR 信息：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/13.png" class="">

<p>在 RT1 和 RT2 上查看路由表，看到两台路由器都学到了全网的路由，RT1 和 RT2 下挂的 PC 就可以到达全网各个网段。</p>
<h1 id="OSPF-Cost-值"><a href="#OSPF-Cost-值" class="headerlink" title="OSPF Cost 值"></a>OSPF Cost 值</h1><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/14.png" class="">

<p>R1 和 R2 连接到相同的一个网段：<code>192.168.100.0/24</code>，同时下连 R3。R1、R2、R3 都激活 OSPF，在相同的 Area 中，接口的 Cost 又是默认值，这时 R3 的路由表中，到达<code>192.168.100.0/24</code>会有两条等价路由：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/15.png" class="">

<p>如果两条链路以主备方式工作，该如何实现呢？一个最简单的方法就是调整接口 Cost 值。比如把 R3 的<code>G0/0/2</code>接口 Cost 值调大，到达<code>192.168.100.0/24</code>的报文会转发给 R1，当 R1 故障时，R3 自动把流量切到 R2。</p>
<p>R3 的配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R3]interface GigabitEthernet 0/0/2</span><br><span class="line">[R3-GigabitEthernet0/0/2]ospf cost 100</span><br></pre></td></tr></table></figure>
<p>查看接口参数：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/16.png" class="">

<p>在查看 R3 的路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/17.png" class="">

<p>配置生效。</p>
<h1 id="OSPF-特殊区域"><a href="#OSPF-特殊区域" class="headerlink" title="OSPF 特殊区域"></a>OSPF 特殊区域</h1><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/18.png" class="">

<p>R1 、R2 、R3 运行 OSPF，R3 把自己的静态路由引入 OSPF，让域内的路由器学习到外部路由。</p>
<h2 id="1、基本配置"><a href="#1、基本配置" class="headerlink" title="1、基本配置"></a>1、基本配置</h2><p>R1 配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Rl]ospf i router-id 1.1.1.1</span><br><span class="line">[R1-ospf-l]area 1</span><br><span class="line">[R1-ospf-1-area-0.0.0.l]network 10.1.12.0 0.0.0.255</span><br></pre></td></tr></table></figure>
<p>R2 配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R2]ospf  router-id 2.2.2.2</span><br><span class="line">[R2-ospf-l]area 1</span><br><span class="line">[R2-ospf-1-area-0.0.0.]network 10.1.12.0 0.0.0.255</span><br><span class="line">[R2-ospf-1-area-0.0.0.1]quit</span><br><span class="line">[R2-ospf-1]area 0</span><br><span class="line">[R2-ospf-1-area-0.0.0.0]network 10.1.23.0 0.0.0.255</span><br></pre></td></tr></table></figure>
<p>R3 配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[R3]ip route-static 10.3.1.0 24 NULL 0</span><br><span class="line">[R3]ip route-static 10.3.2.0 24 NULL O</span><br><span class="line">[R3]ospf 1 router-id 3.3.3.3</span><br><span class="line">[R3-ospf-1]area 0</span><br><span class="line">[R3-ospf-1-area-0.0.0.o]network 10.1.23.0 0.0.0.255</span><br><span class="line">[R3-ospf-1-area-0.0.0.0]quit</span><br><span class="line">[R3-ospf-1]import-route static</span><br></pre></td></tr></table></figure>
<p>观察 R1 的路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/19.png" class="">

<p>R1 学习到了区域间路由和外部路由，外部路由标记位 O_ASE（ OSPF AS External ）。再看看 R1 的 LSDB：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/20.png" class="">

<p>R1 的 LSDB，有 Type-1、Type-2、Type-3、Type-4、Type-5 LSA。Type-3 LSA 描述到达<code>10.1.23.0/24</code>的区域间路由。Type-4 LSA 描述到达 ASBR，也就是 R3 的路由，是由 ABR R2 产生。Type-5 LSA 描述外部路由<code>10.3.1.0/24</code>和<code>10.3.2.0/24</code>，并在整个 OSPF 域内泛洪，这时 R1 有到达各个网段的路由。</p>
<h2 id="2、Area1-配置为-Stub-区域"><a href="#2、Area1-配置为-Stub-区域" class="headerlink" title="2、Area1 配置为 Stub 区域"></a>2、Area1 配置为 Stub 区域</h2><p>先把 Area1 配置为 Stub 区域，R1 和 R2 的配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Rl]ospf 1</span><br><span class="line">[R1-ospf-l]area 1</span><br><span class="line">[R1-ospf-1-area-0.0.0.1]stub</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R2]ospf 1</span><br><span class="line">[R2-ospf-l]area 1</span><br><span class="line">[R2-ospf-1-area-0.0.0.1]stub</span><br></pre></td></tr></table></figure>
<p>某个区域为 Stub 区域，区域内的路由器都要配置成 Stub 区域，否则无法正确建立邻居关系。Stub 区域的 ABR，即 R2，会阻挡 Type-4 、Type-5 LSA 进入区域内，减少 LSA 泛洪的数量，从而减小路由表规模，降低设备负担。</p>
<p>现在 R1 无法学到 OSPF 外部路由，同时 R2 会下发一条用 Type-3 LSA 描述的外部路由，让 Area1 内的路由器访问域外的网络。观察 R1 的路由表和 LSDB：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/21.png" class="">
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/22.png" class="">

<p>R1 的路由表减少，不再有 Type-4 和 Type-5 LSA ，只有 Type-1、Type-2、Type-3 LSA。</p>
<h2 id="3、Area1-配置为-Totally-Stub-区域"><a href="#3、Area1-配置为-Totally-Stub-区域" class="headerlink" title="3、Area1 配置为 Totally-Stub 区域"></a>3、Area1 配置为 Totally-Stub 区域</h2><p>如果要进一步减少 LSA 泛洪，可以把区域间的路由也阻挡。在上个实验的基础上，R2 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R2]ospf 1</span><br><span class="line">[R2-ospf-l]area 1</span><br><span class="line">[R2-ospf-1-area-0.0.0.1]stub no-summary</span><br></pre></td></tr></table></figure>
<p>这时，R2 阻挡 Type-3、Type-4、Type-5 LSA 进入 Area1，同时自动下发一条默认路由，使用 Type-3 LSA 描述。这样当 R1 访问区域外的网络时，就使用默认路由转发数据。</p>
<p>查看 R1 路由表和 LSDB：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/23.png" class="">
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/24.png" class="">

<p>R1 路由表只有一条 0.0.0.0&#x2F;0 的默认路由，极大简化了路由表。同时，R1 的 LSDB 也非常简洁。</p>
<h2 id="4、Area1-配置为-NSSA"><a href="#4、Area1-配置为-NSSA" class="headerlink" title="4、Area1 配置为 NSSA"></a>4、Area1 配置为 NSSA</h2><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/25.png" class="">

<p>网络发生变化，Area1 的 R1 连着一个外部路由，需要引入 OSPF，让域内路由器获得外部路由，但又希望保持 Stub 区域特性，那么可以把 Area1 配置为 NSSA。在上个实验的基础上，R1 配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[R1]ip route-static 10.1.1.0 24 NULL 0 <span class="comment">#模拟外部路由</span></span><br><span class="line">[R1]ospf 1</span><br><span class="line">[Rl-ospf-l]area 1</span><br><span class="line">[R1-ospf-1-area-0.0.0.1]undo stub</span><br><span class="line">[R1-ospf-1-area-0.0.0.]nssa</span><br><span class="line">[R1-ospf-1-area-0.0.0.1]quit</span><br><span class="line">[R1-ospf-1]import-route static</span><br></pre></td></tr></table></figure>
<p>在 R1 创建静态路由，模拟成外部路由，先取消 Stub 配置，然后配置 NSSA，再把外部路由引入 OSPF。</p>
<p>R2 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[R2]ospf 1</span><br><span class="line">[R2-ospf-l]area 1</span><br><span class="line">[R2-ospf-1-area-0.0.0.]undo stub</span><br><span class="line">[R2-ospf-1-area-0.0.0.1]nssa</span><br></pre></td></tr></table></figure>
<p>某个区域配置为 NSSA，则区域内的所有路由器都要进行相应配置，否则建立邻居关系会出现问题。Area1 区域成为 NSSA 后，会阻挡 Type-4、Type-5 LSA 进入区域。但是 ABR R2 会下发一条 Type-7 LSA 的默认路由，让区域内的路由器，通过默认路由到达域外网络。同时，会向 Area0 通告 Type-5 LSA 描述<code>10.1.1.0/24</code>路由，让 OSPF 其它区域的路由器都学习到这条路由。</p>
<p>查看 R1 的 LSDB ：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/26.png" class="">

<p>R1 的 LSDB 中，有 Type-1、Type-2、Type-3、Type-7 LSA，其中两条 Type-7 LSA，一条是 R1 生成的，描述引入的外部路由<code>10.1.1.0/24</code>，另一条是 R2 生成的，是一条默认路由。再看看 R1 的路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/27.png" class="">

<p>再看看 R3 的 LSDB:</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/28.png" class="">

<p>R3 有三条 Type-5 LSA，其中两条是自己生成的，描述外部路由<code>10.3.1.0/24</code>和<code>10.3.2.0/24</code>，另一条是 R2 生成的，描述外部路由<code>10.1.1.0/24</code>。R2 把从 Area1 收到的 Type-7 LSA 转换成 Type-5 LSA，并通告到 Area0 中。查看 R3 路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/29.png" class="">

<h2 id="5、Area1-配置为-Totally-NSSA"><a href="#5、Area1-配置为-Totally-NSSA" class="headerlink" title="5、Area1 配置为 Totally NSSA"></a>5、Area1 配置为 Totally NSSA</h2><p>为了进一步减少 Area1 的 LSA，把 Area1 配置成 Totally NSSA 实现。在上个实验的基础上，R2 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R2]ospf 1</span><br><span class="line">[R2-ospf-l]area 1</span><br><span class="line">[R2-ospf-1-area-0.0.0.1]nssa no-summary</span><br></pre></td></tr></table></figure>
<p>这样 Area1 内不会有 Type-3 LSA 泛洪，R1 也学不到区域间路由。</p>
<p>看下 R1 的 LSDB：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/30.png" class="">

<p>R1 的 LSDB 中，只有 Type-1、Type-2、Type-7 LSA 和一条描述的默认路由 Type-3 LSA。当 NSSA 内同时存在 Type-3 LSA 和 Type-7 LSA 描述的默认路由时，路由器优先使用 Type-3 LSA 的默认路由，忽略 Type-7 LSA 的默认路由。</p>
<h1 id="Virtual-Link"><a href="#Virtual-Link" class="headerlink" title="Virtual Link"></a>Virtual Link</h1><img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/31.png" class="">

<p>R1、R2、R3 运行 OSPF，规划两个区域<code>Area0</code>和<code>Area23</code>。R3 有两条路由到达<code>192.168.2.0/24</code>网段，因为 R3 不能使用非 0 区域的 Type-3 LSA 来计算区域间路由，因此无论路径的 Cost 如何，R3 都会选择 R1 到达目的网段。查看 R3 的 OSPF 路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/32.png" class="">

<p>如果向让 R3 从 R2 到达<code>192.168.2.0/24</code>，即使用高带宽链路转发，一个简单的方法是，在 R2 和 R3 之间跨越<code>Area23</code>建立一条<code>Virtual Link</code>，通过这条<code>Virtual Link</code>，R2 直接把 Type-1 LSA 发送给 R3。</p>
<p>R2 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R2]ospf 1</span><br><span class="line">[R2-ospf-l]area 23</span><br><span class="line">[R2-ospf-1-area-0.0.0.23]vlink-peer 3.3.3.3</span><br></pre></td></tr></table></figure>
<p>R3 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R3]ospf 1</span><br><span class="line">[R3-ospf-l]area 23</span><br><span class="line">[R3-ospf-1-area-0.0.0.23]vlink-peer 2.2.2.2</span><br></pre></td></tr></table></figure>
<p>配置完成后，R2 和 R3 建立一条<code>Virtual Link</code>，<code>Virtual Link</code>穿过 Area23，在 R3 查看<code>Virtual Link</code>信息：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/33.png" class="">

<p><code>Virtual Link</code>建立完成后，状态为<code>Full</code>，Cost 为 1，再看下 R3 的 OSPF 路由表：</p>
<img src="/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/34.png" class="">

<p><code>192.168.2.0/24</code>路由的下一跳变成了<code>192.168.23.2</code>，说明到达这个网段的下一跳切换到了 R2，达到预期目标。</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2023/05/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/OSPF%E5%AE%9E%E6%88%98/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2023/07/02/Shell/Bash%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Bash 基本语法
          
        </div>
      </a>
    
    
      <a href="/2023/05/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/STP%E8%AF%A6%E8%A7%A3/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title"></div>
      </a>
    
  </nav>

  
   
  
    
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2017-2023
        <i class="ri-heart-fill heart_icon"></i> WSQ
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="学海无涯"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>