<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 学海无涯</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?b1b5dee3bb1719c8a439f8070118dc80";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <!-- <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script> -->
      <link href="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.css" rel="stylesheet">
      <script src="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/wsq01/"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover5.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">学海无涯</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-java/MyBatis/MyBatis入门"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/07/java/MyBatis/MyBatis%E5%85%A5%E9%97%A8/"
    >MyBatis 入门</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/07/java/MyBatis/MyBatis%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2021-04-07T08:24:15.000Z" itemprop="datePublished">2021-04-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>MyBatis 是一个基于 Java 的持久层框架。MyBatis 提供的持久层框架包括 SQL Maps 和 Data Access Objects（DAO），它消除了几乎所有的 JDBC 代码和参数的手工设置以及结果集的检索。</p>
<p>MyBatis 使用简单的 XML 或注解用于配置和映射原始类型，将接口和 Java 的 POJOs（Plain Old Java Objects，普通的 Java 对象）映射成数据库中的记录。</p>
<p>Java 的持久层框架产品常见的有 Hibernate 和 MyBatis。</p>
<p>Hibernate 和 MyBatis 的区别：</p>
<ol>
<li>sql 优化方面</li>
</ol>
<ul>
<li>Hibernate 不需要编写大量的 SQL，就可以完全映射，提供了日志、缓存、级联（级联比 MyBatis 强大）等特性，此外还提供 HQL（Hibernate Query Language）对 POJO 进行操作。但会多消耗性能。</li>
<li>MyBatis 手动编写 SQL，支持动态 SQL、处理列表、动态生成表名、支持存储过程。工作量相对大些。</li>
</ul>
<ol start="2">
<li>开发方面</li>
</ol>
<ul>
<li>MyBatis 是一个半自动映射的框架，因为 MyBatis 需要手动匹配 POJO、SQL 和映射关系。</li>
<li>Hibernate 是一个全表映射的框架，只需提供 POJO 和映射关系即可。</li>
</ul>
<ol start="3">
<li>Hibernate 优势</li>
</ol>
<ul>
<li>Hibernate 的 DAO 层开发比 MyBatis 简单，Mybatis 需要维护 SQL 和结果映射。</li>
<li>Hibernate 对对象的维护和缓存要比 MyBatis 好，对增删改查的对象的维护要方便。</li>
<li>Hibernate 数据库移植性很好，MyBatis 的数据库移植性不好，不同的数据库需要写不同 SQL。</li>
<li>Hibernate 有更好的二级缓存机制，可以使用第三方缓存。MyBatis 本身提供的缓存机制不佳。</li>
</ul>
<ol start="4">
<li>Mybatis优势</li>
</ol>
<ul>
<li>MyBatis 可以进行更为细致的 SQL 优化，可以减少查询字段。</li>
<li>MyBatis 容易掌握，而 Hibernate 门槛较高。</li>
</ul>
<p>总的来说，MyBatis 是一个小巧、方便、高效、简单、直接、半自动化的持久层框架，Hibernate 是一个强大、方便、高效、复杂、间接、全自动化的持久层框架。</p>
<p>所以对于性能要求不太苛刻的系统，比如管理系统、ERP 等推荐使用 Hibernate，而对于性能要求高、响应快、灵活的系统则推荐使用 MyBatis。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>要使用 MyBatis， 只需将<code>mybatis-x.x.x.jar</code>文件置于类路径（<code>classpath</code>）中即可。</p>
<p>如果使用 Maven 来构建项目，则需将下面的依赖代码置于<code>pom.xml</code>文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="MyBatis-的工作原理"><a href="#MyBatis-的工作原理" class="headerlink" title="MyBatis 的工作原理"></a>MyBatis 的工作原理</h1><img src="/2021/04/07/java/MyBatis/MyBatis%E5%85%A5%E9%97%A8/1.png" class="" title="MyBatis 框架的执行流程图">

<p>流程说明：</p>
<ol>
<li>读取 MyBatis 配置文件：<code>mybatis-config.xml</code>为 MyBatis 的全局配置文件，配置了 MyBatis 的运行环境等信息，例如数据库连接信息。</li>
<li>加载映射文件。映射文件即 SQL 映射文件，该文件中配置了操作数据库的 SQL 语句，需要在 MyBatis 配置文件<code>mybatis-config.xml</code>中加载。<code>mybatis-config.xml</code>文件可以加载多个映射文件，每个文件对应数据库中的一张表。</li>
<li>构造会话工厂：通过 MyBatis 的环境等配置信息构建会话工厂<code>SqlSessionFactory</code>。</li>
<li>创建会话对象：由会话工厂创建<code>SqlSession</code>对象，该对象中包含了执行 SQL 语句的所有方法。</li>
<li><code>Executor</code>执行器：MyBatis 底层定义了一个<code>Executor</code>接口来操作数据库，它将根据<code>SqlSession</code>传递的参数动态地生成需要执行的 SQL 语句，同时负责查询缓存的维护。</li>
<li><code>MappedStatement</code>对象：在<code>Executor</code>接口的执行方法中有一个<code>MappedStatement</code>类型的参数，该参数是对映射信息的封装，用于存储要映射的 SQL 语句的<code>id</code>、参数等信息。</li>
<li>输入参数映射：输入参数类型可以是<code>Map、List</code>等集合类型，也可以是基本数据类型和 POJO 类型。输入参数映射过程类似于 JDBC 对<code>preparedStatement</code>对象设置参数的过程。</li>
<li>输出结果映射：输出结果类型可以是<code>Map、 List</code>等集合类型，也可以是基本数据类型和 POJO 类型。输出结果映射过程类似于 JDBC 对结果集的解析过程。</li>
</ol>
<h1 id="MyBatis的核心组件"><a href="#MyBatis的核心组件" class="headerlink" title="MyBatis的核心组件"></a>MyBatis的核心组件</h1><p>MyBatis 的核心组件分为 4 个部分。</p>
<ol>
<li><code>SqlSessionFactoryBuilder</code>（构造器）：它会根据配置或者代码来生成<code>SqlSessionFactory</code>，采用的是分步构建的<code>Builder</code>模式。</li>
<li><code>SqlSessionFactory</code>（工厂接口）：依靠它来生成<code>SqlSession</code>，使用的是工厂模式。</li>
<li><code>SqlSession</code>（会话）：一个既可以发送 SQL 执行返回结果，也可以获取<code>Mapper</code>的接口。一般我们会让其在业务逻辑代码中“消失”，而使用的是 MyBatis 提供的<code>SQL Mapper</code>接口编程技术，它能提高代码的可读性和可维护性。</li>
<li><code>SQL Mapper</code>（映射器）：它由一个 Java 接口和 XML 文件（或注解）构成，需要给出对应的 SQL 和映射规则。它负责发送 SQL 去执行，并返回结果。</li>
</ol>
<p>注意，无论是映射器还是<code>SqlSession</code>都可以发送 SQL 到数据库执行。</p>
<h1 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h1><p>使用 MyBatis 首先是使用配置或者代码去生产<code>SqlSessionFactory</code>，MyBatis 提供了构造器<code>SqlSessionFactoryBuilder</code>。它提供了一个类<code>org.apache.ibatis.session.Configuration</code>作为引导，采用的是<code>Builder</code>模式。具体的分步则是在<code>Configuration</code>类里面完成的。</p>
<p>在 MyBatis 中，既可以通过读取配置的 XML 文件的形式生成<code>SqlSessionFactory</code>，也可以通过 Java 代码的形式去生成<code>SqlSessionFactory</code>。</p>
<p>当配置了 XML 或者提供代码后，MyBatis 会读取配置文件，通过<code>Configuration</code>类对象构建整个 MyBatis 的上下文。</p>
<p>注意，<code>SqlSessionFactory</code>是一个接口，在 MyBatis 中它存在两个实现类：<code>SqlSessionManager</code>和<code>DefaultSqlSessionFactory</code>。</p>
<p>一般而言，具体是由<code>DefaultSqlSessionFactory</code>去实现的，而<code>SqlSessionManager</code>使用在多线程的环境中，它的具体实现依靠<code>DefaultSqlSessionFactory</code>。</p>
<img src="/2021/04/07/java/MyBatis/MyBatis%E5%85%A5%E9%97%A8/2.png" class="" title="SqlSessionFactory 的生成">

<p>每个基于 MyBatis 的应用都是以一个<code>SqlSessionFactory</code>的实例为中心的，而<code>SqlSessionFactory</code>唯一的作用就是生产 MyBatis 的核心接口对象<code>SqlSession</code>，所以它的责任是唯一的。我们往往会采用单例模式处理它。</p>
<h2 id="使用-XML-构建-SqlSessionFactory"><a href="#使用-XML-构建-SqlSessionFactory" class="headerlink" title="使用 XML 构建 SqlSessionFactory"></a>使用 XML 构建 SqlSessionFactory</h2><p>在 MyBatis 中的 XML 分为两类，一类是基础配置文件，通常只有一个，主要是配置一些最基本的上下文参数和运行环境；另一类是映射文件，它可以配置映射关系、SQL、参数等信息。</p>
<p>基础配置文件<code>mybatis-config.xml</code>，放在工程类路径下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span><span class="comment">&lt;!--别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.mybatis.po.User&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 数据库环境 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用JDBC的事务管理 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- MySQL数据库驱动 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接数据库的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1128&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 将mapper文件加入到配置文件中 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/mapper/UserMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>有了基础配置文件，就可以生成<code>SqlSessionFactory</code>了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">InputStream is;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">  factory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先读取<code>mybatis-config.xml</code>，然后通过<code>SqlSessionFactoryBuilder</code>的<code>Builder</code>方法去创建<code>SqlSessionFactory</code>。整个过程比较简单，而里面的步骤还是比较烦琐的，只是 MyBatis 采用了<code>Builder</code>模式隐藏了这些细节。这样一个<code>SqlSessionFactory</code>就被创建出来了。</p>
<h2 id="使用代码创建-SqlSessionFactory"><a href="#使用代码创建-SqlSessionFactory" class="headerlink" title="使用代码创建 SqlSessionFactory"></a>使用代码创建 SqlSessionFactory</h2><p>通过代码来实现与使用 XML 构建<code>SqlSessionFactory</code>一样的功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库连接池信息</span></span><br><span class="line"><span class="type">PooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PooledDataSource</span>();</span><br><span class="line">dataSource.setDriver(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">dataSource.setPassword (<span class="string">&quot;1128&quot;</span>);</span><br><span class="line">dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>);</span><br><span class="line">dataSource.setDefeultAutoCommit(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 采用 MyBatis 的 JDBC 事务方式</span></span><br><span class="line"><span class="type">TransactionFactory</span> <span class="variable">transactionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTransactionFactory</span>();</span><br><span class="line"><span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Environment</span> (<span class="string">&quot;development&quot;</span>, transactionFactory, dataSource);</span><br><span class="line"><span class="comment">// 创建 Configuration 对象</span></span><br><span class="line"><span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(environment);</span><br><span class="line"><span class="comment">// 注册一个 MyBatis 上下文别名</span></span><br><span class="line">configuration.getTypeAliasRegistry().registerAlias(<span class="string">&quot;role&quot;</span>, Role.class);</span><br><span class="line"><span class="comment">// 加入一个映射器</span></span><br><span class="line">configuration.addMapper(RoleMapper.class);</span><br><span class="line"><span class="comment">//使用 SqlSessionFactoryBuilder 构建 SqlSessionFactory</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">SqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(configuration);</span><br><span class="line"><span class="keyword">return</span> SqlSessionFactory;</span><br></pre></td></tr></table></figure>
<p>它和 XML 方式实现的功能是一致的。但是代码冗长，如果发生系统修改，那么有可能需要重新编译代码才能继续，所以这不是一个很好的方式。</p>
<p>除非有特殊的需要，比如在配置文件中，需要配置加密过的数据库用户名和密码，需要我们在生成<code>SqlSessionFactory</code>前解密为明文的时候，才会考虑使用这样的方式。</p>
<h1 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h1><p>在 MyBatis 中，<code>SqlSession</code>是其核心接口。在 MyBatis 中有两个实现类，<code>DefaultSqlSession</code>和<code>SqlSessionManager</code>。</p>
<p><code>DefaultSqlSession</code>是单线程使用的，而<code>SqlSessionManager</code>在多线程环境下使用。<code>SqlSession</code>的作用类似于一个 JDBC 中的<code>Connection</code>对象，代表着一个连接资源的启用。它的作用有 3 个：获取<code>Mapper</code>接口、发送 SQL 给数据库、控制数据库事务。</p>
<p>创建<code>SqlSession</code>方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionFactory.openSession();</span><br></pre></td></tr></table></figure>
<p>注意，<code>SqlSession</code>只是一个门面接口，它有很多方法，可以直接发送 SQL。它就好像一家软件公司的商务人员，是一个门面，而实际干活的是软件工程师。在 MyBatis 中，真正干活的是<code>Executor</code>。</p>
<p><code>SqlSession</code>控制数据库事务的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义 SqlSession</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 打开 SqlSession 会话</span></span><br><span class="line">  sqlSession = SqlSessionFactory.openSession();</span><br><span class="line">  <span class="comment">// some code...</span></span><br><span class="line">  sqlSession.commit();    <span class="comment">// 提交事务</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">  sqlSession.rollback();  <span class="comment">// 回滚事务</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="comment">// 在 finally 语句中确保资源被顺利关闭</span></span><br><span class="line">  <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>)&#123;</span><br><span class="line">    sqlSession.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用<code>commit</code>方法提交事务，或者使用<code>rollback</code>方法回滚事务。因为它代表着一个数据库的连接资源，使用后要及时关闭它，如果不关闭，那么数据库的连接资源就会很快被耗费光，整个系统就会瘫痪，所以用<code>finally</code>语句保证其顺利关闭。</p>
<h1 id="实现映射器的2种方式"><a href="#实现映射器的2种方式" class="headerlink" title="实现映射器的2种方式"></a>实现映射器的2种方式</h1><p>映射器由一个接口和对应的 XML 文件（或注解）组成。它可以配置以下内容：</p>
<ul>
<li>描述映射规则。</li>
<li>提供 SQL 语句，并可以配置 SQL 参数类型、返回类型、缓存刷新等信息。</li>
<li>配置缓存。</li>
<li>提供动态 SQL。</li>
</ul>
<p>两种实现映射器的方式，XML 文件形式和注解形式。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `role_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `note` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<p>定义一个 POJO。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.po;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  <span class="keyword">private</span> String roleName;</span><br><span class="line">  <span class="keyword">private</span> String note;</span><br><span class="line"><span class="comment">/**setter and getter**/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>映射器的主要作用就是将 SQL 查询到的结果映射为一个 POJO，或者将 POJO 的数据插入到数据库中，并定义一些关于缓存等的重要内容。</p>
<p>注意，开发只是一个接口，而不是一个实现类。接口不能直接运行。MyBatis 运用了动态代理技术使得接口能运行起来，MyBatis 会为这个接口生成一个代理对象，代理对象会去处理相关的逻辑。</p>
<h2 id="用-XML-实现映射器"><a href="#用-XML-实现映射器" class="headerlink" title="用 XML 实现映射器"></a>用 XML 实现映射器</h2><p>用 XML 定义映射器分为两个部分：接口和 XML。先定义一个映射器接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> com.mybatis.po.Role;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleMapper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> Role <span class="title function_">getRole</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在用 XML 方式创建<code>SqlSession</code>的配置文件中有这样一段代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/mapper/RoleMapper.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>它的作用就是引入一个 XML 文件。用 XML 方式创建映射器。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatis.mapper.RoleMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getRole&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;long&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;role&quot;</span>&gt;</span></span><br><span class="line">    SELECT id,role_name as roleName,note FROM role WHERE id =#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>有了这两个文件，就完成了一个映射器的定义。</p>
<p><code>&lt;mapper&gt;</code>元素中的属性<code>namespace</code>所对应的是一个接口的全限定名，于是 MyBatis 上下文就可以通过它找到对应的接口。</p>
<p><code>&lt;select&gt;</code>元素表明这是一条查询语句，而属性<code>id</code>标识了这条 SQL，属性<code>parameterType=&quot;long&quot;</code>说明传递给 SQL 的是一个<code>long</code>型的参数，而<code>resultType=&quot;role&quot;</code>表示返回的是一个<code>role</code>类型的返回值。而<code>role</code>是之前配置文件<code>mybatis-config.xml</code>配置的别名，指代的是<code>com.mybatis.po.Role</code>。</p>
<p>注意，我们并没有配置 SQL 执行后和 role 的对应关系，它是如何映射的呢？</p>
<p>其实这里采用的是一种被称为自动映射的功能，MyBatis 在默认情况下提供自动映射，只要 SQL 返回的列名能和 POJO 对应起来即可。</p>
<p>这里 SQL 返回的列名<code>id</code>和<code>note</code>是可以和之前定义的 POJO 的属性对应起来的，而表里的列<code>role_name</code>通过 SQL 别名的改写，使其成为<code>roleName</code>，也是和 POJO 对应起来的，所以此时 MyBatis 就可以把 SQL 查询的结果通过自动映射的功能映射成为一个 POJO。</p>
<h2 id="注解实现映射器"><a href="#注解实现映射器" class="headerlink" title="注解实现映射器"></a>注解实现映射器</h2><p>除 XML 方式定义映射器外，还可以采用注解方式定义映射器，它只需要一个接口就可以通过 MyBatis 的注解来注入 SQL。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> com.mybatis.po.Role;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleMapper2</span> &#123;</span><br><span class="line">  <span class="meta">@Select(&quot;select id,role_name as roleName,note from t_role where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Role <span class="title function_">getRole</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这完全等同于 XML 方式创建映射器。如果它和 XML 方式同时定义时，XML 方式将覆盖掉注解方式。此外，XML 可以相互引入，而注解是不可以的，所以在一些比较复杂的场景下，使用 XML 方式会更加灵活和方便。</p>
<p>这个接口可以在 XML 中定义，我们仿造在<code>mybatis-config.xml</code>中配置 XML 语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/mapper/RoleMapper.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>把它修改为下面的形式即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/mapper/RoleMapper2&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以使用<code>configuration</code>对象注册这个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.addMapper(RoleMapper2.class);</span><br></pre></td></tr></table></figure>
<h1 id="执行SQL的两种方式"><a href="#执行SQL的两种方式" class="headerlink" title="执行SQL的两种方式"></a>执行SQL的两种方式</h1><h2 id="SqlSession-发送-SQL"><a href="#SqlSession-发送-SQL" class="headerlink" title="SqlSession 发送 SQL"></a>SqlSession 发送 SQL</h2><p>有了映射器就可以通过<code>SqlSession</code>发送 SQL 了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> (Role)sqlSession.select(<span class="string">&quot;com.mybatis.mapper.RoleMapper.getRole&quot;</span>, <span class="number">1L</span>);</span><br></pre></td></tr></table></figure>
<p><code>selectOne</code>方法表示使用查询并且只返回一个对象，而参数则是一个<code>String</code>对象和一个<code>Object</code>对象。这里是一个<code>long</code>参数，<code>long</code>参数是它的主键。</p>
<p><code>String</code>对象是由一个命名空间加上 SQL <code>id</code>组合而成的，它完全定位了一条 SQL，这样 MyBatis 就会找到对应的 SQL。如果在 MyBatis 中只有一个<code>id</code>为<code>getRole</code>的 SQL，那么也可以简写为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> (Role)sqlSession.selectOne(<span class="string">&quot;getRole&quot;</span>,<span class="number">1L</span>);</span><br></pre></td></tr></table></figure>
<p>这是 MyBatis 前身 iBatis 所留下的方式。</p>
<h2 id="用-Mapper-接口发送-SQL"><a href="#用-Mapper-接口发送-SQL" class="headerlink" title="用 Mapper 接口发送 SQL"></a>用 Mapper 接口发送 SQL</h2><p><code>SqlSession</code>还可以获取<code>Mapper</code>接口，通过<code>Mapper</code>接口发送 SQL。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RoleMapper</span> <span class="variable">roleMapper</span> <span class="operator">=</span> sqlSession.getMapper(RoleMapper.class);</span><br><span class="line"><span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> roleMapper.getRole(<span class="number">1L</span>);</span><br></pre></td></tr></table></figure>
<p>通过<code>SqlSession</code>的<code>getMapper</code>方法来获取一个<code>Mapper</code>接口，就可以调用它的方法了。因为 XML 文件或者接口注解定义的 SQL 都可以通过“类的全限定名+方法名”查找，所以 MyBatis 会启用对应的 SQL 进行运行，并返回结果。</p>
<h2 id="对比两种发送-SQL-方式"><a href="#对比两种发送-SQL-方式" class="headerlink" title="对比两种发送 SQL 方式"></a>对比两种发送 SQL 方式</h2><p>建议采用<code>SqlSession</code>获取<code>Mapper</code>的方式，理由如下：</p>
<p>使用<code>Mapper</code>接口编程可以消除<code>SqlSession</code>带来的功能性代码，提高可读性，而<code>SqlSession</code>发送 SQL，需要一个 SQL <code>id</code>去匹配 SQL，比较晦涩难懂。使用<code>Mapper</code>接口，类似<code>roleMapper.getRole（1L）</code>则是完全面向对象的语言，更能体现业务的逻辑。</p>
<p>使用<code>Mapper.getRole（1L）</code>方式，IDE 会提示错误和校验，而使用<code>sqlSession.selectOne（“getRole”,1L）</code>语法，只有在运行中才能知道是否会产生错误。</p>
<p>目前使用<code>Mapper</code>接口编程已成为主流，尤其在 Spring 中运用 MyBatis 时，<code>Mapper</code>接口的使用就更为简单</p>
<h1 id="核心组件的作用域和生命周期"><a href="#核心组件的作用域和生命周期" class="headerlink" title="核心组件的作用域和生命周期"></a>核心组件的作用域和生命周期</h1><h2 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h2><p><code>SqlSessionFactoryBuilder</code>的作用在于创建<code>SqlSessionFactory</code>，创建成功后，<code>SqlSessionFactoryBuilder</code>就失去了作用，所以它只能存在于创建<code>SqlSessionFactory</code>的方法中，而不要让其长期存在。因此<code>SqlSessionFactoryBuilder</code>实例的最佳作用域是方法作用域（也就是局部方法变量）。</p>
<h2 id="SqlSessionFactory-1"><a href="#SqlSessionFactory-1" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h2><p><code>SqlSessionFactory</code>可以被认为是一个数据库连接池，它的作用是创建<code>SqlSession</code>接口对象。因为 MyBatis 的本质就是 Java 对数据库的操作，所以<code>SqlSessionFactory</code>的生命周期存在于整个 MyBatis 的应用之中，所以一旦创建了<code>SqlSessionFactory</code>，就要长期保存它，直至不再使用 MyBatis 应用，所以可以认为<code>SqlSessionFactory</code>的生命周期就等同于 MyBatis 的应用周期。</p>
<p>由于<code>SqlSessionFactory</code>是一个对数据库的连接池，所以它占据着数据库的连接资源。如果创建多个<code>SqlSessionFactory</code>，那么就存在多个数据库连接池，这样不利于对数据库资源的控制，也会导致数据库连接资源被消耗光，出现系统宕机等情况，所以尽量避免发生这样的情况。</p>
<p>因此在一般的应用中我们往往希望<code>SqlSessionFactory</code>作为一个单例，让它在应用中被共享。所以说<code>SqlSessionFactory</code>的最佳作用域是应用作用域。</p>
<h2 id="SqlSession-1"><a href="#SqlSession-1" class="headerlink" title="SqlSession"></a>SqlSession</h2><p>如果说<code>SqlSessionFactory</code>相当于数据库连接池，那么<code>SqlSession</code>就相当于一个数据库连接（<code>Connection</code>对象），你可以在一个事务里面执行多条 SQL，然后通过它的<code>commit、rollback</code>等方法，提交或者回滚事务。</p>
<p>所以它应该存活在一个业务请求中，处理完整个请求后，应该关闭这条连接，让它归还给<code>SqlSessionFactory</code>，否则数据库资源就很快被耗费精光，系统就会瘫痪，所以用<code>try...catch...finally...</code>语句来保证其正确关闭。</p>
<p>所以<code>SqlSession</code>的最佳的作用域是请求或方法作用域。</p>
<h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><p><code>Mapper</code>是一个接口，它由<code>SqlSession</code>所创建，所以它的最大生命周期至多和<code>SqlSession</code>保持一致，尽管它很好用，但是由于<code>SqlSession</code>的关闭，它的数据库连接资源也会消失，所以它的生命周期应该小于等于<code>SqlSession</code>的生命周期。<code>Mapper</code>代表的是一个请求中的业务处理，所以它应该在一个请求中，一旦处理完了相关的业务，就应该废弃它。</p>
<img src="/2021/04/07/java/MyBatis/MyBatis%E5%85%A5%E9%97%A8/3.png" class="" title="MyBatis 组件的生命周期">

<h1 id="resultMap元素"><a href="#resultMap元素" class="headerlink" title="resultMap元素"></a>resultMap元素</h1><p><code>&lt;resultMap&gt;</code>元素表示结果映射集，是 MyBatis 中最重要也是最强大的元素，主要用来定义映射规则、级联的更新以及定义类型转化器等。</p>
<h2 id="resultMap-元素的结构"><a href="#resultMap-元素的结构" class="headerlink" title="resultMap 元素的结构"></a>resultMap 元素的结构</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor</span>&gt;</span><span class="comment">&lt;!-- 类再实例化时用来注入结果到构造方法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">idArg</span>/&gt;</span><span class="comment">&lt;!-- ID参数，结果为ID --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span>/&gt;</span><span class="comment">&lt;!-- 注入到构造方法的一个普通结果 --&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="comment">&lt;!-- 用于表示哪个列是主键 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span>/&gt;</span><span class="comment">&lt;!-- 注入到字段或JavaBean属性的普通结果 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 用于一对一关联 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 用于一对多、多对多关联 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="comment">&lt;!-- 使用结果值来决定使用哪个结果映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 基于某些值的结果映射 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;resultMap&gt;</code>元素的<code>type</code>属性表示需要的<code>POJO</code>，<code>id</code>属性是<code>resultMap</code>的唯一标识。</li>
<li>子元素<code>&lt;constructor&gt;</code>用于配置构造方法（当 POJO 未定义无参数的构造方法时使用）。</li>
<li>子元素<code>&lt;id&gt;</code>用于表示哪个列是主键。</li>
<li>子元素<code>&lt;result&gt;</code>用于表示POJO和数据表普通列的映射关系。</li>
<li>子元素<code>&lt;association&gt;、&lt;collection&gt;</code>和<code>&lt;discriminator&gt;</code>用在级联的情况下。</li>
</ul>
<p>一条查询 SQL 语句执行后将返回结果，而结果可以使用<code>Map</code>存储，也可以使用<code>POJO</code>存储。</p>
<h2 id="使用-Map-存储结果集"><a href="#使用-Map-存储结果集" class="headerlink" title="使用 Map 存储结果集"></a>使用 Map 存储结果集</h2><p>任何<code>select</code>语句都可以使用<code>Map</code>存储结果：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有用户信息存到Map中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllUserMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试上述 SQL 配置文件的过程如下：</p>
<p>首先在<code>com.dao.UserDao</code>接口中添加以下接口方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">selectAllUserMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>然后在<code>com.controller</code>包的<code>UserController</code>类中调用接口方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有用户信息存到Map中</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; lmp = userDao.selectAllUserMap();</span><br><span class="line"><span class="keyword">for</span> (Map&lt;String, Object&gt; map : lmp) &#123;</span><br><span class="line">  System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述 Map 的 key 是 select 语句查询的字段名（必须完全一样），而 Map 的 value 是查询返回结果中字段对应的值，一条记录映射到一个 Map 对象中。Map 用起来很方便，但可读性稍差，有的开发者不太喜欢使用 Map，更多时候喜欢使用 POJO 的方式。</p>
<h2 id="使用POJO存储结果集"><a href="#使用POJO存储结果集" class="headerlink" title="使用POJO存储结果集"></a>使用POJO存储结果集</h2><p>使用<code>POJO</code>的方式存储结果集，一方面可以使用自动映射，例如使用<code>resultType</code>属性，但有时候需要更为复杂的映射或级联，这时候就需要使用<code>&lt;select&gt;</code>元素的<code>resultMap</code>属性配置映射集合：</p>
<h3 id="1-创建-POJO-类"><a href="#1-创建-POJO-类" class="headerlink" title="1.创建 POJO 类"></a>1.创建 POJO 类</h3><p>在应用的<code>com.pojo</code>包中创建<code>POJO</code>类<code>MapUser</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pojo;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapUser</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer m_uid;</span><br><span class="line">  <span class="keyword">private</span> String m_uname;</span><br><span class="line">  <span class="keyword">private</span> String m_usex;</span><br><span class="line">  <span class="comment">// 此处省略setter和getter方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;User[uid=&quot;</span> + m_uid + <span class="string">&quot;,uname=&quot;</span> + m_uname + <span class="string">&quot;,usex=&quot;</span> + m_usex + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-配置-resultMap-元素"><a href="#2-配置-resultMap-元素" class="headerlink" title="2.配置 resultMap 元素"></a>2.配置 resultMap 元素</h3><p>在 SQL 映射文件<code>UserMapper.xml</code>中配置<code>&lt;resultMap&gt;</code>元素，其属性<code>type</code>引用<code>POJO</code>类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用自定义结果集类型--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.pojo.MapUser&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myResult&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- property 是 com.pojo.MapUser 类中的属性--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- column是查询结果的列名，可以来自不同的表--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;m_uid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;m_uname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;uname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;m_usex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;usex&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-配置-select-元素"><a href="#3-配置-select-元素" class="headerlink" title="3.配置 select 元素"></a>3.配置 select 元素</h3><p>在 SQL 映射文件<code>UserMapper.xml</code>中配置<code>&lt;select&gt;</code>元素，其属性<code>resultMap</code>引用了<code>&lt;resultMap&gt;</code>元素的<code>id</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用自定义结果集类型查询所有用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectResultMap&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;myResult&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-添加接口方法"><a href="#4-添加接口方法" class="headerlink" title="4.添加接口方法"></a>4.添加接口方法</h3><p>在<code>com.dao.UserDao</code>接口中添加以下接口方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public List<span class="tag">&lt;<span class="name">MapUser</span>&gt;</span> selectResultMap();</span><br></pre></td></tr></table></figure>
<h3 id="5-调用接口方法"><a href="#5-调用接口方法" class="headerlink" title="5.调用接口方法"></a>5.调用接口方法</h3><p>在<code>com.controller</code>包的<code>UserController</code>类中调用接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用resultMap映射结果集</span></span><br><span class="line">List&lt;MapUser&gt; listResultMap = userDao.selectResultMap();</span><br><span class="line"><span class="keyword">for</span> (MapUser myUser : listResultMap) &#123;</span><br><span class="line">  System.out.println(myUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/JDBC/JDBC 批量处理"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/11/java/JDBC/JDBC%20%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86/"
    >JDBC 批量处理</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/11/java/JDBC/JDBC%20%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2021-03-11T07:51:24.000Z" itemprop="datePublished">2021-03-11</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JDBC/">JDBC</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>批量处理允许将相关的 SQL 语句分组到批处理中，并通过对数据库的一次调用来提交它们，一次执行完成与数据库之间的交互。一次向数据库发送多个 SQL 语句时，可以减少通信开销，从而提高性能。</p>
<p>不需要JDBC驱动程序来支持此功能。应该使用<code>DatabaseMetaData.supportsBatchUpdates()</code>方法来确定目标数据库是否支持批量更新处理。如果 JDBC 驱动程序支持此功能，该方法将返回<code>true</code>。</p>
<p><code>Statement，PreparedStatement</code>和<code>CallableStatement</code>的<code>addBatch()</code>方法用于将单个语句添加到批处理。<code>executeBatch()</code>用于执行组成批量的所有语句。</p>
<p><code>executeBatch()</code>返回一个整数数组，数组的每个元素表示相应更新语句的更新计数。就像将批处理语句添加到处理中一样，可以使用<code>clearBatch()</code>方法删除它们。此方法将删除所有使用<code>addBatch()</code>方法添加的语句。但是，无法指定选择某个要删除的语句。</p>
<h1 id="使用Statement对象进行批处理"><a href="#使用Statement对象进行批处理" class="headerlink" title="使用Statement对象进行批处理"></a>使用Statement对象进行批处理</h1><ul>
<li>使用<code>Statement</code>对象的批处理的典型步骤序列：</li>
<li>使用<code>createStatement()</code>方法创建<code>Statement</code>对象。</li>
<li>使用<code>setAutoCommit()</code>将自动提交设置为<code>false</code>。</li>
<li>使用<code>addBatch()</code>方法在创建的<code>Statement</code>对象上添加 SQL 语句到批处理中。</li>
<li>在创建的<code>Statement</code>对象上使用<code>executeBatch()</code>方法执行所有 SQL 语句。</li>
<li>最后，使用<code>commit()</code>方法提交所有更改。</li>
</ul>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchingWithStatement</span> &#123;</span><br><span class="line">  <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Database credentials</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Register JDBC driver</span></span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open a connection</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">    conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create statement</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">    stmt = conn.createStatement();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set auto-commit to false</span></span><br><span class="line">    conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// First, let us select all the records and display them.</span></span><br><span class="line">    printRows(stmt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create SQL statement</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">SQL</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO Employees (id, first, last, age) VALUES(200,&#x27;Curry&#x27;, &#x27;Stephen&#x27;, 30)&quot;</span>;</span><br><span class="line">    <span class="comment">// Add above SQL statement in the batch.</span></span><br><span class="line">    stmt.addBatch(SQL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create one more SQL statement</span></span><br><span class="line">    SQL = <span class="string">&quot;INSERT INTO Employees (id, first, last, age) VALUES(201,&#x27;Kobe&#x27;, &#x27;Bryant&#x27;, 35)&quot;</span>;</span><br><span class="line">    <span class="comment">// Add above SQL statement in the batch.</span></span><br><span class="line">    stmt.addBatch(SQL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create one more SQL statement</span></span><br><span class="line">    SQL = <span class="string">&quot;UPDATE Employees SET age = 35 WHERE id = 100&quot;</span>;</span><br><span class="line">    <span class="comment">// Add above SQL statement in the batch.</span></span><br><span class="line">    stmt.addBatch(SQL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an int[] to hold returned values</span></span><br><span class="line">    <span class="type">int</span>[] count = stmt.executeBatch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Explicitly commit statements to apply changes</span></span><br><span class="line">    conn.commit();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Again, let us select all the records and display them.</span></span><br><span class="line">    printRows(stmt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clean-up environment</span></span><br><span class="line">    stmt.close();</span><br><span class="line">    conn.close();</span><br><span class="line">  &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">    <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">    se.printStackTrace();</span><br><span class="line">  &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">    <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    <span class="comment">//finally block used to close resources</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">        stmt.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">    &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">      se.printStackTrace();</span><br><span class="line">    &#125;<span class="comment">//end finally try</span></span><br><span class="line">  &#125;<span class="comment">//end try</span></span><br><span class="line">  System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">&#125;<span class="comment">//end main</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printRows</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;Displaying available rows...&quot;</span>);</span><br><span class="line">   <span class="comment">// Let us select all the records and display them.</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">   <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">      <span class="comment">//Retrieve by column name</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">   &#125;</span><br><span class="line">   System.out.println();</span><br><span class="line">   rs.close();</span><br><span class="line">&#125;<span class="comment">//end printRows()</span></span><br><span class="line">&#125;<span class="comment">//end JDBCExample</span></span><br></pre></td></tr></table></figure>
<h1 id="使用PrepareStatement对象进行批处理"><a href="#使用PrepareStatement对象进行批处理" class="headerlink" title="使用PrepareStatement对象进行批处理"></a>使用PrepareStatement对象进行批处理</h1><p>使用<code>PrepareStatement</code>对象进行批处理的典型步骤顺序：</p>
<ul>
<li>使用占位符创建 SQL 语句。</li>
<li>使用<code>prepareStatement()</code>方法创建<code>PrepareStatement</code>对象。</li>
<li>使用<code>setAutoCommit()</code>将自动提交设置为<code>false</code>。</li>
<li>使用<code>addBatch()</code>方法在创建的<code>Statement</code>对象上添加 SQL 语句到批处理中。</li>
<li>在创建的<code>Statement</code>对象上使用<code>executeBatch()</code>方法执行所有 SQL 语句。</li>
<li>最后，使用<code>commit()</code>方法提交所有更改。</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchingWithPrepareStatement</span> &#123;</span><br><span class="line">  <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Database credentials</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">// Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create SQL statement</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">SQL</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO Employees(id,first,last,age) VALUES(?, ?, ?, ?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create preparedStatemen</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      stmt = conn.prepareStatement(SQL);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set auto-commit to false</span></span><br><span class="line">      conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// First, let us select all the records and display them.</span></span><br><span class="line">      printRows(stmt);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the variables</span></span><br><span class="line">      stmt.setInt( <span class="number">1</span>, <span class="number">400</span> );</span><br><span class="line">      stmt.setString( <span class="number">2</span>, <span class="string">&quot;Python&quot;</span> );</span><br><span class="line">      stmt.setString( <span class="number">3</span>, <span class="string">&quot;Zhang&quot;</span> );</span><br><span class="line">      stmt.setInt( <span class="number">4</span>, <span class="number">33</span> );</span><br><span class="line">      <span class="comment">// Add it to the batch</span></span><br><span class="line">      stmt.addBatch();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the variables</span></span><br><span class="line">      stmt.setInt( <span class="number">1</span>, <span class="number">401</span> );</span><br><span class="line">      stmt.setString( <span class="number">2</span>, <span class="string">&quot;C++&quot;</span> );</span><br><span class="line">      stmt.setString( <span class="number">3</span>, <span class="string">&quot;Huang&quot;</span> );</span><br><span class="line">      stmt.setInt( <span class="number">4</span>, <span class="number">31</span> );</span><br><span class="line">      <span class="comment">// Add it to the batch</span></span><br><span class="line">      stmt.addBatch();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create an int[] to hold returned values</span></span><br><span class="line">      <span class="type">int</span>[] count = stmt.executeBatch();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Explicitly commit statements to apply changes</span></span><br><span class="line">      conn.commit();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Again, let us select all the records and display them.</span></span><br><span class="line">      printRows(stmt);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean-up environment</span></span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">          stmt.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">      &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">          conn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">        se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">    &#125;<span class="comment">//end try</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">  &#125;<span class="comment">//end main</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printRows</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Displaying available rows...&quot;</span>);</span><br><span class="line">    <span class="comment">// Let us select all the records and display them.</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">      <span class="comment">//Retrieve by column name</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">    rs.close();</span><br><span class="line">  &#125;<span class="comment">//end printRows()</span></span><br><span class="line">&#125;<span class="comment">//end JDBCExample</span></span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/JDBC/JDBC结果集"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/08/java/JDBC/JDBC%E7%BB%93%E6%9E%9C%E9%9B%86/"
    >JDBC 结果集</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/08/java/JDBC/JDBC%E7%BB%93%E6%9E%9C%E9%9B%86/" class="article-date">
  <time datetime="2021-03-08T07:51:24.000Z" itemprop="datePublished">2021-03-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JDBC/">JDBC</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>SQL语句执行后从数据库查询读取数据，返回的数据放在结果集中。<code>java.sql.ResultSet</code>接口表示数据库查询的结果集。</p>
<p><code>ResultSet</code>对象维护指向结果集中当前行的游标。 术语“结果集”是指包含在<code>ResultSet</code>对象中的行和列数据。</p>
<p><code>ResultSet</code>接口的方法可以分为三类：</p>
<ul>
<li>浏览方法：用于移动光标。</li>
<li>获取方法：用于查看光标指向的当前行的列中的数据。</li>
<li>更新方法：用于更新当前行的列中的数据。 然后在基础数据库中更新数据。</li>
</ul>
<p>光标可以基于<code>ResultSet</code>的属性移动。当创建生成<code>ResultSet</code>的相应<code>Statement</code>时，将指定这些属性。</p>
<p>JDBC 提供以下连接方法来创建具有所需<code>ResultSet</code>的语句：</p>
<ul>
<li><code>createStatement(int RSType, int RSConcurrency);</code></li>
<li><code>prepareStatement(String SQL, int RSType, int RSConcurrency);</code></li>
<li><code>prepareCall(String sql, int RSType, int RSConcurrency);</code></li>
</ul>
<p>第一个参数表示<code>ResultSet</code>对象的类型，第二个参数是两个<code>ResultSet</code>常量之一，用于指定结果集是只读还是可更新。</p>
<h2 id="ResultSet类型"><a href="#ResultSet类型" class="headerlink" title="ResultSet类型"></a>ResultSet类型</h2><p>可能的<code>RSType</code>值如下。如果不指定任何<code>ResultSet</code>类型，将自动分配一个<code>TYPE_FORWARD_ONLY</code>值。</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ResultSet.TYPE_FORWARD_ONLY</td>
<td align="center">光标只能在结果集中向前移动。</td>
</tr>
<tr>
<td align="center">ResultSet.TYPE_SCROLL_INSENSITIVE</td>
<td align="center">光标可以向前和向后滚动，结果集对创建结果集后发生的数据库所做的更改不敏感。</td>
</tr>
<tr>
<td align="center">ResultSet.TYPE_SCROLL_SENSITIVE</td>
<td align="center">光标可以向前和向后滚动，结果集对创建结果集之后发生的其他数据库的更改敏感。</td>
</tr>
</tbody></table>
<h2 id="ResultSet的并发性"><a href="#ResultSet的并发性" class="headerlink" title="ResultSet的并发性"></a>ResultSet的并发性</h2><p>可能的<code>RSConcurrency</code>如下。 如果不指定任何并发类型，将自动获得一个<code>CONCUR_READ_ONLY</code>值。</p>
<table>
<thead>
<tr>
<th align="center">并发</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ResultSet.CONCUR_READ_ONLY</td>
<td align="center">创建只读结果集，这是默认值。</td>
</tr>
<tr>
<td align="center">ResultSet.CONCUR_UPDATABLE</td>
<td align="center">创建可更新的结果集</td>
</tr>
</tbody></table>
<h2 id="浏览结果集"><a href="#浏览结果集" class="headerlink" title="浏览结果集"></a>浏览结果集</h2><p><code>ResultSet</code>接口中有几种涉及移动光标的方法，包括：</p>
<table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public void beforeFirst() throws SQLException</td>
<td align="center">将光标移动到第一行之前</td>
</tr>
<tr>
<td align="center">public void afterLast() throws SQLException</td>
<td align="center">将光标移动到最后一行之后</td>
</tr>
<tr>
<td align="center">public boolean first() throws SQLException</td>
<td align="center">将光标移动到第一行</td>
</tr>
<tr>
<td align="center">public void last() throws SQLException</td>
<td align="center">将光标移动到最后一行</td>
</tr>
<tr>
<td align="center">public boolean absolute(int row) throws SQLException</td>
<td align="center">将光标移动到指定的行</td>
</tr>
<tr>
<td align="center">public boolean relative(int row) throws SQLException</td>
<td align="center">从当前指向的位置，将光标向前或向后移动给定行数</td>
</tr>
<tr>
<td align="center">public boolean previous() throws SQLException</td>
<td align="center">将光标移动到上一行。 如果上一行关闭结果集，此方法返回false</td>
</tr>
<tr>
<td align="center">public boolean next() throws SQLException</td>
<td align="center">将光标移动到下一行。 如果结果集中没有更多行，则此方法返回false</td>
</tr>
<tr>
<td align="center">public int getRow() throws SQLException</td>
<td align="center">返回光标指向的行号</td>
</tr>
<tr>
<td align="center">public void moveToInsertRow() throws SQLException</td>
<td align="center">将光标移动到结果集中的特殊行，该行可用于将新行插入数据库。当前光标位置被记住</td>
</tr>
<tr>
<td align="center">public void moveToCurrentRow() throws SQLException</td>
<td align="center">如果光标当前位于插入行，则将光标移回当前行; 否则，此方法什么也不做</td>
</tr>
</tbody></table>
<h2 id="查看结果集"><a href="#查看结果集" class="headerlink" title="查看结果集"></a>查看结果集</h2><p><code>ResultSet</code>接口包含数十种获取当前行数据的方法。</p>
<p>每个可能的数据类型都有一个<code>get</code>方法，每个<code>get</code>方法有两个版本，一个是采用列名称。另一个采用列索引。</p>
<p>例如，如果对查看感兴趣的列包含一个<code>int</code>，则需要使用<code>ResultSet</code>的其中一个<code>getInt()</code>方法：</p>
<table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public int getInt(String columnName) throws SQLException</td>
<td align="center">返回名为columnName的列中当前行中的int值</td>
</tr>
<tr>
<td align="center">public int getInt(int columnIndex) throws SQLException</td>
<td align="center">返回指定列索引当前行中的int值。列索引从1开始，意味着行的第一列为1，行的第二列为2，依此类推</td>
</tr>
</tbody></table>
<p>类似地，在八个 Java 基元类型中的每一个的<code>ResultSet</code>接口中都有<code>get</code>方法，以及常见的类型，如<code>java.lang.String</code>，<code>java.lang.Object</code>和<code>java.net.URL</code>等。</p>
<h2 id="更新结果集"><a href="#更新结果集" class="headerlink" title="更新结果集"></a>更新结果集</h2><p><code>ResultSet</code>接口包含用于更新结果集的数据的更新方法的集合。</p>
<p>与<code>get</code>方法一样，每种数据类型都有两种更新方法：一个是采用列名称。另一个采用列索引。</p>
<p>例如，要更新结果集当前行的<code>String</code>列，可以使用以下<code>updateString()</code>方法之一：</p>
<table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public void updateString(int columnIndex, String s) throws SQLException</td>
<td align="center">将指定列中的String值更改为指定的s值</td>
</tr>
<tr>
<td align="center">public void updateString(String columnName, String s) throws SQLException</td>
<td align="center">与前面的方法类似，除了使用列的名称而不是列的索引指定</td>
</tr>
</tbody></table>
<p>有八种基本数据类型的更新方法，以及<code>java.sql</code>包中的<code>String，Object，URL</code>和 SQL 数据类型。</p>
<p>更新结果集中的一行会更改<code>ResultSet</code>对象中当前行的列，但不会更改底层数据库中的列的值。要更新数据库中的行，需要调用以下方法之一。</p>
<table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public void updateRow()</td>
<td align="center">更新数据库中当前行</td>
</tr>
<tr>
<td align="center">public void deleteRow()</td>
<td align="center">从数据库中删除当前行</td>
</tr>
<tr>
<td align="center">public void refreshRow()</td>
<td align="center">刷新结果集中的数据以反映数据库中最近的任何更改</td>
</tr>
<tr>
<td align="center">public void cancelRowUpdates()</td>
<td align="center">取消对当前行所做的任何更新</td>
</tr>
<tr>
<td align="center">public void insertRow()</td>
<td align="center">在数据库中插入一行。只有当光标指向插入行时，才能调用此方法</td>
</tr>
</tbody></table>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="浏览结果集-1"><a href="#浏览结果集-1" class="headerlink" title="浏览结果集"></a>浏览结果集</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavigatingResultSet</span> &#123;</span><br><span class="line">  <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Database credentials</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">      <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line">      <span class="comment">//STEP 4: Execute a query to create statment with</span></span><br><span class="line">      <span class="comment">// required arguments for RS example.</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);</span><br><span class="line">      String sql;</span><br><span class="line">      sql = <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">      <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Move cursor to the last row.</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Moving cursor to the last...&quot;</span>);</span><br><span class="line">      rs.last();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 5: Extract data from result set</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying record...&quot;</span>);</span><br><span class="line">      <span class="comment">//Retrieve by column name</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Move cursor to the first row.</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Moving cursor to the first row...&quot;</span>);</span><br><span class="line">      rs.first();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 6: Extract data from result set</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying record...&quot;</span>);</span><br><span class="line">      <span class="comment">//Retrieve by column name</span></span><br><span class="line">      id  = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      age = rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      first = rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      last = rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">      <span class="comment">// Move cursor to the first row.</span></span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;Moving cursor to the next row...&quot;</span>);</span><br><span class="line">      rs.next();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 7: Extract data from result set</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Displaying record...&quot;</span>);</span><br><span class="line">      id  = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      age = rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      first = rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      last = rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 8: Clean-up environment</span></span><br><span class="line">      rs.close();</span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">          stmt.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">      &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">          conn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">        se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">    &#125;<span class="comment">//end try</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">  &#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end JDBCExample</span></span><br></pre></td></tr></table></figure>
<h2 id="更新结果集-1"><a href="#更新结果集-1" class="headerlink" title="更新结果集"></a>更新结果集</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCExample</span> &#123;</span><br><span class="line">  <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Database credentials</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;username&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 4: Execute a query to create statment with</span></span><br><span class="line">      <span class="comment">// required arguments for RS example.</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);</span><br><span class="line">      <span class="comment">//STEP 5: Execute a query</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">      <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;List result set for reference....&quot;</span>);</span><br><span class="line">      printRs(rs);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 6: Loop through result set and add 5 in age</span></span><br><span class="line">      <span class="comment">//Move to BFR postion so while-loop works properly</span></span><br><span class="line">      rs.beforeFirst();</span><br><span class="line">      <span class="comment">//STEP 7: Extract data from result set</span></span><br><span class="line">      <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">        <span class="comment">//Retrieve by column name</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newAge</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>) + <span class="number">5</span>;</span><br><span class="line">        rs.updateDouble( <span class="string">&quot;age&quot;</span>, newAge );</span><br><span class="line">        rs.updateRow();</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">&quot;List result set showing new ages...&quot;</span>);</span><br><span class="line">      printRs(rs);</span><br><span class="line">      <span class="comment">// Insert a record into the table.</span></span><br><span class="line">      <span class="comment">//Move to insert row and add column data with updateXXX()</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Inserting a new record...&quot;</span>);</span><br><span class="line">      rs.moveToInsertRow();</span><br><span class="line">      rs.updateInt(<span class="string">&quot;id&quot;</span>,<span class="number">104</span>);</span><br><span class="line">      rs.updateString(<span class="string">&quot;first&quot;</span>,<span class="string">&quot;John&quot;</span>);</span><br><span class="line">      rs.updateString(<span class="string">&quot;last&quot;</span>,<span class="string">&quot;Paul&quot;</span>);</span><br><span class="line">      rs.updateInt(<span class="string">&quot;age&quot;</span>,<span class="number">40</span>);</span><br><span class="line">      <span class="comment">//Commit row</span></span><br><span class="line">      rs.insertRow();</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;List result set showing new set...&quot;</span>);</span><br><span class="line">      printRs(rs);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Delete second record from the table.</span></span><br><span class="line">      <span class="comment">// Set position to second record first</span></span><br><span class="line">      rs.absolute( <span class="number">2</span> );</span><br><span class="line">      System.out.println(<span class="string">&quot;List the record before deleting...&quot;</span>);</span><br><span class="line">      <span class="comment">//Retrieve by column name</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//Delete row</span></span><br><span class="line">      rs.deleteRow();</span><br><span class="line">      System.out.println(<span class="string">&quot;List result set after deleting one records...&quot;</span>);</span><br><span class="line">      printRs(rs);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 8: Clean-up environment</span></span><br><span class="line">      rs.close();</span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">   &#125; <span class="keyword">catch</span>(SQLException se) &#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">   &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">          conn.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">        se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">   &#125;<span class="comment">//end try</span></span><br><span class="line">   System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">  &#125;<span class="comment">//end main</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printRs</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="comment">//Ensure we start with first row</span></span><br><span class="line">    rs.beforeFirst();</span><br><span class="line">    <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">      <span class="comment">//Retrieve by column name</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Display values</span></span><br><span class="line">      System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">      System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">      System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">      System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">  &#125;<span class="comment">//end printRs()</span></span><br><span class="line">&#125;<span class="comment">//end JDBCExample</span></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-前端/css/故障风格文字动画"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/07/%E5%89%8D%E7%AB%AF/css/%E6%95%85%E9%9A%9C%E9%A3%8E%E6%A0%BC%E6%96%87%E5%AD%97%E5%8A%A8%E7%94%BB/"
    >故障风格文字动画</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/07/%E5%89%8D%E7%AB%AF/css/%E6%95%85%E9%9A%9C%E9%A3%8E%E6%A0%BC%E6%96%87%E5%AD%97%E5%8A%A8%E7%94%BB/" class="article-date">
  <time datetime="2021-03-07T09:41:12.000Z" itemprop="datePublished">2021-03-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a> / <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/CSS/">CSS</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <img src="/2021/03/07/%E5%89%8D%E7%AB%AF/css/%E6%95%85%E9%9A%9C%E9%A3%8E%E6%A0%BC%E6%96%87%E5%AD%97%E5%8A%A8%E7%94%BB/1.gif" class="">

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;txt&quot;</span> <span class="attr">data-text</span>=<span class="string">&quot;我是故障风格的文字&quot;</span>&gt;</span></span><br><span class="line">    我是故障风格的文字</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里使用了自定义属性，即<code>「data-」</code>加上我们自定义的属性名，我们将我们的文字内容作为该属性的值，方便之后伪元素获取到对应的文字。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> animation-before &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">5%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">8em</span> <span class="number">0</span> .<span class="number">4em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">10%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">4em</span> <span class="number">0</span> .<span class="number">8em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">15%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">1em</span> <span class="number">0</span> <span class="number">1em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">20%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">3em</span> <span class="number">0</span> .<span class="number">6em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">25%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">6em</span> <span class="number">0</span> .<span class="number">3em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">30%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">8em</span> <span class="number">0</span> .<span class="number">5em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">35%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">1em</span> <span class="number">0</span> .<span class="number">1em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">40%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">7em</span> <span class="number">0</span> .<span class="number">35em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">45%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">5em</span> <span class="number">0</span> .<span class="number">2em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">2em</span> <span class="number">0</span> .<span class="number">5em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">55%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">35em</span> <span class="number">0</span> .<span class="number">7em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">60%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">1em</span> <span class="number">0</span> .<span class="number">9em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">65%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">8em</span> <span class="number">0</span> .<span class="number">46em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">70%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">66em</span> <span class="number">0</span> .<span class="number">33em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">75%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">48em</span> <span class="number">0</span> .<span class="number">23em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">80%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">23em</span> <span class="number">0</span> .<span class="number">48em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">85%</span> &#123;</span><br><span class="line">      <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">39em</span> <span class="number">0</span> .<span class="number">79em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">90%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">33em</span> <span class="number">0</span> .<span class="number">66em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">95%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">1em</span> <span class="number">0</span> .<span class="number">3em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">62em</span> <span class="number">0</span> .<span class="number">29em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> animation-after&#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">5%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">4em</span> <span class="number">0</span> .<span class="number">8em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">10%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">8em</span> <span class="number">0</span> .<span class="number">4em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">15%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">1em</span> <span class="number">0</span> .<span class="number">1em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">20%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">6em</span> <span class="number">0</span> .<span class="number">3em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">25%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">3em</span> <span class="number">0</span> .<span class="number">6em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">30%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">5em</span> <span class="number">0</span> .<span class="number">8em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">35%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">1em</span> <span class="number">0</span> <span class="number">1em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">40%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">35em</span> <span class="number">0</span> .<span class="number">7em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">45%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">2em</span> <span class="number">0</span> .<span class="number">5em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">5em</span> <span class="number">0</span> .<span class="number">2em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">55%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">7em</span> <span class="number">0</span> .<span class="number">35em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">60%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">9em</span> <span class="number">0</span> .<span class="number">1em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">65%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">46em</span> <span class="number">0</span> .<span class="number">8em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">70%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">3em</span> <span class="number">0</span> .<span class="number">66em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">75%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">23em</span> <span class="number">0</span> .<span class="number">48em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">80%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">48em</span> <span class="number">0</span> .<span class="number">23em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">85%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">79em</span> <span class="number">0</span> .<span class="number">39em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">90%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">66em</span> <span class="number">0</span> .<span class="number">33em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">95%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">3em</span> <span class="number">0</span> <span class="number">1em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(.<span class="number">29em</span> <span class="number">0</span> .<span class="number">62em</span> <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们设置了两个<code>keyframes</code>，分别为<code>animation-before</code>、<code>animation-after</code>。前者是准备给我们后面的伪元素<code>before</code>使用的；后者是给我们后面的伪元素<code>after</code>使用的。</p>
<p><code>clip-path</code>是 css3 的一个新属性，叫做蒙版。</p>
<p>而其中的<code>inset()</code>值表示的是蒙版形状为矩形。<code>inset()</code>接收四个长度参数，分别表示蒙版距离元素标签的上侧、右侧、下侧、左侧的距离，从而决定了蒙版的大小。</p>
<p>当我们设置为<code>inset(0 0 0 0)</code>时，表示蒙版作用区域大小跟元素标签一样大。</p>
<img src="/2021/03/07/%E5%89%8D%E7%AB%AF/css/%E6%95%85%E9%9A%9C%E9%A3%8E%E6%A0%BC%E6%96%87%E5%AD%97%E5%8A%A8%E7%94%BB/1.jpg" class="">

<p>如果我们的设置为<code>inset(30px 0 0 0)</code>，则测试表示，蒙版的作用区域距离标签元素的上侧<code>30px</code>，距离其它的边<code>0px</code>。</p>
<img src="/2021/03/07/%E5%89%8D%E7%AB%AF/css/%E6%95%85%E9%9A%9C%E9%A3%8E%E6%A0%BC%E6%96%87%E5%AD%97%E5%8A%A8%E7%94%BB/2.jpg" class="">

<p>图中蓝色边框的部分不是蒙版的作用区域，因此我们无法看到该区域的内容，真实情况如下图所示。</p>
<img src="/2021/03/07/%E5%89%8D%E7%AB%AF/css/%E6%95%85%E9%9A%9C%E9%A3%8E%E6%A0%BC%E6%96%87%E5%AD%97%E5%8A%A8%E7%94%BB/3.jpg" class="">

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.txt</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">65px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.txt</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="comment">/* 获取文本 */</span></span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(data-text);</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="comment">/* 向左侧移2px */</span></span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">/* 将背景色设为与主背景同样的颜色，用于遮挡我们的标签元素 */</span></span><br><span class="line">  <span class="attribute">background</span>: black;</span><br><span class="line">  <span class="comment">/* 给before伪元素的文本添加左侧2px大小的红色文字阴影 */</span></span><br><span class="line">  <span class="attribute">text-shadow</span>:<span class="number">2px</span> <span class="number">0</span> red;</span><br><span class="line">  <span class="comment">/* 应用蒙版垂直变化动画，并一直循环 */</span></span><br><span class="line">  <span class="attribute">animation</span>: animation-before <span class="number">3s</span> infinite linear alternate-reverse;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.txt</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="comment">/* 获取文本 */</span></span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(data-text);</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="comment">/* 向左侧移2px */</span></span><br><span class="line">  <span class="attribute">left</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">/* 将背景色设为与主背景同样的颜色，用于遮挡我们的标签元素 */</span></span><br><span class="line">  <span class="attribute">background</span>: black;</span><br><span class="line">  <span class="comment">/* 给before伪元素的文本添加右侧2px大小的蓝色文字阴影 */</span></span><br><span class="line">  <span class="attribute">text-shadow</span>: -<span class="number">2px</span> <span class="number">0</span> blue;</span><br><span class="line">  <span class="comment">/* 应用蒙版垂直变化动画，并一直循环 */</span></span><br><span class="line">  <span class="attribute">animation</span>: animation-after <span class="number">3s</span> infinite linear alternate-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，我们设置了两个伪元素<code>before</code>和<code>after</code>，分别定位到跟父元素同样的位置，然后分别向左、右侧移一点点的距离，制作一个错位的效果，然后都将背景色设置为与父元素背景色一样的颜色，用于遮挡父元素。</p>
<p>然后设置了蒙版垂直变化动画以后，被蒙版遮挡的部分虽然看不到了，但是会露出下面一层的父元素内容，这样就可以实现了一个完美的故障风格的文字展示动画了。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/JDBC/JDBC Statements"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/06/java/JDBC/JDBC%20Statements/"
    >JDBC Statements</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/06/java/JDBC/JDBC%20Statements/" class="article-date">
  <time datetime="2021-03-06T09:24:42.000Z" itemprop="datePublished">2021-03-06</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JDBC/">JDBC</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>当获得了与数据库的连接后，就可以与数据库进行交互了。JDBC <code>Statement</code>，<code>CallableStatement</code>和<code>PreparedStatement</code>接口定义了可用于发送 SQL 的命令，并从数据库接收数据的方法和属性。还定义了有助于在 Java 和 SQL 数据类型的数据类型差异转换的方法。</p>
<table>
<thead>
<tr>
<th align="center">接口</th>
<th align="center">推荐使用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Statement</td>
<td align="center">用于对数据库进行通用访问，在运行时使用静态SQL语句时很有用。Statement接口不能接受参数</td>
</tr>
<tr>
<td align="center">PreparedStatement</td>
<td align="center">当计划要多次使用SQL语句时使用。<br>PreparedStatement接口在运行时接受输入参数</td>
</tr>
<tr>
<td align="center">CallableStatement</td>
<td align="center">当想要访问数据库存储过程时使用。<br>CallableStatement接口也可以接受运行时输入参数</td>
</tr>
</tbody></table>
<h1 id="Statement对象"><a href="#Statement对象" class="headerlink" title="Statement对象"></a>Statement对象</h1><h2 id="1-创建Statement对象"><a href="#1-创建Statement对象" class="headerlink" title="1. 创建Statement对象"></a>1. 创建Statement对象</h2><p>在使用<code>Statement</code>对象执行 SQL 语句之前，需要使用<code>Connection</code>对象的<code>createStatement()</code>方法创建一个<code>Statement</code>对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  stmt = conn.createStatement( );</span><br><span class="line">  . . .</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  . . .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在创建<code>Statement</code>对象后，可以使用它来执行一个 SQL 语句，它有三个执行方法可以执行：</p>
<ul>
<li><code>boolean execute (String SQL)</code>： 如果可以检索到<code>ResultSet</code>对象，则返回一个布尔值<code>true</code>; 否则返回<code>false</code>。使用此方法执行 SQL DDL 语句或需要使用真正的动态 SQL，可使用于执行创建数据库，创建表的 SQL 语句等等。</li>
<li><code>int executeUpdate (String SQL)</code>：返回受 SQL 语句执行影响的行数。使用此方法执行预期会影响多行的 SQL 语句，例如:<code>INSERT，UPDATE</code>或<code>DELETE</code>语句。</li>
<li><code>ResultSet executeQuery(String SQL)</code>：返回一个<code>ResultSet</code>对象。 当您希望获得结果集时，请使用此方法，就像使用<code>SELECT</code>语句一样。</li>
</ul>
<h2 id="2-关闭Statement对象"><a href="#2-关闭Statement对象" class="headerlink" title="2. 关闭Statement对象"></a>2. 关闭Statement对象</h2><p>就像关闭一个<code>Connection</code>对象一样，以保存数据库资源一样，由于同样的原因，还应该关闭<code>Statement</code>对象。</p>
<p>一个简单的调用<code>close()</code>方法将执行该工作。如果先关闭<code>Connection</code>对象，它也会关闭<code>Statement</code>对象。但是，应该始终显式关闭<code>Statement</code>对象，以确保正确的清理顺序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  stmt = conn.createStatement();</span><br><span class="line">  . . .</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  stmt.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="PreparedStatement对象"><a href="#PreparedStatement对象" class="headerlink" title="PreparedStatement对象"></a>PreparedStatement对象</h1><p><code>PreparedStatement</code>接口扩展了<code>Statement</code>接口，它添加了比<code>Statement</code>对象更好一些优点的功能。此语句可以动态地提供&#x2F;接受参数。</p>
<h2 id="1-创建PreparedStatement对象"><a href="#1-创建PreparedStatement对象" class="headerlink" title="1 创建PreparedStatement对象"></a>1 创建PreparedStatement对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">SQL</span> <span class="operator">=</span> <span class="string">&quot;Update Employees SET age = ? WHERE id = ?&quot;</span>;</span><br><span class="line">  pstmt = conn.prepareStatement(SQL);</span><br><span class="line">  pstmt.setInt(<span class="number">1</span>, <span class="number">16</span>);</span><br><span class="line">  pstmt.setInt(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">  <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> stmt.executeUpdate();</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  . . .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JDBC 中的所有参数都由<code>?</code>符号作为占位符，这被称为参数标记。在执行SQL语句之前，必须为每个参数(占位符)提供值。</p>
<p><code>setXXX()</code>方法将值绑定到参数，其中<code>XXX</code>表示要绑定到输入参数的值的 Java 数据类型。如果忘记提供绑定值，则将会抛出一个<code>SQLException</code>。</p>
<p>每个参数标记是它其顺序位置引用。第一个标记表示位置1，下一个位置2等等。</p>
<p>所有<code>Statement</code>对象与数据库交互的方法<code>execute()</code>，<code>executeQuery()</code>和<code>executeUpdate()</code>也可以用于<code>PreparedStatement</code>对象。 但是，这些方法被修改为可以使用输入参数的 SQL 语句。</p>
<h2 id="2-关闭PreparedStatement对象"><a href="#2-关闭PreparedStatement对象" class="headerlink" title="2. 关闭PreparedStatement对象"></a>2. 关闭PreparedStatement对象</h2><p>就像关闭<code>Statement</code>对象一样，由于同样的原因，也应该关闭<code>PreparedStatement</code>对象。</p>
<p>简单的调用<code>close()</code>方法将执行关闭。如果先关闭<code>Connection</code>对象，它也会关闭<code>PreparedStatement</code>对象。但是，应该始终显式关闭<code>PreparedStatement</code>对象，以确保以正确顺序清理资源。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">SQL</span> <span class="operator">=</span> <span class="string">&quot;Update Employees SET age = ? WHERE id = ?&quot;</span>;</span><br><span class="line">  pstmt = conn.prepareStatement(SQL);</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  pstmt.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CallableStatement对象"><a href="#CallableStatement对象" class="headerlink" title="CallableStatement对象"></a>CallableStatement对象</h1><p>类似<code>Connection</code>对象创建<code>Statement</code>和<code>PreparedStatement</code>对象一样，它还可以使用同样的方式创建<code>CallableStatement</code>对象，该对象将用于执行对数据库存储过程的调用。</p>
<h2 id="1-创建CallableStatement对象"><a href="#1-创建CallableStatement对象" class="headerlink" title="1. 创建CallableStatement对象"></a>1. 创建CallableStatement对象</h2><p>假设需要执行以下 MySQL 存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> `EMP`.`getEmpName` $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> `EMP`.`getEmpName` </span><br><span class="line">  (<span class="keyword">IN</span> EMP_ID <span class="type">INT</span>, <span class="keyword">OUT</span> EMP_FIRST <span class="type">VARCHAR</span>(<span class="number">255</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">first</span> <span class="keyword">INTO</span> EMP_FIRST</span><br><span class="line">  <span class="keyword">FROM</span> Employees</span><br><span class="line">  <span class="keyword">WHERE</span> ID <span class="operator">=</span> EMP_ID;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>存在三种类型的参数：<code>IN，OUT</code>和<code>INOUT</code>。<code>PreparedStatement</code>对象只使用<code>IN</code>参数。<code>CallableStatement</code>对象可以使用上面三个参数类型。</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IN</td>
<td align="center">创建SQL语句时其参数值是未知的。 使用 setXXX() 方法将值绑定到IN参数</td>
</tr>
<tr>
<td align="center">OUT</td>
<td align="center">由SQL语句返回的参数值。可以使用 getXXX() 方法从OUT参数中检索值</td>
</tr>
<tr>
<td align="center">INOUT</td>
<td align="center">提供输入和输出值的参数。使用 setXXX() 方法绑定变量并使用 getXXX() 方法检索值</td>
</tr>
</tbody></table>
<p>以下代码片段显示了如何使用<code>Connection.prepareCall()</code>方法根据上述存储过程来实例化一个<code>CallableStatement</code>对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CallableStatement</span> <span class="variable">cstmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">strSQL</span> <span class="operator">=</span> <span class="string">&quot;&#123;call getEmpName (?, ?)&#125;&quot;</span>;</span><br><span class="line">  cstmt = conn.prepareCall (SQL);</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  . . .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>String</code>变量<code>strSQL</code>表示存储过程，带有两个参数占位符。</p>
<p>使用<code>CallableStatement</code>对象就像使用<code>PreparedStatement</code>对象一样。 在执行语句之前，必须将值绑定到所有参数，否则将抛出一个<code>SQLException</code>异常。</p>
<p>如果有<code>IN</code>参数，只需遵循适用于<code>PreparedStatement</code>对象的相同规则和技术; 使用与绑定的 Java 数据类型相对应的<code>setXXX()</code>方法。</p>
<p>使用<code>OUT</code>和<code>INOUT</code>参数时，必须使用一个额外的<code>CallableStatement</code>对象方法<code>registerOutParameter()</code>。<code>registerOutParameter()</code>方法将 JDBC 数据类型绑定到存储过程并返回预期数据类型。</p>
<p>当调用存储过程，可以使用适当的<code>getXXX()</code>方法从<code>OUT</code>参数中检索该值。此方法将检索到的 SQL 类型的值转换为对应的 Java 数据类型。</p>
<h2 id="2-关闭CallableStatement对象"><a href="#2-关闭CallableStatement对象" class="headerlink" title="2. 关闭CallableStatement对象"></a>2. 关闭CallableStatement对象</h2><p>就像关闭其他<code>Statement</code>对象一样，由于同样的原因，还应该关闭<code>CallableStatement</code>对象。</p>
<p>简单的调用<code>close()</code>方法将执行关闭<code>CallableStatement</code>对象。 如果先关闭<code>Connection</code>对象，它也会关闭<code>CallableStatement</code>对象。但是，应该始终显式关闭<code>CallableStatement</code>对象，以确保按正确顺序的清理资源。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CallableStatement</span> <span class="variable">cstmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">SQL</span> <span class="operator">=</span> <span class="string">&quot;&#123;call getEmpName (?, ?)&#125;&quot;</span>;</span><br><span class="line">  cstmt = conn.prepareCall (SQL);</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  . . .</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  cstmt.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="Statements示例"><a href="#Statements示例" class="headerlink" title="Statements示例"></a>Statements示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCStatment</span> &#123;</span><br><span class="line">   <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  Database credentials</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 4: Execute a query</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      stmt = conn.createStatement();</span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE Employees set age=30 WHERE id=103&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Let us check if it returns a true Result Set or not.</span></span><br><span class="line">      <span class="type">Boolean</span> <span class="variable">ret</span> <span class="operator">=</span> stmt.execute(sql);</span><br><span class="line">      System.out.println(<span class="string">&quot;Return value is : &quot;</span> + ret.toString() );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Let us update age of the record with ID = 103;</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> stmt.executeUpdate(sql);</span><br><span class="line">      System.out.println(<span class="string">&quot;Rows impacted : &quot;</span> + rows );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Let us select all the records and display them.</span></span><br><span class="line">      sql = <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">      <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 5: Extract data from result set</span></span><br><span class="line">      <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">         <span class="comment">//Retrieve by column name</span></span><br><span class="line">         <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">         <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//Display values</span></span><br><span class="line">         System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">         System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">         System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">         System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//STEP 6: Clean-up environment</span></span><br><span class="line">      rs.close();</span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">   &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">            stmt.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">      &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            conn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">         se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">   &#125;<span class="comment">//end try</span></span><br><span class="line">   System.out.println(<span class="string">&quot;There are something wrong!&quot;</span>);</span><br><span class="line">&#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end JDBCStatment</span></span><br></pre></td></tr></table></figure>
<h2 id="PreparedStatement示例"><a href="#PreparedStatement示例" class="headerlink" title="PreparedStatement示例"></a>PreparedStatement示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="comment">// detail at http://www.yiibai.com/jdbc/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCPreparedStatement</span> &#123;</span><br><span class="line">   <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  Database credentials</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 4: Execute a query</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE Employees set age=? WHERE id=?&quot;</span>;</span><br><span class="line">      stmt = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Bind values into the parameters.</span></span><br><span class="line">      stmt.setInt(<span class="number">1</span>, <span class="number">35</span>);  <span class="comment">// This would set age</span></span><br><span class="line">      stmt.setInt(<span class="number">2</span>, <span class="number">102</span>); <span class="comment">// This would set ID</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Let us update age of the record with ID = 102;</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> stmt.executeUpdate();</span><br><span class="line">      System.out.println(<span class="string">&quot;Rows impacted : &quot;</span> + rows );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Let us select all the records and display them.</span></span><br><span class="line">      sql = <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">      <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 5: Extract data from result set</span></span><br><span class="line">      <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">         <span class="comment">//Retrieve by column name</span></span><br><span class="line">         <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">         <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//Display values</span></span><br><span class="line">         System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">         System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">         System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">         System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//STEP 6: Clean-up environment</span></span><br><span class="line">      rs.close();</span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">   &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">            stmt.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">      &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            conn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">         se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">   &#125;<span class="comment">//end try</span></span><br><span class="line">   System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">&#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end JDBCPreparedStatement</span></span><br></pre></td></tr></table></figure>
<h2 id="CallableStatement示例"><a href="#CallableStatement示例" class="headerlink" title="CallableStatement示例"></a>CallableStatement示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCCallableStatement</span> &#123;</span><br><span class="line">   <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/EMP&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  Database credentials</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">CallableStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 4: Execute a query</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;&#123;call getEmpName (?, ?)&#125;&quot;</span>;</span><br><span class="line">      stmt = conn.prepareCall(sql);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Bind IN parameter first, then bind OUT parameter</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">empID</span> <span class="operator">=</span> <span class="number">102</span>;</span><br><span class="line">      stmt.setInt(<span class="number">1</span>, empID); <span class="comment">// This would set ID as 102</span></span><br><span class="line">      <span class="comment">// Because second parameter is OUT so register it</span></span><br><span class="line">      stmt.registerOutParameter(<span class="number">2</span>, java.sql.Types.VARCHAR);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Use execute method to run stored procedure.</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Executing stored procedure...&quot;</span> );</span><br><span class="line">      stmt.execute();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Retrieve employee name with getXXX method</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">empName</span> <span class="operator">=</span> stmt.getString(<span class="number">2</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;Emp Name with ID:&quot;</span> + </span><br><span class="line">               empID + <span class="string">&quot; is &quot;</span> + empName);</span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">   &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">            stmt.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">      &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            conn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">         se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">   &#125;<span class="comment">//end try</span></span><br><span class="line">   System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">&#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end JDBCExample</span></span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/JDBC/JDBC数据库连接"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/05/java/JDBC/JDBC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/"
    >JDBC 数据库连接</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/05/java/JDBC/JDBC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/" class="article-date">
  <time datetime="2021-03-05T03:01:11.000Z" itemprop="datePublished">2021-03-05</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JDBC/">JDBC</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>安装相应的驱动程序后，就可以使用JDBC建立数据库连接了。</p>
<p>建立JDBC连接的四个步骤：</p>
<ul>
<li>导入JDBC包：使用<code>import</code>语句在 Java 代码开头位置导入所需的类。</li>
<li>注册JDBC驱动程序：使 JVM 将所需的驱动程序实现加载到内存中，从而可以满足 JDBC 请求。</li>
<li>数据库URL配置：创建一个正确格式化的地址，指向要连接到的数据库。</li>
<li>创建连接对象：最后，调用<code>DriverManager</code>对象的<code>getConnection()</code>方法来建立实际的数据库连接。</li>
</ul>
<h1 id="导入JDBC包"><a href="#导入JDBC包" class="headerlink" title="导入JDBC包"></a>导入JDBC包</h1><p><code>import</code>语句告诉 Java 编译器在哪里找到在代码中引用的类，<code>import</code>语句一般放置在源代码的开头。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.* ;  <span class="comment">// for standard JDBC programs</span></span><br></pre></td></tr></table></figure>
<h1 id="注册JDBC驱动程序"><a href="#注册JDBC驱动程序" class="headerlink" title="注册JDBC驱动程序"></a>注册JDBC驱动程序</h1><p>在使用程序之前，必须先注册该驱动程序。注册驱动程序是将数据库驱动程序的类文件加载到内存中的过程，因此可以将其用作JDBC接口的实现。</p>
<p>只需在程序中一次注册就可以。可以通过两种方式之一来注册驱动程序。</p>
<h2 id="方法1-Class-forName"><a href="#方法1-Class-forName" class="headerlink" title="方法1 - Class.forName()"></a>方法1 - Class.forName()</h2><p>注册驱动程序最常见的方法是使用 Java 的<code>Class.forName()</code>方法，将驱动程序的类文件动态加载到内存中，并将其自动注册。这个方法是推荐使用的方法，因为它使驱动程序注册可配置和便携。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://hostname:port/db_name&quot;</span>,<span class="string">&quot;db_username&quot;</span>, <span class="string">&quot;db_password&quot;</span>);</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>
<p>使用<code>getInstance()</code>方法来解决不合规的 JVM，但是必须编写两个额外的异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>).newInstance();</span><br><span class="line">&#125; <span class="keyword">catch</span>(ClassNotFoundException ex) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;Error: unable to load driver class!&quot;</span>);</span><br><span class="line">  System.exit(<span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(IllegalAccessException ex) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;Error: access problem while loading!&quot;</span>);</span><br><span class="line">  System.exit(<span class="number">2</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(InstantiationException ex) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;Error: unable to instantiate driver!&quot;</span>);</span><br><span class="line">  System.exit(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方法2-DriverManager-registerDriver"><a href="#方法2-DriverManager-registerDriver" class="headerlink" title="方法2 - DriverManager.registerDriver()"></a>方法2 - DriverManager.registerDriver()</h2><p>第二种方法是使用静态<code>DriverManager.registerDriver()</code>方法来注册驱动程序。</p>
<p>如果使用的是非 JDK 兼容的 JVM(如 Microsoft 提供的)，则应使用<code>registerDriver()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">Driver</span> <span class="variable">myDriver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">oracle</span>.jdbc.driver.OracleDriver();</span><br><span class="line">  DriverManager.registerDriver( myDriver );</span><br><span class="line">&#125; <span class="keyword">catch</span>(ClassNotFoundException ex) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;Error: unable to load driver class!&quot;</span>);</span><br><span class="line">  System.exit(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数据库-URL-配置"><a href="#数据库-URL-配置" class="headerlink" title="数据库 URL 配置"></a>数据库 URL 配置</h1><p>加载驱动程序后，可以使用<code>DriverManager.getConnection()</code>方法建立连接。</p>
<p>三个重载的<code>DriverManager.getConnection()</code>方法：</p>
<ul>
<li><code>getConnection(String url)</code></li>
<li><code>getConnection(String url, Properties prop)</code></li>
<li><code>getConnection(String url, String user, String password)</code></li>
</ul>
<p>这里每个格式都需要一个数据库 URL。数据库URL是指向数据库的地址。</p>
<p>下表列出了常用的 JDBC 驱动程序名称和数据库 URL。</p>
<table>
<thead>
<tr>
<th align="center">RDBMS</th>
<th align="center">JDBC驱动程序名称</th>
<th align="center">URL格式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">MySQL</td>
<td align="center">com.mysql.jdbc.Driver</td>
<td align="center">jdbc:mysql:&#x2F;&#x2F;hostname&#x2F;databaseName</td>
</tr>
<tr>
<td align="center">ORACLE</td>
<td align="center">oracle.jdbc.driver.OracleDriver</td>
<td align="center">jdbc:oracle:thin:@hostname:portNumber:databaseName</td>
</tr>
<tr>
<td align="center">DB2</td>
<td align="center">com.ibm.db2.jdbc.net.DB2Driver</td>
<td align="center">jdbc:db2:hostname:port Number&#x2F;databaseName</td>
</tr>
</tbody></table>
<h1 id="创建连接对象"><a href="#创建连接对象" class="headerlink" title="创建连接对象"></a>创建连接对象</h1><p>上面列出了三种形式的<code>DriverManager.getConnection()</code>方法来创建一个连接对象。</p>
<h2 id="使用具有用户名和密码的数据库URL"><a href="#使用具有用户名和密码的数据库URL" class="headerlink" title="使用具有用户名和密码的数据库URL"></a>使用具有用户名和密码的数据库URL</h2><p><code>getConnection()</code>最常用的形式要求传递数据库URL，用户名和密码。</p>
<p>假设使用Oracle thin驱动程序，那么需要为 URL 的数据库部分指定：<code>host:port:databaseName</code>值。</p>
<p>如果主机名为<code>amrood</code>的TCP&#x2F;IP地址为<code>192.0.0.10</code>，并且 Oracle 侦听器配置为侦听端口 1521，并且要连接的数据库名称是<code>EMP</code>，则完整的数据库 URL 将是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdbc:oracle:thin:@amrood:1521:EMP</span><br><span class="line">// 或者</span><br><span class="line">jdbc:oracle:thin:@192.0.0.10:1521:EMP</span><br></pre></td></tr></table></figure>
<p>现在必须使用适当的用户名和密码调用<code>getConnection()</code>方法获取一个<code>Connection</code>对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:oracle:thin:@amrood:1521:EMP&quot;</span>;</span><br><span class="line"><span class="comment">// String URL = &quot;jdbc:oracle:thin:@192.0.0.10:1521:EMP&quot;;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;username&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;password&quot;</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(URL, USER, PASS);</span><br></pre></td></tr></table></figure>
<h2 id="仅使用数据库URL"><a href="#仅使用数据库URL" class="headerlink" title="仅使用数据库URL"></a>仅使用数据库URL</h2><p><code>DriverManager.getConnection()</code>方法的第二种形式只需要数据库 URL。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DriverManager.getConnection(String url);</span><br></pre></td></tr></table></figure>
<p>但是，数据库 URL 包括用户名和密码，并具有以下一般形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:oracle:driver:username/password@database</span><br></pre></td></tr></table></figure>
<p>所以，上述连接可以使用如下方式创建：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:oracle:thin:username/password@192.168.0.10:1521:EMP&quot;</span>;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(URL);</span><br></pre></td></tr></table></figure>
<p>使用数据库 URL 和<code>Properties</code>对象<code>DriverManager.getConnection()</code>方法的第三种形式需要一个数据库 URL 和一个<code>Properties</code>对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DriverManager.getConnection(String url, Properties info);</span><br></pre></td></tr></table></figure>
<p><code>Properties</code>对象包含一组键-值对。在调用<code>getConnection()</code>方法时，它用于将驱动程序属性传递给驱动程序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:oracle:thin:@amrood:1521:EMP&quot;</span>;</span><br><span class="line"><span class="type">Properties</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>( );</span><br><span class="line">info.put( <span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span> );</span><br><span class="line">info.put( <span class="string">&quot;password&quot;</span>, <span class="string">&quot;password12321&quot;</span> );</span><br><span class="line"></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(URL, info);</span><br></pre></td></tr></table></figure>
<h1 id="关闭JDBC连接"><a href="#关闭JDBC连接" class="headerlink" title="关闭JDBC连接"></a>关闭JDBC连接</h1><p>在JDBC程序结束之后，显式地需要关闭与数据库的所有连接以结束每个数据库会话。</p>
<p>但是，如果在编写程序中忘记了关闭也没有关系，Java的垃圾收集器将在清除过时的对象时也会关闭这些连接。依靠垃圾收集，是一个非常差的实践。所以应该要使用与连接对象关联的<code>close()</code>方法关闭连接。</p>
<p>要确保连接已关闭，可以将关闭连接的代码中编写在<code>finally</code>块中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.close();</span><br></pre></td></tr></table></figure>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectDatabase</span> &#123;</span><br><span class="line">  <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/jdbc_db&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Database credentials</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Connecting to a selected database...&quot;</span>);</span><br><span class="line">    conn = DriverManager.getConnection(DB_URL, USER, PASS);</span><br><span class="line">    System.out.println(<span class="string">&quot;Connected database successfully...&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">    <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">    se.printStackTrace();</span><br><span class="line">  &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">    <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    <span class="comment">//finally block used to close resources</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">          conn.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">        se.printStackTrace();</span><br><span class="line">    &#125;<span class="comment">//end finally try</span></span><br><span class="line">  &#125;<span class="comment">//end try</span></span><br><span class="line">  System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">&#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end JDBCExample</span></span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/JDBC/JDBC入门"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/03/java/JDBC/JDBC%E5%85%A5%E9%97%A8/"
    >JDBC 入门</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/03/java/JDBC/JDBC%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2021-03-03T10:01:52.000Z" itemprop="datePublished">2021-03-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JDBC/">JDBC</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><code>JDBC</code>代表 Java 数据库连接(<code>Java Database Connectivity</code>)，<code>JDBC</code>是用于在 Java 语言编程中与数据库连接的 API。</p>
<p><code>JDBC</code>库中所包含的 API 通常使用于：</p>
<ul>
<li>连接到数据库</li>
<li>创建<code>SQL</code>或 MySQL 语句</li>
<li>在数据库中执行<code>SQL</code>或 MySQL 查询</li>
<li>查看和修改数据库中的数据记录</li>
</ul>
<h1 id="常见的JDBC组件"><a href="#常见的JDBC组件" class="headerlink" title="常见的JDBC组件"></a>常见的JDBC组件</h1><p>JDBC API提供以下接口和类：</p>
<ol>
<li><code>DriverManager</code><br>此类管理数据库驱动程序列表。 使用通信子协议将来自 Java 应用程序的连接请求与适当的数据库驱动程序进行匹配。在<code>JDBC</code>下识别某个子协议的第一个驱动程序将用于建立数据库连接。</li>
<li><code>Driver</code><br>此接口处理与数据库服务器的通信。<code>Driver</code>接口由数据库厂家提供，使用<code>DriverManager</code>对象来管理这种类型的对象。</li>
<li><code>Connection</code><br>此接口具有用于联系数据库的所有方法。 连接(<code>Connection</code>)对象表示通信上下文，即，与数据库的所有通信仅通过连接对象。</li>
<li><code>Statement</code><br>使用从此接口创建的对象将SQL语句提交到数据库。 除了执行存储过程之外，一些派生接口还接受参数。</li>
<li><code>ResultSet</code><br>在使用<code>Statement</code>对象执行SQL查询后，这些对象保存从数据库检索的数据。 它作为一个迭代器并可移动<code>ResultSet</code>对象查询的数据。</li>
<li><code>SQLException</code><br>此类处理数据库应用程序中发生的任何错误。</li>
</ol>
<h1 id="创建JDBC应用程序"><a href="#创建JDBC应用程序" class="headerlink" title="创建JDBC应用程序"></a>创建JDBC应用程序</h1><p>建立一个<code>JDBC</code>应用程序，分六个步骤进行：</p>
<h2 id="1-导入包"><a href="#1-导入包" class="headerlink" title="1. 导入包"></a>1. 导入包</h2><p>在程序中导入编程所需的 JDBC 类。大多数情况下，使用<code>import java.sql.*</code>就足够了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br></pre></td></tr></table></figure>
<h2 id="2-注册JDBC驱动程序"><a href="#2-注册JDBC驱动程序" class="headerlink" title="2. 注册JDBC驱动程序"></a>2. 注册JDBC驱动程序</h2><p>需要初始化驱动程序，这样就可以打开与数据库的通信。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="3-打开一个连接"><a href="#3-打开一个连接" class="headerlink" title="3. 打开一个连接"></a>3. 打开一个连接</h2><p>使用<code>DriverManager.getConnection()</code>方法来创建一个<code>Connection</code>对象，它代表一个数据库的物理连接：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 3: Open a connection</span></span><br><span class="line"><span class="comment">//  Database credentials</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;pwd123456&quot;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(DB_URL,USER,PASS);</span><br></pre></td></tr></table></figure>
<h2 id="4-执行一个查询"><a href="#4-执行一个查询" class="headerlink" title="4. 执行一个查询"></a>4. 执行一个查询</h2><p>需要使用一个类型为<code>Statement</code>或<code>PreparedStatement</code>的对象，并提交一个 SQL 语句到数据库执行查询。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 4: Execute a query</span></span><br><span class="line">System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">stmt = conn.createStatement();</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br></pre></td></tr></table></figure>
<p>如果要执行一个 SQL 语句：<code>UPDATE，INSERT</code>或<code>DELETE</code>语句，需要用<code>executeUpdate</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 4: Execute a query</span></span><br><span class="line">System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">stmt = conn.createStatement();</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;DELETE FROM Employees&quot;</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure>
<h2 id="5-从结果集中提取数据"><a href="#5-从结果集中提取数据" class="headerlink" title="5. 从结果集中提取数据"></a>5. 从结果集中提取数据</h2><p>从数据库中获取查询结果的数据。可以使用适当的<code>ResultSet.getXXX()</code>方法来检索的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 5: Extract data from result set</span></span><br><span class="line"><span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">   <span class="comment">//Retrieve by column name</span></span><br><span class="line">   <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">   <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">   <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">   <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//Display values</span></span><br><span class="line">   System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">   System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">   System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">   System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-释放资源"><a href="#6-释放资源" class="headerlink" title="6. 释放资源"></a>6. 释放资源</h2><p>清理环境资源在使用 JDBC 与数据交互操作数据库中的数据后，应该明确地关闭所有的数据库资源以减少资源的浪费，对依赖于 JVM 的垃圾收集：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 6: Clean-up environment</span></span><br><span class="line">rs.close();</span><br><span class="line">stmt.close();</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//STEP 1. Import required packages</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FirstExample</span> &#123;</span><br><span class="line">  <span class="comment">// JDBC driver name and database URL</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JDBC_DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost/test&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Database credentials -- 数据库名和密码自己修改</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;username&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASS</span> <span class="operator">=</span> <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//STEP 2: Register JDBC driver</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 3: Open a connection</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Connecting to database...&quot;</span>);</span><br><span class="line">      conn = DriverManager.getConnection(DB_URL,USER,PASS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 4: Execute a query</span></span><br><span class="line">      System.out.println(<span class="string">&quot;Creating statement...&quot;</span>);</span><br><span class="line">      stmt = conn.createStatement();</span><br><span class="line">      String sql;</span><br><span class="line">      sql = <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line">      <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//STEP 5: Extract data from result set</span></span><br><span class="line">      <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">        <span class="comment">//Retrieve by column name</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span>  <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;last&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Display values</span></span><br><span class="line">        System.out.print(<span class="string">&quot;ID: &quot;</span> + id);</span><br><span class="line">        System.out.print(<span class="string">&quot;, Age: &quot;</span> + age);</span><br><span class="line">        System.out.print(<span class="string">&quot;, First: &quot;</span> + first);</span><br><span class="line">        System.out.println(<span class="string">&quot;, Last: &quot;</span> + last);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//STEP 6: Clean-up environment</span></span><br><span class="line">      rs.close();</span><br><span class="line">      stmt.close();</span><br><span class="line">      conn.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(SQLException se) &#123;</span><br><span class="line">      <span class="comment">//Handle errors for JDBC</span></span><br><span class="line">      se.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      <span class="comment">//Handle errors for Class.forName</span></span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">      <span class="comment">//finally block used to close resources</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(stmt!=<span class="literal">null</span>)</span><br><span class="line">          stmt.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span>(SQLException se2)&#123;</span><br><span class="line">      &#125;<span class="comment">// nothing we can do</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">          conn.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">        se.printStackTrace();</span><br><span class="line">      &#125;<span class="comment">//end finally try</span></span><br><span class="line">    &#125;<span class="comment">//end try</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Goodbye!&quot;</span>);</span><br><span class="line">  &#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end FirstExample</span></span><br></pre></td></tr></table></figure>
<h1 id="JDBC-数据类型"><a href="#JDBC-数据类型" class="headerlink" title="JDBC 数据类型"></a>JDBC 数据类型</h1><p>JDBC驱动程序将 Java 数据类型转换为适当的JDBC类型，然后将其发送到数据库。它为大多数数据类型提供并使用默认映射。例如，Java <code>int</code>类型会被转换为 SQL <code>INTEGER</code>。 创建默认映射以提供到驱动程序时保持一致性。</p>
<p>下表总结了当调用<code>PreparedStatement</code>或<code>CallableStatement</code>对象或<code>ResultSet.updateXXX()</code>方法的<code>setXXX()</code>方法时，将 Java 数据类型转换为的默认 JDBC 数据类型。</p>
<table>
<thead>
<tr>
<th align="center">SQL类型</th>
<th align="center">JDBC&#x2F;Java类型</th>
<th align="center">setXXX</th>
<th align="center">updateXXX</th>
<th align="center">getXXX</th>
</tr>
</thead>
<tbody><tr>
<td align="center">VARCHAR</td>
<td align="center">java.lang.String</td>
<td align="center">setString</td>
<td align="center">updateString</td>
<td align="center">getString</td>
</tr>
<tr>
<td align="center">CHAR</td>
<td align="center">java.lang.String</td>
<td align="center">setString</td>
<td align="center">updateString</td>
<td align="center">getString</td>
</tr>
<tr>
<td align="center">LONGVARCHAR java.lang.String</td>
<td align="center">setString</td>
<td align="center">updateString</td>
<td align="center">getString</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BIT</td>
<td align="center">boolean</td>
<td align="center">setBoolean</td>
<td align="center">updateBoolean</td>
<td align="center">getBoolean</td>
</tr>
<tr>
<td align="center">NUMERIC</td>
<td align="center">java.math.BigDecimal</td>
<td align="center">setBigDecimal</td>
<td align="center">updateBigDecimal</td>
<td align="center">getBigDecimal</td>
</tr>
<tr>
<td align="center">TINYINT</td>
<td align="center">byte</td>
<td align="center">setByte</td>
<td align="center">updateByte</td>
<td align="center">getByte</td>
</tr>
<tr>
<td align="center">SMALLINT short</td>
<td align="center">setShort</td>
<td align="center">updateShort</td>
<td align="center">getShort</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">INTEGER</td>
<td align="center">int</td>
<td align="center">setInt</td>
<td align="center">updateInt</td>
<td align="center">getInt</td>
</tr>
<tr>
<td align="center">BIGINT</td>
<td align="center">long</td>
<td align="center">setLong</td>
<td align="center">updateLong</td>
<td align="center">getLong</td>
</tr>
<tr>
<td align="center">REAL</td>
<td align="center">float</td>
<td align="center">setFloat</td>
<td align="center">updateFloat</td>
<td align="center">getFloat</td>
</tr>
<tr>
<td align="center">FLOAT</td>
<td align="center">float</td>
<td align="center">setFloat</td>
<td align="center">updateFloat</td>
<td align="center">getFloat</td>
</tr>
<tr>
<td align="center">DOUBLE</td>
<td align="center">double</td>
<td align="center">setDouble</td>
<td align="center">updateDouble</td>
<td align="center">getDouble</td>
</tr>
<tr>
<td align="center">VARBINARY</td>
<td align="center">byte[]</td>
<td align="center">setBytes</td>
<td align="center">updateBytes</td>
<td align="center">getBytes</td>
</tr>
<tr>
<td align="center">BINARY</td>
<td align="center">byte[]</td>
<td align="center">setBytes</td>
<td align="center">updateBytes</td>
<td align="center">getBytes</td>
</tr>
<tr>
<td align="center">DATE</td>
<td align="center">java.sql.Date</td>
<td align="center">setDate</td>
<td align="center">updateDate</td>
<td align="center">getDate</td>
</tr>
<tr>
<td align="center">TIME</td>
<td align="center">java.sql.Time</td>
<td align="center">setTime</td>
<td align="center">updateTime</td>
<td align="center">getTime</td>
</tr>
<tr>
<td align="center">TIMESTAMP</td>
<td align="center">java.sql.Timestamp</td>
<td align="center">setTimestamp</td>
<td align="center">updateTimestamp</td>
<td align="center">getTimestamp</td>
</tr>
<tr>
<td align="center">CLOB</td>
<td align="center">java.sql.Clob</td>
<td align="center">setClob</td>
<td align="center">updateClob</td>
<td align="center">getClob</td>
</tr>
<tr>
<td align="center">BLOB</td>
<td align="center">java.sql.Blob</td>
<td align="center">setBlob</td>
<td align="center">updateBlob</td>
<td align="center">getBlob</td>
</tr>
<tr>
<td align="center">ARRAY</td>
<td align="center">java.sql.Array</td>
<td align="center">setArray</td>
<td align="center">updateArray</td>
<td align="center">getArray</td>
</tr>
<tr>
<td align="center">REF</td>
<td align="center">java.sql.Ref</td>
<td align="center">SetRef</td>
<td align="center">updateRef</td>
<td align="center">getRef</td>
</tr>
<tr>
<td align="center">STRUCT</td>
<td align="center">java.sql.Struct</td>
<td align="center">SetStruct</td>
<td align="center">updateStruct</td>
<td align="center">getStruct</td>
</tr>
</tbody></table>
<h2 id="日期和时间数据类型"><a href="#日期和时间数据类型" class="headerlink" title="日期和时间数据类型"></a>日期和时间数据类型</h2><p><code>java.sql.Date</code>类映射到SQL <code>DATE</code>类型，<code>java.sql.Time</code>和<code>java.sql.Timestamp</code>类分别映射到SQL <code>TIME</code>和SQL <code>TIMESTAMP</code>数据类型。</p>
<p>以下示例显示了<code>Date</code>和<code>Time</code>类如何格式化为标准 Java 日期和时间值以匹配 SQL 数据类型要求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"><span class="keyword">import</span> java.sql.Time;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlDateTime</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//Get standard date and time</span></span><br><span class="line">    java.util.<span class="type">Date</span> <span class="variable">javaDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.util.Date();</span><br><span class="line">    <span class="type">long</span> <span class="variable">javaTime</span> <span class="operator">=</span> javaDate.getTime();</span><br><span class="line">    System.out.println(<span class="string">&quot;The Java Date is:&quot;</span> + javaDate.toString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get and display SQL DATE</span></span><br><span class="line">    java.sql.<span class="type">Date</span> <span class="variable">sqlDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.sql.Date(javaTime);</span><br><span class="line">    System.out.println(<span class="string">&quot;The SQL DATE is: &quot;</span> + sqlDate.toString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Get and display SQL TIME</span></span><br><span class="line">    java.sql.<span class="type">Time</span> <span class="variable">sqlTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.sql.Time(javaTime);</span><br><span class="line">    System.out.println(<span class="string">&quot;The SQL TIME is: &quot;</span> + sqlTime.toString());</span><br><span class="line">    <span class="comment">//Get and display SQL TIMESTAMP</span></span><br><span class="line">    java.sql.<span class="type">Timestamp</span> <span class="variable">sqlTimestamp</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">java</span>.sql.Timestamp(javaTime);</span><br><span class="line">    System.out.println(<span class="string">&quot;The SQL TIMESTAMP is: &quot;</span> + sqlTimestamp.toString());</span><br><span class="line">  &#125;<span class="comment">//end main</span></span><br><span class="line">&#125;<span class="comment">//end SqlDateTime</span></span><br></pre></td></tr></table></figure>
<h2 id="处理NULL值"><a href="#处理NULL值" class="headerlink" title="处理NULL值"></a>处理NULL值</h2><p>SQL使用<code>NULL</code>值和 Java 使用<code>null</code>是不同的概念。 所以，要在 Java 中处理SQL <code>NULL</code>值，可以使用三种策略：</p>
<ul>
<li>避免使用返回原始数据类型的<code>getXXX()</code>方法。</li>
<li>对原始数据类型使用包装类，并使用<code>ResultSet</code>对象的<code>wasNull()</code>方法来测试接收<code>getXXX()</code>方法的返回值的包装器类变量是否应设置为<code>null</code>。</li>
<li>使用原始数据类型和<code>ResultSet</code>对象的<code>wasNull()</code>方法来测试接收到由<code>getXXX()</code>方法返回的值的原始变量是否应设置为表示<code>NULL</code>的可接受值。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement( );</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id, first, last, age FROM Employees&quot;</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>( rs.wasNull( ) ) &#123;</span><br><span class="line">  id = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/IDEA/IDEA快捷键"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/21/java/IDEA/IDEA%E5%BF%AB%E6%8D%B7%E9%94%AE/"
    >IDEA快捷键</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/02/21/java/IDEA/IDEA%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="article-date">
  <time datetime="2021-02-21T03:31:41.000Z" itemprop="datePublished">2021-02-21</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="Ctrl"><a href="#Ctrl" class="headerlink" title="Ctrl"></a>Ctrl</h2><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">介绍</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Ctrl + F</td>
<td align="center">在当前文件进行文本查找</td>
</tr>
<tr>
<td align="center">Ctrl + R</td>
<td align="center">在当前文件进行文本替换</td>
</tr>
<tr>
<td align="center">Ctrl + Z</td>
<td align="center">撤销</td>
</tr>
<tr>
<td align="center">Ctrl + C</td>
<td align="center">复制光标所在行或复制选择内容</td>
</tr>
<tr>
<td align="center">Ctrl + X</td>
<td align="center">剪切光标所在行或剪切选择内容</td>
</tr>
<tr>
<td align="center">Ctrl + V</td>
<td align="center">粘贴</td>
</tr>
<tr>
<td align="center">Ctrl + E</td>
<td align="center">显示最近打开的文件记录列表</td>
</tr>
<tr>
<td align="center">Ctrl + G</td>
<td align="center">在当前文件跳转到指定行处</td>
</tr>
<tr>
<td align="center">Ctrl + W</td>
<td align="center">递进式选择代码块。可选中光标所在的单词或段落，连续按会在原有选中的基础上再扩展选中范围</td>
</tr>
<tr>
<td align="center">Ctrl + 左方向键</td>
<td align="center">光标跳转到当前单词 &#x2F; 中文句的左侧开头位置</td>
</tr>
<tr>
<td align="center">Ctrl + 右方向键</td>
<td align="center">光标跳转到当前单词 &#x2F; 中文句的右侧开头位置</td>
</tr>
<tr>
<td align="center">Ctrl + 光标定位</td>
<td align="center">按 Ctrl 不要松开，会显示光标所在的类信息摘要</td>
</tr>
<tr>
<td align="center">Ctrl + &#x2F;</td>
<td align="center">注释光标所在行代码，会根据当前不同文件类型使用不同的注释符号</td>
</tr>
</tbody></table>
<h2 id="Alt"><a href="#Alt" class="headerlink" title="Alt"></a>Alt</h2><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">介绍</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Alt + Insert</td>
<td align="center">快速生成面板</td>
</tr>
<tr>
<td align="center">Alt + Enter</td>
<td align="center">智能提示</td>
</tr>
<tr>
<td align="center">Alt + 左方向键</td>
<td align="center">按左方向切换当前已打开的文件视图</td>
</tr>
<tr>
<td align="center">Alt + 右方向键</td>
<td align="center">按右方向切换当前已打开的文件视图</td>
</tr>
</tbody></table>
<h2 id="Ctrl-Alt"><a href="#Ctrl-Alt" class="headerlink" title="Ctrl + Alt"></a>Ctrl + Alt</h2><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">介绍</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Ctrl + Alt + S</td>
<td align="center">打开 IDEA 系统设置</td>
</tr>
<tr>
<td align="center">Ctrl + Alt + L</td>
<td align="center">格式化代码，可以对当前文件和整个包目录使用</td>
</tr>
</tbody></table>
<h2 id="Ctrl-Shift"><a href="#Ctrl-Shift" class="headerlink" title="Ctrl + Shift"></a>Ctrl + Shift</h2><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">介绍</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Ctrl + Shift + Enter</td>
<td align="center">自动完成，结束本行跳转到下一行，行末自动添加分号</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + F</td>
<td align="center">根据输入内容查找整个项目或指定目录内文件</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + R</td>
<td align="center">根据输入内容替换对应内容，范围为整个项目或指定目录内文件</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + N</td>
<td align="center">文件查找面板，通过文件名定位&#x2F;打开文件&#x2F;目录，打开目录需要在输入的内容后面多加一个正斜杠</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + A</td>
<td align="center">Find Action</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + &#x2F;</td>
<td align="center">代码块注释</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + E</td>
<td align="center">显示最近修改的文件列表的弹出层</td>
</tr>
</tbody></table>
<h2 id="Ctrl-Shift-Alt"><a href="#Ctrl-Shift-Alt" class="headerlink" title="Ctrl + Shift + Alt"></a>Ctrl + Shift + Alt</h2><p>| Ctrl + Shift + Alt + J | 列操作 | </p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-密码技术/消息认证码"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/12/17/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%B6%88%E6%81%AF%E8%AE%A4%E8%AF%81%E7%A0%81/"
    >消息认证码</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/12/17/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%B6%88%E6%81%AF%E8%AE%A4%E8%AF%81%E7%A0%81/" class="article-date">
  <time datetime="2020-12-17T02:46:22.000Z" itemprop="datePublished">2020-12-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/">密码技术</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>使用消息认证码可以判断消息是否被篡改，以及是否有人伪装成发送者发送了该消息。</p>
<p>消息认证码（<code>Message Authentication Code，MAC</code>）是一种确认完整性并进行认证的技术。</p>
<p>消息认证码的输入包括任意长度的消息和一个发送者与接收者之间共享的密钥，它可以输出固定长度的数据，这个数据称为 MAC 值。</p>
<p>根据任意长度的消息输出固定长度的数据，这一点和单向散列函数很类似。但单向散列函数中计算散列值时不需要密钥，相对的，消息认证码中则需要使用发送者和接收者之间共享的密钥。</p>
<p>要计算 MAC 值必须持有共享密钥，没有共享密钥的人就无法计算 MAC 值，消息认证码正是利用这一性质来完成认证的。</p>
<p>和单向散列函数的散列值一样，哪怕消息中发生 1 比特的变化，MAC 值也会发生变化，消息认证码正是利用这一性质来确认完整性。</p>
<p>可以理解成消息认证码是一种与密钥相关联的单向散列函数。</p>
<img src="/2020/12/17/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%B6%88%E6%81%AF%E8%AE%A4%E8%AF%81%E7%A0%81/img2.png" class="" title="单向散列函数与消息认证码的比较">

<h1 id="消息认证码的使用步骤"><a href="#消息认证码的使用步骤" class="headerlink" title="消息认证码的使用步骤"></a>消息认证码的使用步骤</h1><img src="/2020/12/17/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%B6%88%E6%81%AF%E8%AE%A4%E8%AF%81%E7%A0%81/img3.png" class="" title="消息认证码的使用步骤">

<ol>
<li>发送者与接收者事先共享密钥。</li>
<li>发送者根据消息计算 MAC 值（使用共享密钥）。</li>
<li>发送者将消息和 MAC 值发送给接收者。</li>
<li>接收者根据收到的消息计算 MAC 值（使用共享密钥）。</li>
<li>接收者将自己计算的 MAC 值与从发送者处收到的 MAC 值进行对比。</li>
<li>如果两个 MAC 值一致，则接收者就可以断定消息的确来自发送者。如果不一致，则可以断定消息不是来自发送者（认证过失败）。</li>
</ol>
<h1 id="消息认证码的密钥配送问题"><a href="#消息认证码的密钥配送问题" class="headerlink" title="消息认证码的密钥配送问题"></a>消息认证码的密钥配送问题</h1><p>在消息认证码中，需要发送者和接收者之间共享密钥，而这个密钥不能被主动攻击者获取。如果这个密钥落入攻击者手中，则攻击者也可以计算出 MAC 值，从而就能自由的进行篡改和伪装攻击，这样消息认证码就失去了作用。</p>
<p>要解决密钥配送问题，需要像对称密码一样使用一些共享密钥的方法，例如公钥密码、Diff-Hellman密钥交换、密钥分配中心，或者其他安全的方式发送密钥等。</p>
<h1 id="消息认证码的实现方法"><a href="#消息认证码的实现方法" class="headerlink" title="消息认证码的实现方法"></a>消息认证码的实现方法</h1><ul>
<li>使用单向散列函数实现，其中一种方法叫 HMAC。</li>
<li>使用分组密码实现。<br>将分组密码的密钥作为消息认证码的共享密钥来使用，并用 CBC 模式将消息全部加密。此时，初始化向量(IV)是固定的。由于消息认证码中不需要解密，因此将除最后一个分组以外的密文全部丢弃，而将最后一个分组用作 MAC 值。由于 CBC 模式的最后一个分组会受到整个消息以及密钥的双重影响，因此可以将它用作消息认证码。AES-CMAC 就是一种基于 AES 来实现的消息认证码。</li>
<li>其他方法：流密码和公钥密码等也可以实现消息认证码。</li>
</ul>
<h1 id="认证加密"><a href="#认证加密" class="headerlink" title="认证加密"></a>认证加密</h1><p>认证加密是一种将对称密码与消息认证码相结合，同时满足机密性、完整性和认证三大功能的机制。</p>
<p>有一种认证加密方式叫<code>Encrypt-then-MAc</code>，这种方式是先用对称密码将明文加密，然后计算密文的 MAC 值。在<code>Encrypt-then-MAc</code>方式中，消息认证码的输入消息是密文，通过 MAC 值就可以判断这段密文的确是由知道明文和密钥的人生成的。使用这一机制，我们可以防止攻击者通过发送任意伪造的密文，并让服务器解密来套取信息的攻击（选择密文攻击）。</p>
<p>还有一些其他的认证加密方式，如<code>Encrypt-and-MAC</code>，将明文用对称密码加密，并对明文计算 MAC 值；<code>MAC-then-Encrypt</code>，先计算明文的 MAC 值，然后将明文和 MAC 值同时使用对称密码加密。</p>
<h2 id="GCM与GMAC"><a href="#GCM与GMAC" class="headerlink" title="GCM与GMAC"></a>GCM与GMAC</h2><p>GCM 是一种认证加密方式。GCM 中使用 AES 的 128 比特分组密码的 CTR 模式，并使用一个反复进行加法和乘法运算的散列函数来计算 MAC 值。由于 CTR 模式的本质是对递增的计数器值进行加密，因此可以通过对若干分组进行并行处理来提高运行速度。此外，由于 CTR 模式加密与 MAC 值的计算使用的是相同的密钥因此在密钥管理方面也更容易。</p>
<p>专门用于消息认证码的 GCM 称为 GMAC。</p>
<h1 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h1><p>HMAC 是一种使用单向散列函数来构造消息认证码的方法，其中 HMAC 的 H 就是 Hash 的意思。</p>
<p>HMAC 中使用的单向散列函数并不仅限于一种，如果将来设计出新的单向散列函数，也可以使用。</p>
<p>使用 SHA-1、SHA-224、SHA-256、SHA-384、SHA-512 所构造的 HMAC，分别称为 HMAC-SHA-1、HMAC-SHA-224、HMAC-SHA-256、HMAC-SHA-384、HMAC-SHA-512。</p>
<h2 id="HMAC-的步骤"><a href="#HMAC-的步骤" class="headerlink" title="HMAC 的步骤"></a>HMAC 的步骤</h2><img src="/2020/12/17/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%B6%88%E6%81%AF%E8%AE%A4%E8%AF%81%E7%A0%81/img1.png" class="">


<h3 id="1-密钥填充"><a href="#1-密钥填充" class="headerlink" title="1.密钥填充"></a>1.密钥填充</h3><p>如果密钥比单向散列函数的分组长度要短，就需要在末尾填充 0，直到其长度达到单向散列函数的分组长度为止。</p>
<p>如果密钥比单向散列函数的分组长度要长，则要用单向散列函数求出密钥的散列值，然后将这个散列值用作 HMAC 的密钥。</p>
<h3 id="2-填充后的密钥与-ipad-的-XOR"><a href="#2-填充后的密钥与-ipad-的-XOR" class="headerlink" title="2.填充后的密钥与 ipad 的 XOR"></a>2.填充后的密钥与 ipad 的 XOR</h3><p>将填充后的密钥与被称为<code>ipad</code>的比特序列进行 XOR 运算。<code>ipad</code>是将<code>00110110</code>这一比特序列（即16进制的36）不断循环反复直到达到分组长度所形成的的比特序列，其中<code>ipad</code>的<code>i</code>是<code>inner</code>（内部）的意思。</p>
<p>XOR 运算所得到的值就是一个和单向散列函数的分组长度相同，且和密钥相关的比特序列(<code>ipadkey</code>)。</p>
<h3 id="3-与消息组合"><a href="#3-与消息组合" class="headerlink" title="3.与消息组合"></a>3.与消息组合</h3><p>将<code>ipadkey</code>与消息组合，也就是将和密钥相关的比特序列(<code>ipadkey</code>)附加在消息的开头。</p>
<h3 id="4-计算散列值"><a href="#4-计算散列值" class="headerlink" title="4.计算散列值"></a>4.计算散列值</h3><p>将第3步的结果输入单向散列函数，并计算出散列值。</p>
<h3 id="5-填充后的密钥与-opad-的-XOR"><a href="#5-填充后的密钥与-opad-的-XOR" class="headerlink" title="5.填充后的密钥与 opad 的 XOR"></a>5.填充后的密钥与 opad 的 XOR</h3><p>将填充后的密钥与被称为<code>opad</code>的比特序列进行 XOR 运算。<code>opad</code>是将<code>01011100</code>这一比特序列（即16进制的 5C）不断循环反复直到达到分组长度所形成的比特序列，其中<code>opad</code>的<code>o</code>是<code>outer</code>（外部）的意思。</p>
<p>XOR 运算所得到的结果也是一个和单向散列函数的分组长度相同，且和密钥相关的比特序列(<code>opadkey</code>)。</p>
<h3 id="6-与散列值结合"><a href="#6-与散列值结合" class="headerlink" title="6.与散列值结合"></a>6.与散列值结合</h3><p>将第4步的散列值拼在<code>opadkey</code>后面。</p>
<h3 id="7-计算散列值"><a href="#7-计算散列值" class="headerlink" title="7.计算散列值"></a>7.计算散列值</h3><p>将第6步的结果输入单向散列函数，并计算出散列值。这个散列值就是最终的 MAC 值。</p>
<p>通过上述流程可以看出，最后得到的 MAC 值是一个和输入的消息以及密钥都相关的长度固定的比特序列。</p>
<h1 id="对消息认证码的攻击"><a href="#对消息认证码的攻击" class="headerlink" title="对消息认证码的攻击"></a>对消息认证码的攻击</h1><h2 id="重放攻击"><a href="#重放攻击" class="headerlink" title="重放攻击"></a>重放攻击</h2><h1 id="消息认证码无法解决的问题"><a href="#消息认证码无法解决的问题" class="headerlink" title="消息认证码无法解决的问题"></a>消息认证码无法解决的问题</h1><ul>
<li>对第三方证明</li>
<li>防止否认</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/" rel="tag">密码技术</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-密码技术/数字签名"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/"
    >数字签名</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" class="article-date">
  <time datetime="2020-12-16T02:46:22.000Z" itemprop="datePublished">2020-12-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/">密码技术</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h1><h2 id="从消息认证码到数字签名"><a href="#从消息认证码到数字签名" class="headerlink" title="从消息认证码到数字签名"></a>从消息认证码到数字签名</h2><p>使用消息认证码我们可以识别消息是否被篡改或者发送者身份是否被伪装，也就是可以校验消息的完整性，还可以对消息进行认证。然而，在出具借条的场景中却无法使用消息认证码，因为消息认证码无法防止否认。</p>
<p>消息认证码之所以无法防止否认，是因为消息认证码需要在发送者和接收者之间共享同一个密钥。正是因为密钥是共享的，所以能够使用消息认证码计算出正确 MAC 值的并不只有发送者，接收者也可以。由于发送者和接收者都可以计算出正确的 MAC 值，因此对于第三方来说，我们无法证明这条消息的确是由发送者生成的。</p>
<h2 id="通过数字签名解决问题"><a href="#通过数字签名解决问题" class="headerlink" title="通过数字签名解决问题"></a>通过数字签名解决问题</h2><p>发送者使用的密钥是一个只有发送者自己才知道的私钥。当发送者发送消息时，他用私钥生成一个签名，相对的，接收者则使用一个和发送者不同的密钥对签名进行验证。使用接收者的密钥无法根据消息生成签名，但是用发送者的密钥却可以对发送者所计算的签名进行验证，也就是说可以知道这个签名是否是通过发送者的密钥计算出来的。这就是数字签名。</p>
<h2 id="签名的生成和验证"><a href="#签名的生成和验证" class="headerlink" title="签名的生成和验证"></a>签名的生成和验证</h2><p>在数字签名中出现了两种行为：</p>
<ul>
<li>生成消息签名的行为</li>
<li>验证消息签名的行为</li>
</ul>
<p>这两种行为需要使用各自专用的密钥来完成。发送者使用“签名密钥”来生成消息的签名，接收者和验证者则使用“验证密钥”来验证消息的签名。数字签名对签名密钥和验证密钥进行了区分，使用验证密钥是无法生成签名的。签名密钥只能由签名的人持有，而验证密钥则是任何需要验证签名的人都可以持有。</p>
<p>公钥密码和数字签名的结构非常相似，实际上，数字签名就是通过将公钥密码反过来用而实现的。</p>
<h2 id="公钥密码与数字签名"><a href="#公钥密码与数字签名" class="headerlink" title="公钥密码与数字签名"></a>公钥密码与数字签名</h2><p>公钥密码包括一个由公钥和私钥组成的密钥对，公钥用于加密，私钥用于解密。</p>
<img src="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/img1.png" class="">

<p>数字签名也包括一个由公钥和私钥组成的密钥对，公钥用于解密，私钥用于加密。</p>
<img src="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/img2.png" class="">

<h1 id="数字签名的方法"><a href="#数字签名的方法" class="headerlink" title="数字签名的方法"></a>数字签名的方法</h1><p>两种生成和验证数字签名的方法：</p>
<ul>
<li>直接对消息签名的方法</li>
<li>对消息的散列值签名的方法，一般都用这种方法</li>
</ul>
<h2 id="直接对消息签名的方法"><a href="#直接对消息签名的方法" class="headerlink" title="直接对消息签名的方法"></a>直接对消息签名的方法</h2><p>发送者需要事先生成一个包括公钥和私钥的密钥对，需要验证签名的接收者需要得到发送者的公钥，在此基础上，签名和验证的过程如下：</p>
<img src="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/img3.png" class="">

<h2 id="对消息的散列值签名的方法"><a href="#对消息的散列值签名的方法" class="headerlink" title="对消息的散列值签名的方法"></a>对消息的散列值签名的方法</h2><img src="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/img4.png" class="">

<img src="/2020/12/16/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/img5.png" class=""> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/" rel="tag">密码技术</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/15/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><a class="extend next" rel="next" href="/page/17/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2017-2023
        <i class="ri-heart-fill heart_icon"></i> WSQ
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="学海无涯"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>