<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 学海无涯</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?b1b5dee3bb1719c8a439f8070118dc80";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <!-- <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script> -->
      <link href="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.css" rel="stylesheet">
      <script src="https://cdn.bootcdn.net/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/wsq01/"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover5.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">学海无涯</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-MySQL/MySQL执行流程"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/"
    >MySQL 执行流程</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/" class="article-date">
  <time datetime="2021-05-19T06:59:13.000Z" itemprop="datePublished">2021-05-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a> / <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">MySQL</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>下面是 MySQL 执行一条 SQL 查询语句的流程，从图中可以看到 MySQL 内部架构里的各个功能模块。</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/1.jpg" class="">

<p>MySQL 的架构共分为两层：<code>Server</code>层和存储引擎层：</p>
<ul>
<li><code>Server</code>层负责建立连接、分析和执行 SQL。MySQL 大多数的核心功能模块都在这实现，主要包括连接器，查询缓存、解析器、优化器、执行器等。另外，所有的内置函数（如日期、时间、数学和加密函数等）和所有跨存储引擎的功能（如存储过程、触发器、视图等）都在<code>Server</code>层实现。</li>
<li>存储引擎层负责数据的存储和提取。支持 InnoDB、MyISAM、Memory 等多个存储引擎，不同的存储引擎共用一个<code>Server</code>层。现在最常用的存储引擎是 InnoDB，从 MySQL 5.5 版本开始，InnoDB 成为了 MySQL 的默认存储引擎。我们常说的索引数据结构，就是由存储引擎层实现的，不同的存储引擎支持的索引类型也不相同，比如 InnoDB 支持索引类型是 B+树，且是默认使用，也就是说在数据表中创建的主键索引和二级索引默认使用的是 B+ 树索引。</li>
</ul>
<h1 id="第一步：连接器"><a href="#第一步：连接器" class="headerlink" title="第一步：连接器"></a>第一步：连接器</h1><p>如果在 Linux 操作系统里使用 MySQL，那第一步肯定是要先连接 MySQL 服务，然后才能执行 SQL 语句，普遍我们都是使用下面这条命令进行连接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -h 指定 MySQL 服务得 IP 地址，如果是连接本地的 MySQL服务，可以不用这个参数；</span></span><br><span class="line"><span class="comment"># -u 指定用户名，管理员角色名为 root；</span></span><br><span class="line"><span class="comment"># -p 指定密码，如果命令行中不填写密码（为了密码安全，建议不要在命令行写密码），就需要在交互对话里面输入密码</span></span><br><span class="line">mysql -h<span class="variable">$ip</span> -u<span class="variable">$user</span> -p</span><br></pre></td></tr></table></figure>
<p>连接的过程需要先经过 TCP 三次握手，因为 MySQL 是基于 TCP 协议进行传输的。如果 MySQL 服务并没有启动，则会收到如下的报错：</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/1-1.png" class="">

<p>如果 MySQL 服务正常运行，完成 TCP 连接的建立后，连接器就要开始验证你的用户名和密码，如果用户名或密码不对，就收到一个<code>Access denied for user</code>的错误，然后客户端程序结束执行。</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/1-2.png" class="">

<p>如果用户密码都没有问题，连接器就会获取该用户的权限，然后保存起来，后续该用户在此连接里的任何操作，都会基于连接开始时读到的权限进行权限逻辑的判断。</p>
<p>所以，如果一个用户已经建立了连接，即使管理员中途修改了该用户的权限，也不会影响已经存在连接的权限。修改完成后，只有再新建的连接才会使用新的权限设置。</p>
<h2 id="如何查看-MySQL-服务被多少个客户端连接了？"><a href="#如何查看-MySQL-服务被多少个客户端连接了？" class="headerlink" title="如何查看 MySQL 服务被多少个客户端连接了？"></a>如何查看 MySQL 服务被多少个客户端连接了？</h2><p>可以执行<code>show processlist</code>命令查看当前 MySQL 服务被多少个客户端连接了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> processlist;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+------+---------------------+-----------+---------+------+----------+------------------+</span></span><br><span class="line"><span class="operator">|</span> Id  <span class="operator">|</span> <span class="keyword">User</span> <span class="operator">|</span> Host                <span class="operator">|</span> db        <span class="operator">|</span> Command <span class="operator">|</span> <span class="type">Time</span> <span class="operator">|</span> State    <span class="operator">|</span> Info             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+------+---------------------+-----------+---------+------+----------+------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">17</span> <span class="operator">|</span> root <span class="operator">|</span> <span class="number">172.16</span><span class="number">.10</span><span class="number">.110</span>:<span class="number">51976</span> <span class="operator">|</span> skms      <span class="operator">|</span> Sleep   <span class="operator">|</span> <span class="number">7291</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">18</span> <span class="operator">|</span> root <span class="operator">|</span> <span class="number">172.16</span><span class="number">.10</span><span class="number">.110</span>:<span class="number">51993</span> <span class="operator">|</span> skms      <span class="operator">|</span> Sleep   <span class="operator">|</span> <span class="number">7291</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">19</span> <span class="operator">|</span> root <span class="operator">|</span> <span class="number">172.16</span><span class="number">.10</span><span class="number">.28</span>:<span class="number">65356</span>  <span class="operator">|</span> skms      <span class="operator">|</span> Sleep   <span class="operator">|</span> <span class="number">2771</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">20</span> <span class="operator">|</span> root <span class="operator">|</span> <span class="number">172.16</span><span class="number">.10</span><span class="number">.28</span>:<span class="number">65357</span>  <span class="operator">|</span> skms_user <span class="operator">|</span> Sleep   <span class="operator">|</span>  <span class="number">230</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">310</span> <span class="operator">|</span> root <span class="operator">|</span> <span class="number">172.16</span><span class="number">.10</span><span class="number">.28</span>:<span class="number">51400</span>  <span class="operator">|</span> skms_user <span class="operator">|</span> Sleep   <span class="operator">|</span>  <span class="number">242</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">453</span> <span class="operator">|</span> root <span class="operator">|</span> localhost:<span class="number">60498</span>     <span class="operator">|</span> skms      <span class="operator">|</span> Sleep   <span class="operator">|</span>  <span class="number">184</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">454</span> <span class="operator">|</span> root <span class="operator">|</span> localhost:<span class="number">60500</span>     <span class="operator">|</span> skms      <span class="operator">|</span> Sleep   <span class="operator">|</span>  <span class="number">225</span> <span class="operator">|</span>          <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">455</span> <span class="operator">|</span> root <span class="operator">|</span> localhost           <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span> Query   <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span> starting <span class="operator">|</span> <span class="keyword">show</span> processlist <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+------+---------------------+-----------+---------+------+----------+------------------+</span></span><br><span class="line"><span class="number">16</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>比如上图的显示结果，共有 8 个用户连接了 MySQL 服务，其中<code>id</code>为 17 的用户的<code>Command</code>列的状态为<code>Sleep</code>，这意味着该用户连接完 MySQL 服务就没有再执行过任何命令，也就是说这是一个空闲的连接，并且空闲的时长是 7291 秒（<code>Time</code>列）。</p>
<h2 id="空闲连接会一直占用着吗？"><a href="#空闲连接会一直占用着吗？" class="headerlink" title="空闲连接会一直占用着吗？"></a>空闲连接会一直占用着吗？</h2><p>当然不是了，MySQL 定义了空闲连接的最大空闲时长，由<code>wait_timeout</code>参数控制的，默认值是 8 小时（28800 秒），如果空闲连接超过了这个时间，连接器就会自动将它断开。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;wait_timeout&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> wait_timeout  <span class="operator">|</span> <span class="number">28800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>当然，我们自己也可以手动断开空闲的连接，使用的是<code>kill connection + id</code>的命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; kill connection +6;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>一个处于空闲状态的连接被服务端主动断开后，这个客户端并不会马上知道，等到客户端在发起下一个请求的时候，才会收到这样的报错<code>ERROR 2013 (HY000): Lost connection to MySQL server during query</code>。</p>
<h2 id="MySQL-的连接数有限制吗？"><a href="#MySQL-的连接数有限制吗？" class="headerlink" title="MySQL 的连接数有限制吗？"></a>MySQL 的连接数有限制吗？</h2><p>MySQL 服务支持的最大连接数由<code>max_connections</code>参数控制，超过这个值，系统就会拒绝接下来的连接请求，并报错提示<code>Too many connections</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;max_connections&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> max_connections <span class="operator">|</span> <span class="number">151</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>MySQL 的连接也跟 HTTP 一样，有短连接和长连接的概念，它们的区别如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 短连接</span><br><span class="line">连接 mysql 服务（TCP 三次握手）</span><br><span class="line">执行sql</span><br><span class="line">断开 mysql 服务（TCP 四次挥手）</span><br><span class="line"></span><br><span class="line">// 长连接</span><br><span class="line">连接 mysql 服务（TCP 三次握手）</span><br><span class="line">执行sql</span><br><span class="line">执行sql</span><br><span class="line">执行sql</span><br><span class="line">....</span><br><span class="line">断开 mysql 服务（TCP 四次挥手）</span><br></pre></td></tr></table></figure>
<p>可以看到，使用长连接的好处就是可以减少建立连接和断开连接的过程，所以一般是推荐使用长连接。</p>
<p>但是，使用长连接后可能会占用内存增多，因为 MySQL 在执行查询过程中临时使用内存管理连接对象，这些连接对象资源只有在连接断开时才会释放。如果长连接累计很多，将导致 MySQL 服务占用内存太大，有可能会被系统强制杀掉，这样会发生 MySQL 服务异常重启的现象。</p>
<h2 id="怎么解决长连接占用内存的问题？"><a href="#怎么解决长连接占用内存的问题？" class="headerlink" title="怎么解决长连接占用内存的问题？"></a>怎么解决长连接占用内存的问题？</h2><p>有两种解决方式。</p>
<p>第一种，定期断开长连接。既然断开连接后就会释放连接占用的内存资源，那么我们可以定期断开长连接。</p>
<p>第二种，客户端主动重置连接。MySQL5.7 版本实现了<code>mysql_reset_connection()</code>函数的接口，注意这是接口函数不是命令，那么当客户端执行了一个很大的操作后，在代码里调用<code>mysql_reset_connection</code>函数来重置连接，达到释放内存的效果。这个过程不需要重连和重新做权限验证，但是会将连接恢复到刚刚创建完时的状态。</p>
<p>至此，连接器的工作做完了，简单总结一下：</p>
<ul>
<li>与客户端进行 TCP 三次握手建立连接；</li>
<li>校验客户端的用户名和密码，如果用户名或密码不对，则会报错；</li>
<li>如果用户名和密码都对了，会读取该用户的权限，然后后面的权限逻辑判断都基于此时读取到的权限；</li>
</ul>
<h1 id="第二步：查询缓存"><a href="#第二步：查询缓存" class="headerlink" title="第二步：查询缓存"></a>第二步：查询缓存</h1><p>连接器的工作完成后，客户端就可以向 MySQL 服务发送 SQL 语句了，MySQL 服务收到 SQL 语句后，就会解析出 SQL 语句的第一个字段，看看是什么类型的语句。</p>
<p>如果 SQL 是查询语句（<code>select</code>语句），MySQL 就会先去查询缓存（<code>Query Cache</code>）里查找缓存数据，看看之前有没有执行过这一条命令，这个查询缓存是以<code>key-value</code>形式保存在内存中的，<code>key</code>为 SQL 查询语句，<code>value</code>为 SQL 语句查询的结果。</p>
<p>如果查询的语句命中查询缓存，那么就会直接返回<code>value</code>给客户端。如果查询的语句没有命中查询缓存中，那么就要往下继续执行，等执行完后，查询的结果就会被存入查询缓存中。</p>
<p>这么看，查询缓存还挺有用，但是其实查询缓存挺鸡肋的。</p>
<p>对于更新比较频繁的表，查询缓存的命中率很低的，因为只要一个表有更新操作，那么这个表的查询缓存就会被清空。如果刚缓存了一个查询结果很大的数据，还没被使用的时候，刚好这个表有更新操作，查询缓冲就被清空了，相当于缓存了个寂寞。</p>
<p>所以，MySQL 8.0 版本直接将查询缓存删掉了，也就是说 MySQL 8.0 开始，执行一条 SQL 查询语句，不会再走到查询缓存这个阶段了。</p>
<p>对于 MySQL 8.0 之前的版本，如果想关闭查询缓存，我们可以通过将参数<code>query_cache_type</code>设置成<code>DEMAND</code>。</p>
<h1 id="解析-SQL"><a href="#解析-SQL" class="headerlink" title="解析 SQL"></a>解析 SQL</h1><p>在正式执行 SQL 查询语句之前， MySQL 会先对 SQL 语句做解析，这个工作由解析器来完成。</p>
<h2 id="解析器"><a href="#解析器" class="headerlink" title="解析器"></a>解析器</h2><p>解析器会做如下两件事情。</p>
<p>第一件事情，词法分析。MySQL 会根据你输入的字符串识别出关键字出来，构建出 SQL 语法树，这样方面后面模块获取 SQL 类型、表名、字段名、<code>where</code>条件等等。</p>
<p>第二件事情，语法分析。根据词法分析的结果，语法解析器会根据语法规则，判断你输入的这个 SQL 语句是否满足 MySQL 语法。</p>
<p>如果我们输入的 SQL 语句语法不对，或者数据表或者字段不存在，都会在解析器这个阶段报错。</p>
<p>比如，我下面这条查询语句，<code>test</code>这张表是不存在的，这时 MySQL 解析器就会给报错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test;</span><br><span class="line">ERROR <span class="number">1146</span> (<span class="number">42</span>S02): <span class="keyword">Table</span> <span class="string">&#x27;mysql.test&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br></pre></td></tr></table></figure>
<p>但是注意，表不存在或者字段不存在，并不是在解析器里做的，解析器只负责构建语法树和检查语法，但是不会去查表或者字段存不存在。</p>
<p>那到底谁来做检测表和字段是否存在的工作呢？接下来就是了。</p>
<h1 id="第四步：执行-SQL"><a href="#第四步：执行-SQL" class="headerlink" title="第四步：执行 SQL"></a>第四步：执行 SQL</h1><p>经过解析器后，接着就要进入执行 SQL 查询语句的流程了，每条<code>SELECT</code>查询语句流程主要可以分为下面这三个阶段：</p>
<ul>
<li><code>prepare</code>阶段，也就是预处理阶段；</li>
<li><code>optimize</code>阶段，也就是优化阶段；</li>
<li><code>execute</code>阶段，也就是执行阶段；</li>
</ul>
<h2 id="预处理器"><a href="#预处理器" class="headerlink" title="预处理器"></a>预处理器</h2><p>预处理阶段：</p>
<ul>
<li>检查 SQL 查询语句中的表或者字段是否存在；</li>
<li>将<code>select *</code>中的<code>*</code>符号，扩展为表上的所有列；</li>
</ul>
<p>下面这条查询语句，<code>test</code>这张表是不存在的，这时 MySQL 就会在执行 SQL 查询语句的<code>prepare</code>阶段中报错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test;</span><br><span class="line">ERROR <span class="number">1146</span> (<span class="number">42</span>S02): <span class="keyword">Table</span> <span class="string">&#x27;mysql.test&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br></pre></td></tr></table></figure>
<p>不过，对于 MySQL5.7 判断表或字段是否存在的工作，是在词法分析&amp;语法分析之后，<code>prepare</code>阶段之前做的。不是在解析器里做的。MySQL8.0 代码结构变化很大，后来判断表或字段是否存在的工作就被放入到<code>prepare</code>阶段做了。</p>
<h2 id="优化器"><a href="#优化器" class="headerlink" title="优化器"></a>优化器</h2><p>经过预处理阶段后，还需要为 SQL 查询语句先制定一个执行计划，这个工作交由「优化器」来完成的。</p>
<p>优化器主要负责将 SQL 查询语句的执行方案确定下来，比如在表里面有多个索引的时候，优化器会基于查询成本的考虑，来决定选择使用哪个索引。</p>
<p>要想知道优化器选择了哪个索引，我们可以在查询语句最前面加个<code>explain</code>命令，这样就会输出这条 SQL 语句的执行计划，然后执行计划中的<code>key</code>就表示执行过程中使用了哪个索引，比如下图的<code>key</code>为<code>PRIMARY</code>就是使用了主键索引。</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/2.png" class="">

<p>如果查询语句的执行计划里的<code>key</code>为<code>null</code>说明没有使用索引，那就会全表扫描（<code>type = ALL</code>），这种查询扫描的方式是效率最低档次的，如下图：</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/3.png" class="">

<p>这张<code>product</code>表只有一个索引就是主键，现在我在表中将<code>name</code>设置为普通索引（二级索引）。</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/4.png" class="">

<p>这时<code>product</code>表就有主键索引（<code>id</code>）和普通索引（<code>name</code>）。假设执行了这条查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> product <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">1</span>  <span class="keyword">and</span> name <span class="keyword">like</span> <span class="string">&#x27;i%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这条查询语句的结果既可以使用主键索引，也可以使用普通索引，但是执行的效率会不同。这时，就需要优化器来决定使用哪个索引了。</p>
<p>很显然这条查询语句是覆盖索引，直接在二级索引就能查找到结果（因为二级索引的 B+ 树的叶子节点的数据存储的是主键值），就没必要在主键索引查找了，因为查询主键索引的 B+ 树的成本会比查询二级索引的 B+ 的成本大，优化器基于查询成本的考虑，会选择查询代价小的普通索引。</p>
<p>在下图中执行计划，我们可以看到，执行过程中使用了普通索引（<code>name</code>），<code>Exta</code>为<code>Using index</code>，这就是表明使用了覆盖索引优化。</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/5.png" class="">

<h2 id="执行器"><a href="#执行器" class="headerlink" title="执行器"></a>执行器</h2><p>经历完优化器后，就确定了执行方案，接下来 MySQL 就真正开始执行语句了，这个工作是由「执行器」完成的。在执行的过程中，执行器就会和存储引擎交互了，交互是以记录为单位的。</p>
<p>接下来，用三种方式执行过程，跟大家说一下执行器和存储引擎的交互过程。</p>
<ul>
<li>主键索引查询</li>
<li>全表扫描</li>
<li>索引下推</li>
</ul>
<h4 id="主键索引查询"><a href="#主键索引查询" class="headerlink" title="主键索引查询"></a>主键索引查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>这条查询语句的查询条件用到了主键索引，而且是等值查询，同时主键<code>id</code>是唯一，不会有<code>id</code>相同的记录，所以优化器决定选用访问类型为<code>const</code>进行查询，也就是使用主键索引查询一条记录，那么执行器与存储引擎的执行流程是这样的：</p>
<ul>
<li>执行器第一次查询，会调用<code>read_first_record</code>函数指针指向的函数，因为优化器选择的访问类型为<code>const</code>，这个函数指针被指向为 InnoDB 引擎索引查询的接口，把条件<code>id = 1</code>交给存储引擎，让存储引擎定位符合条件的第一条记录。</li>
<li>存储引擎通过主键索引的 B+ 树结构定位到<code>id = 1</code>的第一条记录，如果记录是不存在的，就会向执行器上报记录找不到的错误，然后查询结束。如果记录是存在的，就会将记录返回给执行器；</li>
<li>执行器从存储引擎读到记录后，接着判断记录是否符合查询条件，如果符合则发送给客户端，如果不符合则跳过该记录。</li>
<li>执行器查询的过程是一个<code>while</code>循环，所以还会再查一次，但是这次因为不是第一次查询了，所以会调用<code>read_record</code>函数指针指向的函数，因为优化器选择的访问类型为<code>const</code>，这个函数指针被指向为一个永远返回 -1 的函数，所以当调用该函数的时候，执行器就退出循环，也就是结束查询了。</li>
</ul>
<p>至此，这个语句就执行完成了。</p>
<h3 id="全表扫描"><a href="#全表扫描" class="headerlink" title="全表扫描"></a>全表扫描</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;iphone&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这条查询语句的查询条件没有用到索引，所以优化器决定选用访问类型为<code>ALL</code>进行查询，也就是全表扫描的方式查询，那么这时执行器与存储引擎的执行流程是这样的：</p>
<ul>
<li>执行器第一次查询，会调用<code>read_first_record</code>函数指针指向的函数，因为优化器选择的访问类型为<code>all</code>，这个函数指针被指向为 InnoDB 引擎全扫描的接口，让存储引擎读取表中的第一条记录；</li>
<li>执行器会判断读到的这条记录的<code>name</code>是不是<code>iphone</code>，如果不是则跳过；如果是则将记录发给客户的（是的没错，Server 层每从存储引擎读到一条记录就会发送给客户端，之所以客户端显示的时候是直接显示所有记录的，是因为客户端是等查询语句查询完成后，才会显示出所有的记录）。</li>
<li>执行器查询的过程是一个<code>while</code>循环，所以还会再查一次，会调用<code>read_record</code>函数指针指向的函数，因为优化器选择的访问类型为<code>all</code>，<code>read_record</code>函数指针指向的还是 InnoDB 引擎全扫描的接口，所以接着向存储引擎层要求继续读刚才那条记录的下一条记录，存储引擎把下一条记录取出后就将其返回给执行器（Server 层），执行器继续判断条件，不符合查询条件即跳过该记录，否则发送到客户端；</li>
<li>一直重复上述过程，直到存储引擎把表中的所有记录读完，然后向执行器（Server 层） 返回了读取完毕的信息；</li>
<li>执行器收到存储引擎报告的查询完毕的信息，退出循环，停止查询。</li>
</ul>
<p>至此，这个语句就执行完成了。</p>
<h3 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h3><p>索引下推（MySQL 5.7 推出的查询优化策略）能够减少二级索引在查询时的回表操作，提高查询的效率，因为它将 Server 层部分负责的事情，交给存储引擎层去处理了。</p>
<p>举一个具体的例子，方便大家理解，这里一张用户表如下，我对<code>age</code>和<code>reword</code>字段建立了联合索引（<code>age，reword</code>）：</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/6.png" class="">

<p>现在有下面这条查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user  <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="number">20</span> <span class="keyword">and</span> reward <span class="operator">=</span> <span class="number">100000</span>;</span><br></pre></td></tr></table></figure>
<p>联合索引当遇到范围查询 (<code>&gt;、&lt;、between、like</code>) 就会停止匹配，也就是<code>a</code>字段能用到联合索引，但是<code>reward</code>字段则无法利用到索引。具体原因这里可以看这篇：索引常见面试题</p>
<p>那么，不使用索引下推（MySQL 5.7 之前的版本）时，执行器与存储引擎的执行流程是这样的：</p>
<ul>
<li>Server 层首先调用存储引擎的接口定位到满足查询条件的第一条二级索引记录，也就是定位到<code>age &gt; 20</code>的第一条记录；</li>
<li>存储引起根据二级索引的 B+ 树快速定位到这条记录后，获取主键值，然后进行回表操作，将完整的记录返回给 Server 层；</li>
<li>Server 层在判断该记录的<code>reward</code>是否等于 100000，如果成立则将其发送给客户端；否则跳过该记录；</li>
<li>接着，继续向存储引擎索要下一条记录，存储引擎在二级索引定位到记录后，获取主键值，然后回表操作，将完整的记录返回给 Server 层；</li>
<li>如此往复，直到存储引擎把表中的所有记录读完。</li>
</ul>
<p>可以看到，没有索引下推的时候，每查询到一条二级索引记录，都要进行回表操作，然后将记录返回给 Server，接着 Server 再判断该记录的<code>reward</code>是否等于 100000。</p>
<p>而使用索引下推后，判断记录的<code>reward</code>是否等于 100000 的工作交给了存储引擎层，过程如下 ：</p>
<ul>
<li>Server 层首先调用存储引擎的接口定位到满足查询条件的第一条二级索引记录，也就是定位到<code>age &gt; 20</code>的第一条记录；</li>
<li>存储引擎定位到二级索引后，先不执行回表操作，而是先判断一下该索引中包含的列（<code>reward</code>列）的条件（<code>reward</code>是否等于 100000）是否成立。如果条件不成立，则直接跳过该二级索引。如果成立，则执行回表操作，将完成记录返回给 Server 层。</li>
<li>Server 层在判断其他的查询条件（本次查询没有其他条件）是否成立，如果成立则将其发送给客户端；否则跳过该记录，然后向存储引擎索要下一条记录。</li>
<li>如此往复，直到存储引擎把表中的所有记录读完。</li>
</ul>
<p>可以看到，使用了索引下推后，虽然<code>reward</code>列无法使用到联合索引，但是因为它包含在联合索引（<code>age，reward</code>）里，所以直接在存储引擎过滤出满足<code>reward = 100000</code>的记录后，才去执行回表操作获取整个记录。相比于没有使用索引下推，节省了很多回表操作。</p>
<p>当你发现执行计划里的<code>Extr</code>部分显示了<code>Using index condition</code>，说明使用了索引下推。</p>
<img src="/2021/05/19/MySQL/MySQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/7.png" class="">

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>执行一条 SQL 查询语句，期间发生了什么？</p>
<ul>
<li>连接器：建立连接，管理连接、校验用户身份；</li>
<li>查询缓存：查询语句如果命中查询缓存则直接返回，否则继续往下执行。MySQL 8.0 已删除该模块；</li>
<li>解析 SQL，通过解析器对 SQL 查询语句进行词法分析、语法分析，然后构建语法树，方便后续模块读取表名、字段、语句类型；</li>
<li>执行 SQL：执行 SQL 共有三个阶段：<ul>
<li>预处理阶段：检查表或字段是否存在；将<code>select *</code>中的<code>*</code>符号扩展为表上的所有列。</li>
<li>优化阶段：基于查询成本的考虑， 选择查询成本最小的执行计划；</li>
<li>执行阶段：根据执行计划执行 SQL 查询语句，从存储引擎读取记录，返回给客户端；</li>
</ul>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/Spring/Spring IoC容器"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/16/java/Spring/Spring%20IoC%E5%AE%B9%E5%99%A8/"
    >Spring Ioc容器</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/05/16/java/Spring/Spring%20IoC%E5%AE%B9%E5%99%A8/" class="article-date">
  <time datetime="2021-05-16T09:43:22.000Z" itemprop="datePublished">2021-05-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="IoC容器"><a href="#IoC容器" class="headerlink" title="IoC容器"></a>IoC容器</h1><p>IoC 容器（也叫 Spring 容器）是 Spring 的核心。Spring 通过 IoC 容器来管理对象的实例化和初始化，以及对象从创建到销毁的整个生命周期。</p>
<p>Spring 中使用的对象都由 IoC 容器管理，不需要手动使用<code>new</code>运算符创建对象。由 IoC 容器管理的对象称为<code>Spring Bean</code>，<code>Spring Bean</code>就是 Java 对象，和使用<code>new</code>运算符创建的对象没有区别。</p>
<p>Spring 通过读取 XML 或 Java 注解中的信息来获取哪些对象需要实例化。</p>
<p>Spring 提供 2 种不同类型的 IoC 容器，即<code>BeanFactory</code>和<code>ApplicationContext</code>容器。</p>
<h2 id="BeanFactory容器"><a href="#BeanFactory容器" class="headerlink" title="BeanFactory容器"></a>BeanFactory容器</h2><p><code>BeanFactory</code>由<code>org.springframework.beans.facytory.BeanFactory</code>接口定义，采用懒加载，所以容器启动比较快。</p>
<p>简单来说，<code>BeanFactory</code>就是一个管理<code>Bean</code>的工厂，它主要负责初始化各种<code>Bean</code>，并调用它们的生命周期方法。</p>
<p><code>BeanFactory</code>接口有多个实现类，最常见的是<code>org.springframework.beans.factory.xml.XmlBeanFactory</code>，它是根据 XML 配置文件中的定义装配<code>Bean</code>的。</p>
<p>使用<code>BeanFactory</code>需要创建<code>XmlBeanFactory</code>类的实例，通过<code>XmlBeanFactory</code>类的构造函数来传递<code>Resource</code>对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;applicationContext.xml&quot;</span>); </span><br><span class="line"><span class="type">BeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(resource);  </span><br></pre></td></tr></table></figure>
<h2 id="ApplicationContext容器"><a href="#ApplicationContext容器" class="headerlink" title="ApplicationContext容器"></a>ApplicationContext容器</h2><p><code>ApplicationContext</code>继承了<code>BeanFactory</code>接口，由<code>org.springframework.context.ApplicationContext</code>接口定义，对象在启动容器时加载。</p>
<p><code>ApplicationContext</code>在<code>BeanFactory</code>的基础上增加了很多企业级功能，例如 AOP、国际化、事件支持等。</p>
<p><code>ApplicationContext</code>接口有两个常用的实现类。</p>
<h3 id="1-ClassPathXmlApplicationContext"><a href="#1-ClassPathXmlApplicationContext" class="headerlink" title="1.ClassPathXmlApplicationContext"></a>1.ClassPathXmlApplicationContext</h3><p>该类从类路径<code>ClassPath</code>中寻找指定的 XML 配置文件，并完成<code>ApplicationContext</code>的实例化工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(String configLocation);</span><br></pre></td></tr></table></figure>
<p><code>configLocation</code>参数用于指定 Spring 配置文件的名称和位置，如<code>applicationContext.xml</code>。</p>
<h3 id="2-FileSystemXmlApplicationContext"><a href="#2-FileSystemXmlApplicationContext" class="headerlink" title="2. FileSystemXmlApplicationContext"></a>2. FileSystemXmlApplicationContext</h3><p>该类从指定的文件系统路径中寻找指定的 XML 配置文件，并完成<code>ApplicationContext</code>的实例化工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(String configLocation);</span><br></pre></td></tr></table></figure>
<p>它与<code>ClassPathXmlApplicationContext</code>的区别是：在读取 Spring 的配置文件时，<code>FileSystemXmlApplicationContext</code>不再从类路径中读取配置文件，而是通过参数指定配置文件的位置，它可以获取类路径之外的资源，如<code>F:/workspaces/applicationContext.xml</code>。</p>
<p>在使用 Spring 框架时，可以通过实例化其中任何一个类创建 Spring 的<code>ApplicationContext</code>容器。通常会采用通过<code>ClassPathXmlApplicationContext</code>类实例化<code>ApplicationContext</code>容器的方式。</p>
<p>需要注意的是，<code>BeanFactory</code>和<code>ApplicationContext</code>都是通过 XML 配置文件加载<code>Bean</code>的。二者的主要区别在于，如果<code>Bean</code>的某一个属性没有注入，则使用<code>BeanFacotry</code>加载后，在第一次调用<code>getBean()</code>方法时会抛出异常，而<code>ApplicationContext</code>则在初始化时自检，这样有利于检查所依赖的属性是否注入。</p>
<p>因此，在实际开发中，通常都选择使用<code>ApplicationContext</code>，而只有在系统资源较少时，才考虑使用<code>BeanFactory</code>。</p>
<h1 id="Bean定义"><a href="#Bean定义" class="headerlink" title="Bean定义"></a>Bean定义</h1><p>由 IoC 容器管理的对象称为<code>Bean</code>，<code>Bean</code>根据 Spring 配置文件中的信息创建。</p>
<p>Spring 容器可以被看作一个大工厂，而容器中的<code>Bean</code>就相当于该工厂的产品。如果希望这个大工厂能够生产和管理<code>Bean</code>，则需要告诉容器需要哪些<code>Bean</code>，以及需要以何种方式将这些<code>Bean</code>装配到一起。</p>
<p>Spring 配置文件支持两种格式，分别是<code>XML</code>文件格式和<code>Properties</code>文件格式。</p>
<ul>
<li><code>Properties</code>配置文件主要以<code>key-value</code>键值对的形式存在，只能赋值，不能进行其他操作，适用于简单的属性配置。</li>
<li><code>XML</code>配置文件是树形结构，相对于<code>Properties</code>文件来说更加灵活。<code>XML</code>配置文件结构清晰，但是内容比较繁琐，适用于大型复杂的项目。</li>
</ul>
<p>通常情况下，Spring 的配置文件使用<code>XML</code>格式，<code>XML</code>配置文件的根元素是<code>&lt;beans&gt;</code>，该元素包含了多个<code>&lt;bean&gt;</code>子元素，每一个<code>&lt;bean&gt;</code>子元素定义了一个<code>Bean</code>，并描述了该<code>Bean</code>如何被装配到容器中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用id属性定义person1，其对应的实现类为com.mengma.person1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.damain.Person1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--使用name属性定义person2，其对应的实现类为com.mengma.domain.Person2--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;Person2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.domain.Person2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;bean&gt;</code>元素常用属性：</p>
<table>
<thead>
<tr>
<th align="center">属性名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>id</code></td>
<td align="center">是一个<code>Bean</code>的唯一标识符，Spring 容器对<code>Bean</code>的配置和管理都通过该属性完成</td>
</tr>
<tr>
<td align="center"><code>name</code></td>
<td align="center">Spring 容器同样可以通过此属性对容器中的<code>Bean</code>进行配置和管理，<code>name</code>属性中可以为<code>Bean</code>指定多个名称，每个名称之间用逗号或分号隔开</td>
</tr>
<tr>
<td align="center"><code>class</code></td>
<td align="center">该属性指定了<code>Bean</code>的具体实现类，它必须是一个完整的类名，使用类的全限定名</td>
</tr>
<tr>
<td align="center"><code>scope</code></td>
<td align="center">用于设定<code>Bean</code>实例的作用域，其属性值有<code>singleton</code>（单例）、<code>prototype</code>（原型）、<code>request、session</code>和<code>global Session</code>。默认值是<code>singleton</code></td>
</tr>
<tr>
<td align="center"><code>constructor-arg</code></td>
<td align="center"><code>&lt;bean&gt;</code>元素的子元素，可以使用此元素传入构造参数进行实例化。该元素的<code>index</code>属性指定构造参数的序号（从 0 开始），<code>type</code>属性指定构造参数的类型</td>
</tr>
<tr>
<td align="center"><code>property</code></td>
<td align="center"><code>&lt;bean&gt;</code>元素的子元素，用于调用<code>Bean</code>实例中的<code>Set</code>方法完成属性赋值，从而完成依赖注入。该元素的<code>name</code>属性指定<code>Bean</code>实例中的相应属性名</td>
</tr>
<tr>
<td align="center"><code>ref</code></td>
<td align="center"><code>&lt;property&gt;</code>和<code>&lt;constructor-arg&gt;</code>等元素的子元素，该元素中的<code>bean</code>属性用于指定对<code>Bean</code>工厂中某个<code>Bean</code>实例的引用</td>
</tr>
<tr>
<td align="center"><code>value</code></td>
<td align="center"><code>&lt;property&gt;</code>和<code>&lt;constractor-arg&gt;</code>等元素的子元素，用于直接指定一个常量值</td>
</tr>
<tr>
<td align="center"><code>list</code></td>
<td align="center">用于封装<code>List</code>或数组类型的依赖注入</td>
</tr>
<tr>
<td align="center"><code>set</code></td>
<td align="center">用于封装<code>Set</code>类型属性的依赖注入</td>
</tr>
<tr>
<td align="center"><code>map</code></td>
<td align="center">用于封装<code>Map</code>类型属性的依赖注入</td>
</tr>
<tr>
<td align="center"><code>entry</code></td>
<td align="center"><code>&lt;map&gt;</code>元素的子元素，用于设置一个键值对。其<code>key</code>属性指定字符串类型的键值，<code>ref</code>或<code>value</code>子元素指定其值</td>
</tr>
<tr>
<td align="center"><code>init-method</code></td>
<td align="center">容器加载<code>Bean</code>时调用该方法</td>
</tr>
<tr>
<td align="center"><code>destroy-method</code></td>
<td align="center">容器删除<code>Bean</code>时调用该方法，该方法只在<code>scope=singleton</code>时有效</td>
</tr>
<tr>
<td align="center"><code>lazy-init</code></td>
<td align="center">懒加载，值为<code>true</code>，容器在首次请求时才会创建<code>Bean</code>实例；值为<code>false</code>，容器在启动时创建<code>Bean</code>实例。该方法只在<code>scope=singleton</code>时有效</td>
</tr>
</tbody></table>
<h1 id="Bean作用域"><a href="#Bean作用域" class="headerlink" title="Bean作用域"></a>Bean作用域</h1><p>在配置文件中，除了可以定义<code>Bean</code>的属性值和相互之间的依赖关系，还可以声明<code>Bean</code>的作用域。例如，如果每次获取<code>Bean</code>时，都需要一个<code>Bean</code>实例，那么应该将<code>Bean</code>的<code>scope</code>属性定义为<code>prototype</code>，如果 Spring 需要每次都返回一个相同的<code>Bean</code>实例，则应将<code>Bean</code>的<code>scope</code>属性定义为<code>singleton</code>。</p>
<h2 id="作用域的种类"><a href="#作用域的种类" class="headerlink" title="作用域的种类"></a>作用域的种类</h2><p>Spring 容器在初始化一个<code>Bean</code>的实例时，同时会指定该实例的作用域。Spring 支持以下 6 种作用域。</p>
<ol>
<li><code>singleton</code><br>默认值，单例模式，表示在容器中只有一个<code>Bean</code>实例，<code>Bean</code>以单例的方式存在。</li>
<li><code>prototype</code><br>原型模式，表示每次通过容器获取<code>Bean</code>时，容器都会创建一个<code>Bean</code>实例。</li>
<li><code>request</code><br>每次 HTTP 请求，容器都会创建一个<code>Bean</code>实例。该作用域只在当前 HTTP <code>Request</code>内有效。</li>
<li><code>session</code><br>同一个 HTTP <code>Session</code>共享一个<code>Bean</code>实例，不同的<code>Session</code>使用不同的<code>Bean</code>实例。该作用域仅在当前 HTTP <code>Session</code>内有效。</li>
<li><code>application</code><br>同一个 Web 应用共享一个<code>Bean</code>实例，该作用域在当前<code>ServletContext</code>内有效。<br>类似于<code>singleton</code>，不同的是，<code>singleton</code>表示每个 IoC 容器中仅有一个<code>Bean</code>实例，而同一个 Web 应用中可能会有多个 IoC 容器，但一个 Web 应用只会有一个<code>ServletContext</code>，也可以说<code>application</code>才是 Web 应用中货真价实的单例模式。</li>
<li><code>websocket</code><br><code>websocket</code>的作用域是<code>WebSocket</code>，即在整个<code>WebSocket</code>中有效。</li>
</ol>
<p><code>request、session、application、websocket</code>作用域只能在 Web 环境下使用，如果使用<code>ClassPathXmlApplicationContext</code>加载这些作用域中的任意一个的<code>Bean</code>，就会抛出以下异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: No Scope registered for scope name &#x27;xxx&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="singleton"><a href="#singleton" class="headerlink" title="singleton"></a>singleton</h2><p><code>singleton</code>是 Spring 容器默认的作用域，当<code>Bean</code>的作用域为<code>singleton</code>时，Spring 容器中只会存在一个共享的<code>Bean</code>实例，该<code>Bean</code>实例将存储在高速缓存中，并且所有对<code>Bean</code>的请求，只要<code>id</code>与该<code>Bean</code>定义相匹配，都会返回该缓存对象。</p>
<p>通常情况下，这种单例模式对于无会话状态的<code>Bean</code>（如 DAO 层、Service 层）来说，是最理想的选择。</p>
<p>在 Spring 配置文件中，可以使用<code>&lt;bean&gt;</code>元素的<code>scope</code>属性，将<code>Bean</code>的作用域定义成<code>singleton</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h2><p>使用<code>prototype</code>作用域的<code>Bean</code>会在每次请求该<code>Bean</code>时都会创建一个新的<code>Bean</code>实例。<code>prototype</code>作用域适用于需要保持会话状态的 <code>Bean</code>。</p>
<p>在 Spring 配置文件中，可以使用<code>&lt;bean&gt;</code>元素的<code>scope</code>属性，将<code>Bean</code>的作用域定义成<code>prototype</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="Bean生命周期"><a href="#Bean生命周期" class="headerlink" title="Bean生命周期"></a>Bean生命周期</h1><p>Spring 根据<code>Bean</code>的作用域来选择管理方式。对于<code>singleton</code>作用域的<code>Bean</code>，Spring 能够精确地知道该<code>Bean</code>何时被创建，何时初始化完成，以及何时被销毁；而对于<code>prototype</code>作用域的<code>Bean</code>，Spring 只负责创建，当容器创建了<code>Bean</code>的实例后，<code>Bean</code>的实例就交给客户端代码管理，Spring 容器将不再跟踪其生命周期。</p>
<h2 id="Bean生命周期执行流程"><a href="#Bean生命周期执行流程" class="headerlink" title="Bean生命周期执行流程"></a>Bean生命周期执行流程</h2><p>Spring 容器在确保一个<code>Bean</code>能够使用之前，会进行很多工作。<code>Bean</code>的生命周期流程：</p>
<img src="/2021/05/16/java/Spring/Spring%20IoC%E5%AE%B9%E5%99%A8/1.png" class="" title="Bean 的生命周期">

<p><code>Bean</code>生命周期的整个执行过程描述如下：</p>
<ol>
<li>Spring 启动，查找并加载需要被 Spring 管理的<code>Bean</code>，并实例化<code>Bean</code>。</li>
<li>利用依赖注入完成<code>Bean</code>中所有属性值的配置注入。</li>
<li>如果<code>Bean</code>实现了<code>BeanNameAware</code>接口，则 Spring 调用<code>Bean</code>的<code>setBeanName()</code>方法传入当前<code>Bean</code>的<code>id</code>值。</li>
<li>如果<code>Bean</code>实现了<code>BeanFactoryAware</code>接口，则 Spring 调用<code>setBeanFactory()</code>方法传入当前工厂实例的引用。</li>
<li>如果<code>Bean</code>实现了<code>ApplicationContextAware</code>接口，则 Spring 调用<code>setApplicationContext()</code>方法传入当前<code>ApplicationContext</code>实例的引用。</li>
<li>如果<code>Bean</code>实现了<code>BeanPostProcessor</code>接口，则 Spring 将调用该接口的预初始化方法<code>postProcessBeforeInitialzation()</code>对<code>Bean</code>进行加工操作，此处非常重要，Spring 的 AOP 就是利用它实现的。</li>
<li>如果<code>Bean</code>实现了<code>InitializingBean</code>接口，则 Spring 将调用<code>afterPropertiesSet()</code>方法。</li>
<li>如果在配置文件中通过<code>init-method</code>属性指定了初始化方法，则调用该初始化方法。</li>
<li>如果<code>BeanPostProcessor</code>和<code>Bean</code>关联，则 Spring 将调用该接口的初始化方法<code>postProcessAfterInitialization()</code>。此时，<code>Bean</code>已经可以被应用系统使用了。</li>
<li>如果在<code>&lt;bean&gt;</code>中指定了该<code>Bean</code>的作用范围为<code>scope=&quot;singleton&quot;</code>，则将该<code>Bean</code>放入 Spring IoC 的缓存池中，将触发 Spring 对该<code>Bean</code>的生命周期管理；如果在<code>&lt;bean&gt;</code>中指定了该<code>Bean</code>的作用范围为<code>scope=&quot;prototype&quot;</code>，则将该<code>Bean</code>交给调用者，调用者管理该<code>Bean</code>的生命周期，Spring 不再管理该<code>Bean</code>。</li>
<li>如果<code>Bean</code>实现了<code>DisposableBean</code>接口，则 Spring 会调用<code>destory()</code>方法将 Spring 中的<code>Bean</code>销毁；如果在配置文件中通过<code>destory-method</code>属性指定了<code>Bean</code>的销毁方法，则 Spring 将调用该方法对<code>Bean</code>进行销毁。</li>
</ol>
<p>Spring 为<code>Bean</code>提供了细致全面的生命周期过程，通过实现特定的接口或<code>&lt;bean&gt;</code>的属性设置，都可以对<code>Bean</code>的生命周期过程产生影响。</p>
<p>了解 Spring 生命周期的意义就在于，可以利用<code>Bean</code>在其存活期间的指定时刻完成一些相关操作。一般情况下，会在<code>Bean</code>被初始化后和被销毁前执行一些相关操作。</p>
<p>Spring 提供了 3 种方法实现初始化回调和销毁回调：</p>
<ul>
<li>实现<code>InitializingBean</code>和<code>DisposableBean</code>接口；</li>
<li>在 XML 中配置<code>init-method</code>和<code>destory-method</code>；</li>
<li>使用<code>@PostConstruct</code>和<code>@PreDestory</code>注解。</li>
</ul>
<p>在一个<code>Bean</code>中有多种生命周期回调方法时，优先级为：注解 &gt; 接口 &gt; XML。不建议使用接口和注解，这会让<code>pojo</code>类和 Spring 框架紧耦合。</p>
<h2 id="初始化回调"><a href="#初始化回调" class="headerlink" title="初始化回调"></a>初始化回调</h2><h3 id="1-使用接口"><a href="#1-使用接口" class="headerlink" title="1. 使用接口"></a>1. 使用接口</h3><p><code>org.springframework.beans.factory.InitializingBean</code>接口提供了以下方法：<code>void afterPropertiesSet() throws Exception;</code>。</p>
<p>可以实现以上接口，在<code>afterPropertiesSet</code>方法内指定<code>Bean</code>初始化后需要执行的操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用接口：InitializingBean，方法：afterPropertiesSet，无参数&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-配置XML"><a href="#2-配置XML" class="headerlink" title="2. 配置XML"></a>2. 配置XML</h3><p>可以通过<code>init-method</code>属性指定<code>Bean</code>初始化后执行的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> init-method=<span class="string">&quot;init&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用init-method指定的初始化方法:init&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-使用注解"><a href="#3-使用注解" class="headerlink" title="3. 使用注解"></a>3. 使用注解</h3><p>使用<code>@PostConstruct</code>注解标明该方法为<code>Bean</code>初始化后的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;@PostConstruct注解指定的初始化方法:init&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="销毁回调"><a href="#销毁回调" class="headerlink" title="销毁回调"></a>销毁回调</h2><h3 id="1-使用接口-1"><a href="#1-使用接口-1" class="headerlink" title="1. 使用接口"></a>1. 使用接口</h3><p><code>org.springframework.beans.factory.DisposableBean</code>接口提供了以下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>
<p>您可以实现以上接口，在<code>destroy</code>方法内指定<code>Bean</code>初始化后需要执行的操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> /&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用接口：DisposableBean，方法：destroy，无参数&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-配置XML-1"><a href="#2-配置XML-1" class="headerlink" title="2. 配置XML"></a>2. 配置XML</h3><p>可以通过<code>destroy-method</code>属性指定<code>Bean</code>销毁后执行的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;...&quot;</span> class=<span class="string">&quot;...&quot;</span> destroy-method=<span class="string">&quot;destroy&quot;</span>/&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;调用destroy-method指定的销毁方法:destroy&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-使用注解-1"><a href="#3-使用注解-1" class="headerlink" title="3. 使用注解"></a>3. 使用注解</h3><p>使用<code>@PreDestory</code>注解标明该方法为 Bean 销毁前执行的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line">  <span class="meta">@PreDestory</span> </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;@PreDestory注解指定的初始化方法:destroy&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="默认的初始化和销毁方法"><a href="#默认的初始化和销毁方法" class="headerlink" title="默认的初始化和销毁方法"></a>默认的初始化和销毁方法</h2><p>如果多个<code>Bean</code>需要使用相同的初始化或者销毁方法，不用为每个<code>bean</code>声明初始化和销毁方法，可以使用<code>default-init-method</code>和<code>default-destroy-method</code>属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default-init-method</span>=<span class="string">&quot;init&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default-destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="后置处理器BeanPostProcessor"><a href="#后置处理器BeanPostProcessor" class="headerlink" title="后置处理器BeanPostProcessor"></a>后置处理器BeanPostProcessor</h1><p><code>BeanPostProcessor</code>接口也被称为后置处理器，通过该接口可以自定义调用初始化前后执行的操作方法。</p>
<p><code>BeanPostProcessor</code>接口源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">  Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">  Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>postProcessBeforeInitialization</code>在<code>Bean</code>实例化、依赖注入后，初始化前调用。<code>postProcessAfterInitialization</code>在<code>Bean</code>实例化、依赖注入、初始化都完成后调用。</p>
<p>当需要添加多个后置处理器实现类时，默认情况下 Spring 容器会根据后置处理器的定义顺序来依次调用。也可以通过实现<code>Ordered</code>接口的<code>getOrder</code>方法指定后置处理器的执行顺序。该方法返回值为整数，默认值为 0，值越大优先级越低。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String message;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message = message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Message : &quot;</span> + message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Bean正在初始化&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Bean将要被销毁&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitHelloWorld</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, Ordered &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;A Before : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;A After : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitHelloWorld2</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, Ordered &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B Before : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B After : &quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloWorld&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World！&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注册处理器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.InitHelloWorld&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.InitHelloWorld2&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.AbstractApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AbstractApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;Beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">HelloWorld</span> <span class="variable">obj</span> <span class="operator">=</span> (HelloWorld) context.getBean(<span class="string">&quot;helloWorld&quot;</span>);</span><br><span class="line">    obj.getMessage();</span><br><span class="line">    context.registerShutdownHook();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">B Before : helloWorld</span><br><span class="line">A Before : helloWorld</span><br><span class="line">Bean正在初始化</span><br><span class="line">B After : helloWorld</span><br><span class="line">A After : helloWorld</span><br><span class="line">Message : Hello World！</span><br><span class="line">Bean将要被销毁</span><br></pre></td></tr></table></figure>
<p>由运行结果可以看出，<code>postProcessBeforeInitialization</code>方法是在<code>Bean</code>实例化和依赖注入后，自定义初始化方法前执行的。而<code>postProcessAfterInitialization</code>方法是在自定义初始化方法后执行的。由于<code>getOrder</code>方法返回值越大，优先级越低，所以<code>InitHelloWorld2</code>先执行。</p>
<h1 id="Bean继承"><a href="#Bean继承" class="headerlink" title="Bean继承"></a>Bean继承</h1><p><code>Bean</code>定义可以包含很多配置信息，包括构造函数参数、属性值和容器的一些具体信息，如初始化方法、销毁方法等。子<code>Bean</code>可以继承父<code>Bean</code>的配置数据，根据需要，子<code>Bean</code>可以重写值或添加其它值。</p>
<p>需要注意的是，<code>Spring Bean</code>定义的继承与 Java 中的继承无关。您可以将父<code>Bean</code>的定义作为一个模板，其它子<code>Bean</code>从父<code>Bean</code>中继承所需的配置。</p>
<p>在配置文件中通过<code>parent</code>属性来指定继承的父<code>Bean</code>。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String message1;</span><br><span class="line">  <span class="keyword">private</span> String message2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage1</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message1 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage2</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message2 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;World Message1 : &quot;</span> + message1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;World Message2 : &quot;</span> + message2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloChina</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String message1;</span><br><span class="line">  <span class="keyword">private</span> String message2;</span><br><span class="line">  <span class="keyword">private</span> String message3;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage1</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message1 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage2</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message2 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage3</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.message3 = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;China Message1 : &quot;</span> + message1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;China Message2 : &quot;</span> + message2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage3</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;China Message3 : &quot;</span> + message3);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在配置文件中，分别为<code>HelloWorld</code>中的<code>message1</code>和<code>message2</code>赋值。使用<code>parent</code>属性将<code>HelloChain</code>定义为<code>HelloWorld</code>的子类，并为<code>HelloChain</code>中的<code>message1</code>和<code>message3</code>赋值。<code>Beans.xml</code>文件代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloWorld&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World！&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World2！&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloChina&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloChina&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;helloWorld&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China！&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China3！&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;Beans.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">HelloWorld</span> <span class="variable">objA</span> <span class="operator">=</span> (HelloWorld) context.getBean(<span class="string">&quot;helloWorld&quot;</span>);</span><br><span class="line">    objA.getMessage1();</span><br><span class="line">    objA.getMessage2();</span><br><span class="line"></span><br><span class="line">    <span class="type">HelloChina</span> <span class="variable">objB</span> <span class="operator">=</span> (HelloChina) context.getBean(<span class="string">&quot;helloChina&quot;</span>);</span><br><span class="line">    objB.getMessage1();</span><br><span class="line">    objB.getMessage2();</span><br><span class="line">    objB.getMessage3();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果如下。</span></span><br><span class="line"><span class="comment">//World Message1 : Hello World！</span></span><br><span class="line"><span class="comment">//World Message2 : Hello World2！</span></span><br><span class="line"><span class="comment">//China Message1 : Hello China！</span></span><br><span class="line"><span class="comment">//China Message2 : Hello World2！</span></span><br><span class="line"><span class="comment">//China Message3 : Hello China3！</span></span><br></pre></td></tr></table></figure>
<p>由结果可以看出，我们在创建<code>helloChina</code>时并没有给<code>message2</code>赋值，但是由于<code>Bean</code>的继承，将值传递给了<code>message2</code>。</p>
<h2 id="Bean定义模板"><a href="#Bean定义模板" class="headerlink" title="Bean定义模板"></a>Bean定义模板</h2><p>您可以创建一个<code>Bean</code>定义模板，该模板只能被继承，不能被实例化。创建<code>Bean</code>定义模板时，不用指定<code>class</code>属性，而是指定<code>abstarct=&quot;true&quot;</code>将该<code>Bean</code>定义为抽象<code>Bean</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanTeamplate&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World!&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World2!&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World3!&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloChina&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.biancheng.HelloChina&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;beanTeamplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China!&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;message3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello China!&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="Spring实例化Bean"><a href="#Spring实例化Bean" class="headerlink" title="Spring实例化Bean"></a>Spring实例化Bean</h1><p>在 Spring 中，实例化<code>Bean</code>有三种方式，分别是构造器实例化、静态工厂方式实例化和实例工厂方式实例化。</p>
<h2 id="构造器实例化"><a href="#构造器实例化" class="headerlink" title="构造器实例化"></a>构造器实例化</h2><p>构造器实例化是指 Spring 容器通过<code>Bean</code>对应的类中默认的构造函数实例化<code>Bean</code>。</p>
<p>在项目的<code>src</code>目录下创建一个名为<code>com.mengma.instance.constructor</code>的包，在该包下创建一个实体类<code>Person1</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.constructor;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person1</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>com.mengma.instance.constructor</code>包下创建 Spring 的配置文件<code>applicationContext.xml</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.instance.constructor.Person1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上述配置中，定义了一个<code>id</code>为<code>person1</code>的<code>Bean</code>，其中<code>class</code>属性指定了其对应的类为<code>Person1</code>。</p>
<p>在<code>com.mengma.instance.constructor</code>包下创建一个名为<code>InstanceTest1</code>的测试类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.constructor;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceTest1</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义Spring配置文件的路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="string">&quot;com/mengma/instance/constructor/ApplicationContext.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化Spring容器，加载配置文件，并对bean进行实例化</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(xmlPath);</span><br><span class="line">    <span class="comment">// 通过容器获取id为person1的实例</span></span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">&quot;person1&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述文件中，首先在<code>test()</code>方法中定义了 Spring 配置文件的路径，然后 Spring 容器会加载配置文件。在加载的同时，Spring 容器会通过实现类<code>Person1</code>中默认的无参构造函数对<code>Bean</code>进行实例化。</p>
<h2 id="静态工厂方式实例化"><a href="#静态工厂方式实例化" class="headerlink" title="静态工厂方式实例化"></a>静态工厂方式实例化</h2><p>也可以使用静态工厂的方式实例化<code>Bean</code>。此种方式需要提供一个静态工厂方法创建<code>Bean</code>的实例。</p>
<h3 id="1-创建实体类"><a href="#1-创建实体类" class="headerlink" title="1. 创建实体类"></a>1. 创建实体类</h3><p>在项目的<code>src</code>目录下创建一个名为<code>com.mengma.instance.static_factory </code>的包，并在该包下创建一个实体类<code>Person2</code>。</p>
<h3 id="2-创建静态工厂类"><a href="#2-创建静态工厂类" class="headerlink" title="2. 创建静态工厂类"></a>2. 创建静态工厂类</h3><p>在<code>com.mengma.instance.static_factory</code>包下创建一个名为<code>MyBeanFactory</code>的类，并在该类中创建一个名为<code>createBean()</code>的静态方法，用于创建<code>Bean</code>的实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.static_factory;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line">  <span class="comment">// 创建Bean实例的静态工厂方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Person2 <span class="title function_">createBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person2</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-创建-Spring-配置文件"><a href="#3-创建-Spring-配置文件" class="headerlink" title="3. 创建 Spring 配置文件"></a>3. 创建 Spring 配置文件</h3><p>在<code>com.mengma.instance.static_factory</code>包下创建 Spring 的配置文件<code>applicationContext.xml</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.instance.static_factory.MyBeanFactory&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">factory-method</span>=<span class="string">&quot;createBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码中，定义了一个<code>id</code>为<code>person2</code>的<code>Bean</code>，其中<code>class</code>属性指定了其对应的工厂实现类为<code>MyBeanFactory</code>，而<code>factory-method</code>属性用于告诉 Spring 容器调用工厂类中的<code>createBean()</code>方法获取<code>Bean</code>的实例。</p>
<h3 id="4-创建测试类"><a href="#4-创建测试类" class="headerlink" title="4. 创建测试类"></a>4. 创建测试类</h3><p>在<code>com.mengma.instance.static_factory</code>包下创建一个名为<code>InstanceTest2</code>的测试类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.static_factory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceTest2</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义Spring配置文件的路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="string">&quot;com/mengma/instance/static_factory/applicationContext.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化Spring容器，加载配置文件，并对bean进行实例化</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(xmlPath);</span><br><span class="line">    <span class="comment">// 通过容器获取id为person2实例</span></span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">&quot;person2&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实例工厂方式实例化"><a href="#实例工厂方式实例化" class="headerlink" title="实例工厂方式实例化"></a>实例工厂方式实例化</h2><p>还有一种实例化<code>Bean</code>的方式就是采用实例工厂。在这种方式中，工厂类不再使用静态方法创建<code>Bean</code>的实例，而是直接在成员方法中创建<code>Bean</code>的实例。</p>
<p>同时，在配置文件中，需要实例化的<code>Bean</code>也不是通过<code>class</code>属性直接指向其实例化的类，而是通过<code>factory-bean</code>属性配置一个实例工厂，然后使用<code>factory-method</code>属性确定使用工厂中的哪个方法。</p>
<h3 id="1-创建实体类-1"><a href="#1-创建实体类-1" class="headerlink" title="1. 创建实体类"></a>1. 创建实体类</h3><p>在<code>src</code>目录下创建一个名为<code>com.mengma.instance.factory</code>的包，在该包下创建一个<code>Person3</code>类。</p>
<h3 id="2-创建实例工厂类"><a href="#2-创建实例工厂类" class="headerlink" title="2. 创建实例工厂类"></a>2. 创建实例工厂类</h3><p>在<code>com.mengma.instance.factory</code>包下创建一个名为<code>MyBeanFactory</code>的类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.factory;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MyBeanFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;person3工厂实例化中&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 创建Bean的方法</span></span><br><span class="line">  <span class="keyword">public</span> Person3 <span class="title function_">createBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person3</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码中，使用默认无参的构造方法输出<code>person3</code>工厂实例化中语句，使用<code>createBean</code>成员方法创建<code>Bean</code>的实例。</p>
<h3 id="3-创建-Spring-配置文件-1"><a href="#3-创建-Spring-配置文件-1" class="headerlink" title="3. 创建 Spring 配置文件"></a>3. 创建 Spring 配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置实例工厂 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mengma.instance.factory.MyBeanFactory&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- factory-bean属性指定一个实例工厂，factory-method属性确定使用工厂中的哪个方法 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person3&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myBeanFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;createBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码中，首先配置了一个实例工厂<code>Bean</code>，然后配置了需要实例化的<code>Bean</code>。在<code>id</code>为<code>person3</code>的<code>Bean</code>中，使用<code>factory-bean</code>属性指定一个实例工厂，该属性值就是实例工厂的<code>id</code>属性值。使用<code>factory-method</code>属性确定使用工厂中的<code>createBean()</code>方法。</p>
<h3 id="4-创建测试类-1"><a href="#4-创建测试类-1" class="headerlink" title="4. 创建测试类"></a>4. 创建测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengma.instance.factory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceTest3</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义Spring配置文件的路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="string">&quot;com/mengma/instance/factory/applicationContext.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化Spring容器，加载配置文件，并对bean进行实例化</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(xmlPath);</span><br><span class="line">    <span class="comment">// 通过容器获取id为person3实例</span></span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">&quot;person3&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/Spring/Spring 入门"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/15/java/Spring/Spring%20%E5%85%A5%E9%97%A8/"
    >Spring 入门</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/05/15/java/Spring/Spring%20%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2021-05-15T08:24:15.000Z" itemprop="datePublished">2021-05-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>Spring 包括许多框架，例如 Spring framework、SpringMVC、SpringBoot、Spring Cloud、Spring Data、Spring Security 等。Spring framework 就是我们平时说的 Spring 框架。</p>
<p>Spring 是分层的 Java SE&#x2F;EE 一站式轻量级开源框架，以 IoC（<code>Inverse of Control</code>，控制反转）和 AOP（<code>Aspect Oriented Programming</code>，面向切面编程）为内核。</p>
<p>IoC 指的是将对象的创建权交给 Spring 去创建。使用 Spring 之前，对象的创建都是由我们使用<code>new</code>创建，而使用 Spring 之后，对象的创建都交给了 Spring 框架。AOP 用来封装多个类的公共行为，将那些与业务无关，却为业务模块所共同调用的逻辑封装起来，减少系统的重复代码，降低模块间的耦合度。另外，AOP 还解决一些系统层面上的问题，比如日志、事务、权限等。</p>
<p>在实际开发中，通常服务器端采用三层体系架构，分别为表现层（<code>web</code>）、业务逻辑层（<code>service</code>）、持久层（<code>dao</code>）。</p>
<p>Spring 对每一层都提供了技术支持，在表现层提供了与 Spring MVC、Struts2 框架的整合，在业务逻辑层可以管理事务和记录日志等，在持久层可以整合 MyBatis、Hibernate 和 JdbcTemplate 等技术。</p>
<p>Spring 框架的主要优点：</p>
<ol>
<li>方便解耦，简化开发。Spring 就是一个大工厂，可以将所有对象的创建和依赖关系的维护交给 Spring 管理。</li>
<li>方便集成各种优秀框架，Spring 其内部提供了对各种优秀框架的直接支持。</li>
<li>降低 Java EE API 的使用难度，Spring 对 Java EE 开发中非常难用的一些 API都提供了封装，使这些 API 应用的难度大大降低。</li>
<li>方便程序的测试。Spring 支持 JUnit4，可以通过注解方便地测试 Spring 程序。</li>
<li>AOP 编程的支持。Spring 提供面向切面编程，可以方便地实现对程序进行权限拦截和运行监控等功能。</li>
<li>声明式事务的支持。只需要通过配置就可以完成对事务的管理，而无须手动编程。</li>
</ol>
<p>Spring 框架采用分层架构，根据不同的功能被划分成了多个模块，这些模块大体可分为<code>Data Access/Integration、Web、AOP、Aspects、Messaging、Instrumentation、Core Container</code>和<code>Test</code>。</p>
<img src="/2021/05/15/java/Spring/Spring%20%E5%85%A5%E9%97%A8/1.png" class="">

<ol>
<li>Data Access&#x2F;Integration（数据访问／集成）<br>数据访问&#x2F;集成层包括 JDBC、ORM、OXM、JMS 和 Transactions 模块。</li>
</ol>
<ul>
<li>JDBC 模块(<code>spring-jdbc</code>)：提供了一个 JDBC 的抽象层，大幅度减少了在开发过程中对数据库操作的编码。</li>
<li>ORM 模块(<code>spring-orm</code>)：对流行的对象关系映射 API，包括 JPA、JDO、Hibernate 和 iBatis 提供了的集成层。</li>
<li>OXM 模块(<code>spring-oxm</code>)：提供了一个支持对象&#x2F;XML 映射的抽象层实现，如 JAXB、Castor、XMLBeans、JiBX 和 XStream。</li>
<li>JMS 模块(<code>spring-jms</code>)：指 Java 消息服务，包含的功能为生产和消费的信息。</li>
<li>Transactions 事务模块(<code>spring-tx</code>)：支持编程和声明式事务管理实现特殊接口类，以及所有的 POJO。</li>
</ul>
<ol start="2">
<li>Web 模块<br>Spring 的 Web 层包括 Web、Servlet、Struts 和 Portlet 组件。</li>
</ol>
<ul>
<li>Web 模块(<code>spring-web</code>)：提供了基本的 Web 开发集成特性，例如多文件上传功能、使用的 Servlet 监听器的 IoC 容器初始化以及 Web 应用上下文。</li>
<li>Servlet 模块(<code>spring-webmvc</code>)：包括 Spring 模型—视图—控制器（MVC）实现 Web 应用程序。</li>
<li>Struts 模块：包含支持类内的 Spring 应用程序，集成了经典的 Struts Web 层。</li>
<li>Portlet 模块(<code>spring-webmvc-portlet</code>)：提供了在 Portlet 环境中使用 MVC 实现，类似 Web-Servlet 模块的功能。</li>
</ul>
<ol start="3">
<li>Core Container（核心容器）<br>Spring 的核心容器是其他模块建立的基础，由<code>Beans</code>模块、<code>Core</code>核心模块、<code>Context</code>上下文模块和<code>Expression Language</code>表达式语言模块组成。</li>
</ol>
<ul>
<li>Beans 模块(<code>spring-beans</code>)：提供了<code>BeanFactory</code>，是工厂模式的经典实现，Spring 将管理对象称为<code>Bean</code>。</li>
<li>Core 核心模块(<code>spring-core</code>)：提供了 Spring 框架的基本组成部分，包括 IoC 和 DI 功能。</li>
<li>Context 上下文模块(<code>spring-context</code>)：建立在核心和<code>Beans</code>模块的基础之上，它是访问定义和配置任何对象的媒介。<code>ApplicationContext</code>接口是上下文模块的焦点。</li>
<li>Expression Language 模块(<code>spring-expression</code>)：是运行时查询和操作对象图的强大的表达式语言。</li>
</ul>
<ol start="4">
<li>其他模块<br>Spring的其他模块还有 AOP、Aspects、Instrumentation 以及 Test 模块。</li>
</ol>
<ul>
<li>AOP 模块(<code>spring-aop</code>)：提供了面向切面编程实现，允许定义方法拦截器和切入点，将代码按照功能进行分离，以降低耦合性。</li>
<li>Aspects 模块(<code>spring-aspects</code>)：提供与 AspectJ 的集成，是一个功能强大且成熟的面向切面编程（AOP）框架。</li>
<li>Instrumentation 模块(<code>spring-instrument</code>)：提供了类工具的支持和类加载器的实现，可以在特定的应用服务器中使用。</li>
<li>Test 模块(<code>spring-test</code>)：支持 Spring 组件，使用 JUnit 或 TestNG 框架的测试。</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-MySQL/MySQL字符集和校对规则"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/16/MySQL/MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%A0%A1%E5%AF%B9%E8%A7%84%E5%88%99/"
    >MySQL 字符集和校对规则</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/16/MySQL/MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%A0%A1%E5%AF%B9%E8%A7%84%E5%88%99/" class="article-date">
  <time datetime="2021-04-16T06:59:13.000Z" itemprop="datePublished">2021-04-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a> / <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">MySQL</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>字符（<code>Character</code>）是计算机中字母、数字、符号的统称，一个字符可以是一个中文汉字、一个英文字母、一个阿拉伯数字、一个标点符号等。</p>
<p>计算机是以二进制的形式来存储数据的。平时我们在显示器上看到的数字、英文、标点符号、汉字等字符都是二进制数转换之后的结果。</p>
<p>字符集（<code>Character set</code>）定义了字符和二进制的对应关系，为字符分配了唯一的编号。常见的字符集有 ASCII、GBK、IOS-8859-1 等。</p>
<p>字符编码（<code>Character encoding</code>）也可以称为字集码，规定了如何将字符的编号存储到计算机中。<br>大部分字符集都只对应一种字符编码，例如：ASCII、IOS-8859-1、GB2312、GBK，都是既表示了字符集又表示了对应的字符编码。所以一般情况下，可以将两者视为同义词。Unicode 字符集除外，Unicode 有三种编码方案，即 UTF-8、UTF-16 和 UTF-32。最为常用的是 UTF-8 编码。</p>
<p>校对规则（<code>Collation</code>）也可以称为排序规则，是指在同一个字符集内字符之间的比较规则。字符集和校对规则是一对多的关系，每个字符集都有一个默认的校对规则。字符集和校对规则相辅相成，相互依赖关联。</p>
<p>简单来说，字符集用来定义 MySQL 存储字符串的方式，校对规则用来定义 MySQL 比较字符串的方式。</p>
<p>有些数据库并没有清晰的区分开字符集和校对规则。例如，在 SQL Server 中创建数据库时，选择字符集就相当于选定了字符集和校对规则。</p>
<p>而在 MySQL 中，字符集和校对规则是区分开的，必须设置字符集和校对规则。一般情况下，没有特殊需求，只设置其一即可。只设置字符集时，MySQL 会将校对规则设置为字符集中对应的默认校对规则。</p>
<p>可以通过<code>SHOW VARIABLES LIKE &#39;character%&#39;;</code>命令查看当前 MySQL 使用的字符集，命令和运行结果如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+---------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name            <span class="operator">|</span> <span class="keyword">Value</span>                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+---------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> character_set_client     <span class="operator">|</span> gbk                                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_set_connection <span class="operator">|</span> gbk                                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_set_database   <span class="operator">|</span> latin1                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_set_filesystem <span class="operator">|</span> <span class="type">binary</span>                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_set_results    <span class="operator">|</span> gbk                                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_set_server     <span class="operator">|</span> latin1                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_set_system     <span class="operator">|</span> utf8                                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> character_sets_dir       <span class="operator">|</span> C:\Program Files\MySQL\MySQL Server <span class="number">5.7</span>\share\charsets\ <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+---------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>上述运行结果说明如下表所示：</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">character_set_client</td>
<td align="center">MySQL 客户端使用的字符集</td>
</tr>
<tr>
<td align="center">character_set_connection</td>
<td align="center">连接数据库时使用的字符集</td>
</tr>
<tr>
<td align="center">character_set_database</td>
<td align="center">创建数据库使用的字符集</td>
</tr>
<tr>
<td align="center">character_set_filesystem</td>
<td align="center">MySQL 服务器文件系统使用的字符集，默认值为 binary，不做任何转换</td>
</tr>
<tr>
<td align="center">character_set_results</td>
<td align="center">数据库给客户端返回数据时使用的字符集</td>
</tr>
<tr>
<td align="center">character_set_server</td>
<td align="center">MySQL 服务器使用的字符集，建议由系统自己管理，不要人为定义</td>
</tr>
<tr>
<td align="center">character_set_system</td>
<td align="center">数据库系统使用的字符集，默认值为 utf8，不需要设置</td>
</tr>
<tr>
<td align="center">character_sets_dir</td>
<td align="center">字符集的安装目录</td>
</tr>
</tbody></table>
<p>乱码时，不需要关心<code>character_set_filesystem、character_set_system</code>和<code>character_sets_dir</code>这 3 个系统变量，它们不会影响乱码 。</p>
<p>可以通过<code>SHOW VARIABLES LIKE &#39;collation\_%&#39;;</code>命令查看当前 MySQL 使用的校对规则，命令和运行结果如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;collation\_%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> collation_connection <span class="operator">|</span> gbk_chinese_ci    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> collation_database   <span class="operator">|</span> latin1_swedish_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> collation_server     <span class="operator">|</span> latin1_swedish_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+-------------------+</span></span><br></pre></td></tr></table></figure>
<p>对上述运行结果说明如下：</p>
<ul>
<li><code>collation_connection</code>：连接数据库时使用的校对规则</li>
<li><code>collation_database</code>：创建数据库时使用的校对规则</li>
<li><code>collation_server</code>：MySQL 服务器使用的校对规则</li>
</ul>
<p>校对规则命令约定如下：</p>
<ul>
<li>以校对规则所对应的字符集名开头</li>
<li>以国家名居中（或以 general 居中）</li>
<li>以 ci、cs 或 bin 结尾，ci 表示大小写不敏感，cs 表示大小写敏感，bin 表示按二进制编码值比较。</li>
</ul>
<h2 id="MySQL字符集的转换过程"><a href="#MySQL字符集的转换过程" class="headerlink" title="MySQL字符集的转换过程"></a>MySQL字符集的转换过程</h2><p>MySQL 中字符集的转换过程如下：</p>
<ol>
<li>在命令提示符窗口（cmd 命令行）中执行 MySQL 命令或 sql 语句时，这些命令或语句从“命令提示符窗口字符集”转换为“character_set_client”定义的字符集。</li>
<li>使用命令提示符窗口成功连接 MySQL 服务器后，就建立了一条“数据通信链路”，MySQL 命令或 sql 语句沿着“数据链路”传向 MySQL 服务器，由<code>character_set_client</code>定义的字符集转换为<code>character_set_connection</code>定义的字符集。</li>
<li>MySQL 服务实例收到数据通信链路中的 MySQL 命令或 sql 语句后，将 MySQL 命令或 sql 语句从<code>character_set_connection</code>定义的字符集转换为<code>character_set_server</code>定义的字符集。</li>
<li>若 MySQL 命令或 sql 语句针对于某个数据库进行操作，此时将 MySQL 命令或 sql 语句从<code>character_set_server</code>定义的字符集转换为<code>character_set_database</code>定义的字符集。</li>
<li>MySQL 命令或 sql 语句执行结束后，将执行结果设置为<code>character_set_results</code>定义的字符集。</li>
<li>执行结果沿着打开的数据通信链路原路返回，将执行结果从<code>character_set_results</code>定义的字符集转换为<code>character_set_client</code>定义的字符集，最终转换为命令提示符窗口字符集，显示到命令提示符窗口中。</li>
</ol>
<h1 id="查看字符集和校对规则"><a href="#查看字符集和校对规则" class="headerlink" title="查看字符集和校对规则"></a>查看字符集和校对规则</h1><p>在 MySQL 中，查看可用字符集的命令和执行过程如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="type">CHARACTER</span> <span class="keyword">set</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------------------------------+---------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Charset  <span class="operator">|</span> Description                     <span class="operator">|</span> <span class="keyword">Default</span> <span class="keyword">collation</span>   <span class="operator">|</span> Maxlen <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------------------------------+---------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> big5     <span class="operator">|</span> Big5 Traditional Chinese        <span class="operator">|</span> big5_chinese_ci     <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> dec8     <span class="operator">|</span> <span class="type">DEC</span> West European               <span class="operator">|</span> dec8_swedish_ci     <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ascii    <span class="operator">|</span> US ASCII                        <span class="operator">|</span> ascii_general_ci    <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> gb2312   <span class="operator">|</span> GB2312 Simplified Chinese       <span class="operator">|</span> gb2312_chinese_ci   <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> greek    <span class="operator">|</span> ISO <span class="number">8859</span><span class="number">-7</span> Greek                <span class="operator">|</span> greek_general_ci    <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cp1250   <span class="operator">|</span> Windows Central European        <span class="operator">|</span> cp1250_general_ci   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> gbk      <span class="operator">|</span> GBK Simplified Chinese          <span class="operator">|</span> gbk_chinese_ci      <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>其中：<br>第一列（<code>Charset</code>）为字符集名称；<br>第二列（<code>Description</code>）为字符集描述；<br>第三列（<code>Default collation</code>）为字符集的默认校对规则；<br>第四列（<code>Maxlen</code>）表示字符集中一个字符占用的最大字节数。</p>
<p>常用的字符集如下：</p>
<ul>
<li><code>gbk</code>支持中文简体字符。</li>
<li><code>big5</code>支持中文繁体字符。</li>
<li><code>utf8</code>几乎支持所有国家的字符。</li>
</ul>
<p>也可以通过查询<code>information_schema.character_set</code>表中的记录，来查看 MySQL 支持的字符集。SQL 语句和执行过程如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.character_sets;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+----------------------+---------------------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> CHARACTER_SET_NAME <span class="operator">|</span> DEFAULT_COLLATE_NAME <span class="operator">|</span> DESCRIPTION                     <span class="operator">|</span> MAXLEN <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+----------------------+---------------------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> big5               <span class="operator">|</span> big5_chinese_ci      <span class="operator">|</span> Big5 Traditional Chinese        <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> dec8               <span class="operator">|</span> dec8_swedish_ci      <span class="operator">|</span> <span class="type">DEC</span> West European               <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cp850              <span class="operator">|</span> cp850_general_ci     <span class="operator">|</span> DOS West European               <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> hp8                <span class="operator">|</span> hp8_english_ci       <span class="operator">|</span> HP West European                <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>可以使用<code>SHOW COLLATION LIKE &#39;***&#39;;</code>命令来查看相关字符集的校对规则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW COLLATION LIKE &#x27;gbk%&#x27;;</span><br><span class="line">+----------------+---------+----+---------+----------+---------+</span><br><span class="line">| Collation      | Charset | Id | Default | Compiled | Sortlen |</span><br><span class="line">+----------------+---------+----+---------+----------+---------+</span><br><span class="line">| gbk_chinese_ci | gbk     | 28 | Yes     | Yes      |       1 |</span><br><span class="line">| gbk_bin        | gbk     | 87 |         | Yes      |       1 |</span><br><span class="line">+----------------+---------+----+---------+----------+---------+</span><br></pre></td></tr></table></figure>
<p>上面运行结果为 GBK 字符集所对应的校对规则，其中<code>gbk_chinese_ci</code>是默认的校对规则，对大小写不敏感。而<code>gbk_bin</code>按照二进制编码的值进行比较，对大小写敏感。</p>
<p>也可以通过查询<code>information_schema.COLLATIONS</code>表中的记录，来查看 MySQL 中可用的校对规则。SQL 语句和执行过程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM information_schema.COLLATIONS;</span><br><span class="line">+--------------------------+--------------------+-----+------------+-------------+---------+</span><br><span class="line">| COLLATION_NAME           | CHARACTER_SET_NAME | ID  | IS_DEFAULT | IS_COMPILED | SORTLEN |</span><br><span class="line">+--------------------------+--------------------+-----+------------+-------------+---------+</span><br><span class="line">| big5_chinese_ci          | big5               |   1 | Yes        | Yes         |       1 |</span><br><span class="line">| big5_bin                 | big5               |  84 |            | Yes         |       1 |</span><br><span class="line">| dec8_swedish_ci          | dec8               |   3 | Yes        | Yes         |       1 |</span><br><span class="line">| dec8_bin                 | dec8               |  69 |            | Yes         |       1 |</span><br><span class="line">| cp850_general_ci         | cp850              |   4 | Yes        | Yes         |       1 |</span><br><span class="line">| cp850_bin                | cp850              |  80 |            | Yes         |       1 |</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>分别指定“A”和“a”按照<code>gbk_chinese_ci</code>和<code>gbk_bin</code>校对规则进行比较。SQL 语句和运行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT CASE WHEN &#x27;A&#x27; COLLATE gbk_chinese_ci = &#x27;a&#x27; COLLATE gbk_chinese_ci then 1</span><br><span class="line">    -&gt; else 0 end;</span><br><span class="line">+-------------------------------------------------------------------------------------+</span><br><span class="line">| CASE WHEN &#x27;A&#x27; COLLATE gbk_chinese_ci = &#x27;a&#x27; COLLATE gbk_chinese_ci then 1</span><br><span class="line">else 0 end |</span><br><span class="line">+-------------------------------------------------------------------------------------+</span><br><span class="line">|                                                                                   1 |</span><br><span class="line">+-------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT CASE WHEN &#x27;A&#x27; COLLATE gbk_bin = &#x27;a&#x27; COLLATE gbk_bin then 1 else 0 end;</span><br><span class="line">+-----------------------------------------------------------------------+</span><br><span class="line">| CASE WHEN &#x27;A&#x27; COLLATE gbk_bin = &#x27;a&#x27; COLLATE gbk_bin then 1</span><br><span class="line">else 0 end |</span><br><span class="line">+-----------------------------------------------------------------------+</span><br><span class="line">|                                                                     0 |</span><br><span class="line">+-----------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>由于<code>gbk_chinese_ci</code>校对规则忽略大小写，所以认为两个“A“和“a”是相同的。<code>gbk_bin</code>校对规则不忽略大小写，则认为两个字符是不同的。</p>
<p>在实际应用中，我们应事先确认应用需要按照什么样方式排序，是否区分大小写，然后选择相应的校对规则。</p>
<h1 id="设置默认字符集和校对规则"><a href="#设置默认字符集和校对规则" class="headerlink" title="设置默认字符集和校对规则"></a>设置默认字符集和校对规则</h1><p>MySQL 服务器可以支持多种字符集，在同一台服务器、同一个数据库甚至同一个表的不同字段中，都可以使用不同的字符集。Oracle 等其它数据库管理系统都只能使用相同的字符集，相比之下，MySQL 明显存在更大的灵活性。</p>
<p>MySQL 的字符集和校对规则有 4 个级别的默认设置，即服务器级、数据库级、表级和字段级。它们分别在不同的地方设置，作用也不相同。</p>
<h2 id="服务器字符集和校对规则"><a href="#服务器字符集和校对规则" class="headerlink" title="服务器字符集和校对规则"></a>服务器字符集和校对规则</h2><p>修改服务器默认字符集和校对规则的方法如下。</p>
<p>1）可以在<code>my.ini</code>配置文件中设置服务器字符集和校对规则，添加内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">character-set-server=字符集名称</span><br></pre></td></tr></table></figure>
<p>2）连接 MySQL 服务器时指定字符集：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --default-character-set=字符集名称 -h 主机IP地址 -u 用户名 -p 密码</span><br></pre></td></tr></table></figure>
<p>如果没有指定服务器字符集，MySQL 会默认使用 latin1 作为服务器字符集。如果只指定了字符集，没有指定校对规则，MySQL 会使用该字符集对应的默认校对规则。如果要使用字符集的非默认校对规则，需要在指定字符集的同时指定校对规则。</p>
<p>可以用<code>SHOW VARIABLES LIKE &#39;character_set_server&#39;</code>和<code>SHOW VARIABLES LIKE &#39;collation_server&#39;</code>命令查询当前服务器的字符集和校对规则。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character_set_server&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> character_set_server <span class="operator">|</span> gbk    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;collation_server&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> collation_server <span class="operator">|</span> gbk_chinese_ci    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="数据库字符集和校对规则"><a href="#数据库字符集和校对规则" class="headerlink" title="数据库字符集和校对规则"></a>数据库字符集和校对规则</h2><p>数据库的字符集和校对规则在创建数据库时指定，也可以在创建完数据库后通过<code>ALTER DATABASE</code>命令进行修改。</p>
<p>需要注意的是，如果数据库里已经存在数据，修改字符集后，已有的数据不会按照新的字符集重新存放，所以不能通过修改数据库的字符集来修改数据的内容。</p>
<p>设置数据库字符集的规则如下：</p>
<ul>
<li>如果指定了字符集和校对规则，则使用指定的字符集和校对规则；</li>
<li>如果指定了字符集没有指定校对规则，则使用指定字符集的默认校对规则；</li>
<li>如果指定了校对规则但未指定字符集，则字符集使用与该校对规则关联的字符集；</li>
<li>如果没有指定字符集和校对规则，则使用服务器字符集和校对规则作为数据库的字符集和校对规则。</li>
</ul>
<p>为了避免受到默认值的影响，推荐在创建数据库时指定字符集和校对规则。</p>
<p>可以使用<code>SHOW VARIABLES LIKE &#39;character_set_database&#39;</code>和<code>SHOW VARIABLES LIKE &#39;collation_database&#39;</code>命令查看当前数据库的字符集和校对规则。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character_set_database&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name          <span class="operator">|</span> <span class="keyword">Value</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> character_set_database <span class="operator">|</span> latin1 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;collation_database&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name      <span class="operator">|</span> <span class="keyword">Value</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> collation_database <span class="operator">|</span> latin1_swedish_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="表字符集和校对规则"><a href="#表字符集和校对规则" class="headerlink" title="表字符集和校对规则"></a>表字符集和校对规则</h2><p>表的字符集和校对规则在创建表的时候指定，也可以在创建完表后通过<code>ALTER TABLE</code>命令进行修改。</p>
<p>同样，如果表中已有记录，修改字符集后，原有的记录不会按照新的字符集重新存放。表的字段仍然使用原来的字符集。</p>
<p>设置表的字符集规则和设置数据库字符集的规则基本类似：</p>
<ul>
<li>如果指定了字符集和校对规则，使用指定的字符集和校对规则；</li>
<li>如果指定了字符集没有指定校对规则，使用指定字符集的默认校对规则；</li>
<li>如果指定了校对规则但未指定字符集，则字符集使用与该校对规则关联的字符集；</li>
<li>如果没有指定字符集和校对规则，使用数据库字符集和校对规则作为表的字符集和校对规则。</li>
</ul>
<p>为了避免受到默认值的影响，推荐在创建表的时候指定字符集和校对规则。</p>
<p>可以使用<code>SHOW CREATE TABLE</code>命令查看当前表的字符集和校对规则，SQL 语句和运行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE tb_students_info \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: tb_students_info</span><br><span class="line">Create Table: CREATE TABLE `tb_students_info` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(10) DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `sex` char(1) DEFAULT NULL,</span><br><span class="line">  `height` float DEFAULT NULL,</span><br><span class="line">  `course_id` int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="列字符集和校对规则"><a href="#列字符集和校对规则" class="headerlink" title="列字符集和校对规则"></a>列字符集和校对规则</h2><p>MySQL 可以定义列级别的字符集和校对规则，主要是针对相同表的不同字段需要使用不同字符集的情况。一般遇到这种情况的几率比较小，这只是 MySQL 提供给我们一个灵活设置的手段。</p>
<p>列字符集和校对规则的定义可以在创建表时指定，或者在修改表时调整。语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 MODIFY 列名  数据类型 CHARACTER SET 字符集名;</span><br></pre></td></tr></table></figure>
<p>修改<code>tb_students_info</code>表中<code>name</code>列的字符集，并查看。SQL 语句和运行结果如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_students_info MODIFY name <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> gbk;</span><br><span class="line">Query OK, <span class="number">11</span> <span class="keyword">rows</span> affected (<span class="number">0.11</span> sec)</span><br><span class="line">Records: <span class="number">11</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span>  <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb_students_info \G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">       <span class="keyword">Table</span>: tb_students_info</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_students_info` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> gbk <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `sex` <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `height` <span class="type">float</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `course_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">12</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>结果显示，name 列字符集修改成功。<br>如果在创建列的时候没有特别指定字符集和校对规则，默认使用表的字符集和校对规则。</p>
<h2 id="连接字符集和校对规则"><a href="#连接字符集和校对规则" class="headerlink" title="连接字符集和校对规则"></a>连接字符集和校对规则</h2><p>上面所讲的 4 种设置方式，确定的都是数据保存的字符集和校对规则。实际应用中，还需要设置客户端和服务器之间交互的字符集和校对规则。</p>
<p>对于客户端和服务器的交互操作，MySQL 提供了 3 个不同的参数：<code>character_set_client、character_set_connection</code>和<code>character_set_results</code>，分别代表客户端、连接和返回结果的字符集。通常情况下，这 3 个字符集是相同的，这样可以确保正确读出用户写入的数据，尤其是中文字符。字符集不同时，容易导致写入的记录不能正确读出。</p>
<p>设置客户端和服务器连接的字符集和校对规则有以下几种方法：</p>
<p>1）在 my.ini 配置文件中，设置以下语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line">default-character-set=gbk</span><br></pre></td></tr></table></figure>
<p>这样服务器启动后，所有连接默认使用 GBK 字符集进行连接。</p>
<p>2）可以通过以下命令来设置连接的字符集和校对规则，这个命令可以同时修改以上 3 个参数（<code>character_set_client、character_set_connection</code>和<code>character_set_results</code>）的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET NAMES gbk;</span><br></pre></td></tr></table></figure>
<p>使用这个方法可以“临时一次性地”修改客户端和服务器连接时的字符集为 gbk。</p>
<p>3）MySQL 还提供了下列 MySQL 命令“临时地”修改 MySQL“当前会话的”字符集和校对规则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">set character_set_client = gbk;</span><br><span class="line">set character_set_connection = gbk;</span><br><span class="line">set character_set_database = gbk;</span><br><span class="line">set character_set_results = gbk;</span><br><span class="line">set character_set_server = gbk;</span><br><span class="line">set collation_connection = gbk_chinese_ci;</span><br><span class="line">set collation_database = gbk_chinese_ci;</span><br><span class="line">set collation_server = gbk_chinese_ci;</span><br></pre></td></tr></table></figure>
<h1 id="修改字符集步骤"><a href="#修改字符集步骤" class="headerlink" title="修改字符集步骤"></a>修改字符集步骤</h1><p><code>ALTER DATABASE</code>或<code>ALTER TABLE</code>命令对已经存在的数据没有作用，只对新创建的表或记录生效。如果想修改已存在数据的字符集，需要先将数据导出，经过适当的调整后，再重新导入。</p>
<p>以下模拟的是将 gb2312 字符集的数据库修改成 gbk 字符集的数据库的过程。</p>
<p>1）创建 testset 数据库，设置其字符集为 gb2312，并添加数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.testset(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> name <span class="type">VARCHAR</span>(<span class="number">25</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> )CHARSET<span class="operator">=</span>gb2312;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.10</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.testset <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;C语言&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.testset <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">&#x27;Java语言&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.testset <span class="keyword">VALUES</span> (<span class="number">3</span>,<span class="string">&#x27;Python语言&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>2）导出 testset 表结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p --default-character-set=gbk -d test testset&gt; D:\testset.sql</span><br></pre></td></tr></table></figure>
<p>其中，<code>--default-character-set=gbk</code>表示以什么字符集连接；-d 表示只导出表结构，不导出数据。</p>
<p>3）打开 testset.sql 文件，修改表结构定义中的字符集为新的字符集，如下图所示。</p>
<p>修改表结构的字符集</p>
<p>4）确保表中的记录不再更新，导出所有记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="comment">--quick --no-create-info --extended-insert --default-character-set=gb2312 test testset&gt; D:\testdata.sql</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>--quick</code>：该选项用于存储记录多的表。它强制 mysqldump 从服务器一次一行地查询表中的行，而不是查询所有行，并在输出前将它缓存到内存中。</li>
<li><code>--extended-insert</code>：使用 INSERT 插入多行数据语法。可以使文件更小，导入文件时加速插入。</li>
<li><code>--no-create-info</code>：不导出表的 CREATE TABLE 语句。</li>
<li><code>--default-character-set=gb2312</code>：按照原有的字符集导出所有数据。这样导出的文件中，所有中文都是可见的，不会保存成乱码。</li>
</ul>
<p>5）打开 testdata.sql，将<code>SET NAMES gb2312</code>修改成<code>SET NAMES gbk</code>，如下图所示。</p>
<p>6）使用新的字符集创建新的数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE test2 <span class="keyword">DEFAULT</span> CHARSET gbk;</span><br></pre></td></tr></table></figure>
<p>7）创建表，执行 testset.sql。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p test2 &lt; D:\testset.sql</span><br></pre></td></tr></table></figure>
<p>8）导入数据，执行 testdata.sql。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p test2 &lt; D:\testdata.sql</span><br></pre></td></tr></table></figure>
<p>9）查看 testset 表结构是否修改了字符集，以及表内数据是否丢失或乱码，SQL 语句和运行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE test2.testset \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: testset</span><br><span class="line">Create Table: CREATE TABLE `testset` (</span><br><span class="line">  `id` int(11) DEFAULT NULL,</span><br><span class="line">  `name` varchar(25) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=gbk</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM test2.testset;</span><br><span class="line">+------+------------+</span><br><span class="line">| id   | name       |</span><br><span class="line">+------+------------+</span><br><span class="line">|    1 | C语言      |</span><br><span class="line">|    2 | Java语言   |</span><br><span class="line">|    3 | Python语言 |</span><br><span class="line">+------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>注意：选择目标字符集的时候，要注意最好的是原字符集的超集，或者确定比原字符集的字库更大，否则如果目标字符集的字库小于原字符集的字库，那么目标字符集中不支持的字符导入后会变成乱码，丢失一部分数据。</p>
<h1 id="字符集的选择"><a href="#字符集的选择" class="headerlink" title="字符集的选择"></a>字符集的选择</h1><p>由于数据库中存储的数据大部分都是各种文字，所以字符集对数据库的存储、处理性能，以及日后系统的移植、推广都会有影响。</p>
<p>如果在创建数据库时没有正确选择字符集，在后期就可能需要更换字符集，而更换字符集是代价比较高的操作，也存在一定的风险。所以推荐在应用开始阶段，就按照实际需求，正确的选择合适的字符集，避免后期不必要的调整。</p>
<p>目前 MySQL 5.7 支持几十种字符集，包括 UCS-2、UTF-16、UTF-16LE、UTF-32、 UTF-8 和 utf8mb4 等 Unicode 字符集。那么面对众多的字符集，我们该如何选择呢？</p>
<p>在选择数据库字符集时，可以根据应用的需求，结合字符集的特点来权衡，主要考虑以下几方面的因素。</p>
<ol>
<li>满足应用支持语言的需求。如果应用要处理各种各样的文字，或者将发布到使用不同语言的国家或地区，就应该选择 Unicode 字符集。对 MySQL 来说，目前就是 UTF-8。</li>
<li>如果应用中涉及已有数据的导入，就要充分考虑数据库字符集对已有数据的兼容性。假如已有数据的字符集是 GBK，如果选择 GB 2312-80 为数据库字符集，就很可能出现某些文字无法正确导入。</li>
<li>如果数据库只需要支持一般中文，数据量很大，性能要求也很高，那就应该选择双字节定长编码的中文字符集，比如 GBK。<br>因为，相对于 UTF-8 而言，GBK 比较“小”，每个汉字只占 2 个字节，而 UTF-8 汉字编码需要 3 个字节，这样可以减少磁盘 I&#x2F;O、数据库 Cache 以及网络传输的时间，从而提高性能。相反，如果应用主要处理英文字符，仅有少量汉字数据，那么选择 UTF-8 更好，因为 GBK、UCS-2、UTF-16 的西文字符编码都是 2 个字节，会造成很多不必要的开销。</li>
<li>如果数据库需要做大量的字符运算，如比较、排序等，那么选择定长字符集可能更好，因为定长字符集的处理速度要比变长字符集的处理速度快。</li>
<li>如果所有客户端程序都支持相同的字符集，则应该优先选择该字符集作为数据库字符集。这样可以避免因字符集转换带来的性能开销和数据损失。</li>
<li>在多种字符集都能够满足应用的前提下，应尽量使用小的字符集。因为更小的字符集意味着能够节省空间、减少网络传输字节数，同时由于存储空间的较小间接的提高了系统的性能。</li>
</ol>
<p>有很多字符集都可以保存汉字，比如 UTF-8、GB2312、GBK、Latin1 等等。但是常用的是 GB2312 和 GBK。因为 GB2312 字库比 GBK 字库小，有些偏僻字（例如：洺）不能保存，因此在选择字符集的时候一定要权衡这些偏僻字出现的几率，一般情况下，最好选用 GBK。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/MyBatis/MyBatis级联查询"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/15/java/MyBatis/MyBatis%E7%BA%A7%E8%81%94%E6%9F%A5%E8%AF%A2/"
    >MyBatis 级联查询</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/15/java/MyBatis/MyBatis%E7%BA%A7%E8%81%94%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time datetime="2021-04-15T03:36:09.000Z" itemprop="datePublished">2021-04-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>级联关系是一个数据库实体的概念，有 3 种级联关系，分别是一对一级联、一对多级联以及多对多级联。</p>
<p>级联的优点是获取关联数据十分便捷。但是级联过多会增加系统的复杂度，同时降低系统的性能，此增彼减。所以记录超过 3 层时，就不要考虑使用级联了，因为这样会造成多个对象的关联，导致系统的耦合、负载和难以维护。</p>
<h1 id="一对一关联查询"><a href="#一对一关联查询" class="headerlink" title="一对一关联查询"></a>一对一关联查询</h1><p>通过<code>&lt;resultMap&gt;</code>元素的子元素<code>&lt;association&gt;</code>处理这种一对一级联关系。</p>
<p>在<code>&lt;association&gt;</code>元素中通常使用以下属性：</p>
<ul>
<li><code>property</code>：指定映射到实体类的对象属性。</li>
<li><code>column</code>：指定表中对应的字段（即查询返回的列名）。</li>
<li><code>javaType</code>：指定映射到实体对象属性的类型。</li>
<li><code>select</code>：指定引入嵌套查询的子 SQL 语句，该属性用于关联映射中的嵌套查询。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;studentCard&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cardId&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">javaType</span>=<span class="string">&quot;net.biancheng.po.StudentCard&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">select</span>=<span class="string">&quot;net.biancheng.mapper.StudentCardMapper.selectStuCardById&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>一对一关联查询可采用以下两种方式：</p>
<ul>
<li>单步查询，通过关联查询实现</li>
<li>分步查询，通过两次或多次查询，为一对一关系的实体<code>Bean</code>赋值</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="1-创建数据表"><a href="#1-创建数据表" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>创建<code>student</code>（学生）和<code>studentcard</code>（学号）数据表，SQL 语句如下。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `sex` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `cardId` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `cardId` (`cardId`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `student_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`cardId`) <span class="keyword">REFERENCES</span> `studentcard` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">7</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `student`(`id`,`name`,`sex`,`cardId`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="number">0</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="string">&#x27;赵小红&#x27;</span>,<span class="number">1</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="string">&#x27;李晓明&#x27;</span>,<span class="number">0</span>,<span class="number">4</span>),(<span class="number">5</span>,<span class="string">&#x27;李紫薇&#x27;</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">6</span>,<span class="string">&#x27;钱百百&#x27;</span>,<span class="number">0</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `studentcard`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `studentcard` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `studentId` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `startDate` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `endDate` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `studentId` (`studentId`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">8</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `studentcard`(`id`,`studentId`,`startDate`,`endDate`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">20200311</span>,<span class="string">&#x27;2021-03-01&#x27;</span>,<span class="string">&#x27;2021-03-11&#x27;</span>),(<span class="number">2</span>,<span class="number">20200314</span>,<span class="string">&#x27;2021-03-01&#x27;</span>,<span class="string">&#x27;2021-03-11&#x27;</span>),(<span class="number">3</span>,<span class="number">20200709</span>,<span class="string">&#x27;2021-03-01&#x27;</span>,<span class="string">&#x27;2021-03-11&#x27;</span>),(<span class="number">4</span>,<span class="number">20200508</span>,<span class="string">&#x27;2021-03-01&#x27;</span>,<span class="string">&#x27;2021-03-11&#x27;</span>),(<span class="number">5</span>,<span class="number">20207820</span>,<span class="string">&#x27;2021-03-01&#x27;</span>,<span class="string">&#x27;2021-03-11&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-创建持久化类"><a href="#2-创建持久化类" class="headerlink" title="2.创建持久化类"></a>2.创建持久化类</h3><p>在<code>myBatisDemo</code>应用的<code>net.biancheng.po</code>包下创建数据表对应的持久化类<code>Student</code>和<code>StudentCard</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> sex;</span><br><span class="line">  <span class="keyword">private</span> StudentCard studentCard;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Student [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, sex=&quot;</span> + sex + <span class="string">&quot;, studentCard=&quot;</span> + studentCard + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentCard</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> studentId;</span><br><span class="line">  <span class="keyword">private</span> Date startDate;</span><br><span class="line">  <span class="keyword">private</span> Date endDate;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;StudentCard [id=&quot;</span> + id + <span class="string">&quot;, studentId=&quot;</span> + studentId + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分步查询"><a href="#分步查询" class="headerlink" title="分步查询"></a>分步查询</h2><p>新建<code>StudentCardMapper</code>类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.mapper;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.po.StudentCard;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentCardMapper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> StudentCard <span class="title function_">selectStuCardById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>StudentCardMapper.xml</code>对应映射 SQL 语句代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;net.biancheng.mapper.StudentCardMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStuCardById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.StudentCard&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM studentCard WHERE id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>StudentMapper</code>类方法代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.mapper;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.po.Student;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> Student <span class="title function_">selectStuById1</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">  <span class="keyword">public</span> Student <span class="title function_">selectStuById2</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>StudentMapper.xml</code>代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;net.biancheng.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对一根据id查询学生信息：级联查询的第一种方法（嵌套查询，执行两个SQL语句） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;net.biancheng.po.Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cardAndStu1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一对一级联查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;studentCard&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cardId&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">javaType</span>=<span class="string">&quot;net.biancheng.po.StudentCard&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">select</span>=<span class="string">&quot;net.biancheng.mapper.StudentCardMapper.selectStuCardById&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStuById1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;cardAndStu1&quot;</span>&gt;</span></span><br><span class="line">    select * from student where id=#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> ss.getMapper(StudentMapper.class).selectStuById1(<span class="number">2</span>);</span><br><span class="line">    System.out.println(stu);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单步查询"><a href="#单步查询" class="headerlink" title="单步查询"></a>单步查询</h2><p>在<code>StudentMapper.xml</code>中添加以下代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;net.biancheng.po.Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cardAndStu2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对一级联查询 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;studentCard&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;net.biancheng.po.StudentCard&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;studentId&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStuById2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;cardAndStu2&quot;</span>&gt;</span></span><br><span class="line">  SELECT s.*,sc.studentId FROM student s,studentCard sc</span><br><span class="line">  WHERE</span><br><span class="line">  s.cardId = sc.id AND s.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>StudentMapper</code>中添加以下方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Student <span class="title function_">selectStuById2</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>
<h1 id="一对多关联查询"><a href="#一对多关联查询" class="headerlink" title="一对多关联查询"></a>一对多关联查询</h1><p>但在实际生活中也有许多一对多级联关系，例如一个用户可以有多个订单，而一个订单只属于一个用户。同样，国家和城市也属于一对多级联关系。</p>
<p>通过<code>&lt;resultMap&gt;</code>元素的子元素<code>&lt;collection&gt;</code>处理一对多级联关系，<code>collection</code>可以将关联查询的多条记录映射到一个<code>list</code>集合属性中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderList&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ofType</span>=<span class="string">&quot;net.biancheng.po.Order&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">select</span>=<span class="string">&quot;net.biancheng.mapper.OrderMapper.selectOrderById&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>&lt;collection&gt;</code>元素中通常使用以下属性。</p>
<ul>
<li><code>property</code>：指定映射到实体类的对象属性。</li>
<li><code>column</code>：指定表中对应的字段（即查询返回的列名）。</li>
<li><code>javaType</code>：指定映射到实体对象属性的类型。</li>
<li><code>select</code>：指定引入嵌套查询的子 SQL 语句，该属性用于关联映射中的嵌套查询。</li>
</ul>
<p>一对多关联查询可采用以下两种方式：</p>
<ul>
<li>分步查询，通过两次或多次查询，为一对多关系的实体 Bean 赋值</li>
<li>单步查询，通过关联查询实现</li>
</ul>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><h3 id="1-创建数据表-1"><a href="#1-创建数据表-1" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>两张数据表，一张是用户表<code>user</code>，一张是订单表<code>order</code>，这两张表具有一对多的级联关系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">order</span>` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `ordernum` <span class="type">int</span>(<span class="number">25</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `userId` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `userId` (`userId`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `order_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`userId`) <span class="keyword">REFERENCES</span> `<span class="keyword">user</span>` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">9</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `<span class="keyword">order</span>`(`id`,`ordernum`,`userId`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">20200107</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">20200806</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">20206702</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">20200645</span>,<span class="number">1</span>),(<span class="number">5</span>,<span class="number">20200711</span>,<span class="number">2</span>),(<span class="number">6</span>,<span class="number">20200811</span>,<span class="number">2</span>),(<span class="number">7</span>,<span class="number">20201422</span>,<span class="number">3</span>),(<span class="number">8</span>,<span class="number">20201688</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `pwd` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">7</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `<span class="keyword">user</span>`(`id`,`name`,`pwd`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;编程帮&#x27;</span>,<span class="string">&#x27;123&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;C语言中文网&#x27;</span>,<span class="string">&#x27;456&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;赵小红&#x27;</span>,<span class="string">&#x27;123&#x27;</span>),(<span class="number">4</span>,<span class="string">&#x27;李晓明&#x27;</span>,<span class="string">&#x27;345&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;杨小胤&#x27;</span>,<span class="string">&#x27;123&#x27;</span>),(<span class="number">6</span>,<span class="string">&#x27;谷小乐&#x27;</span>,<span class="string">&#x27;789&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-创建持久化类-1"><a href="#2-创建持久化类-1" class="headerlink" title="2.创建持久化类"></a>2.创建持久化类</h3><p>创建持久化类<code>User</code>和<code>Order</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> String pwd;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Order&gt; orderList;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, orderList=&quot;</span> + orderList + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> ordernum;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Order [id=&quot;</span> + id + <span class="string">&quot;, ordernum=&quot;</span> + ordernum + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分步查询-1"><a href="#分步查询-1" class="headerlink" title="分步查询"></a>分步查询</h2><p><code>OrderMapper</code>类代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">selectOrderById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>
<p><code>OrderMapper.xml</code>中相应的映射 SQL 语句如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据id查询订单信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOrderById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Order&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM `order` where userId=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>UserMapper</code>类代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">selectUserOrderById1</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>
<p><code>UserMapper.xml</code>中相应的映射 SQL 语句如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一对多 根据id查询用户及其关联的订单信息：级联查询的第一种方法（分步查询） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;net.biancheng.po.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userAndOrder1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">column</span>=<span class="string">&quot;pwd&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对多级联查询，ofType表示集合中的元素类型，将id传递给selectOrderById --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderList&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ofType</span>=<span class="string">&quot;net.biancheng.po.Order&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">select</span>=<span class="string">&quot;net.biancheng.mapper.OrderMapper.selectOrderById&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserOrderById1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userAndOrder1&quot;</span>&gt;</span></span><br><span class="line">  select * from user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    <span class="type">User</span> <span class="variable">us</span> <span class="operator">=</span> ss.getMapper(UserMapper.class).selectUserOrderById1(<span class="number">1</span>);</span><br><span class="line">    System.out.println(us);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单步查询-1"><a href="#单步查询-1" class="headerlink" title="单步查询"></a>单步查询</h2><p>该种方式实现一对多关联查询需要修改<code>Order</code>持久化类，因为<code>Order</code>中的<code>id</code>不能和<code>User</code>中的<code>id</code>重复。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> oId;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> ordernum;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Order [id=&quot;</span> + oId+ <span class="string">&quot;, ordernum=&quot;</span> + ordernum + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UserMapper</code>类代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">selectUserOrderById2</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>
<p><code>UserMapper.xml</code>中相关映射 SQL 语句如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一对多 根据id查询用户及其关联的订单信息：级联查询的第二种方法（单步查询） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;net.biancheng.po.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userAndOrder2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">column</span>=<span class="string">&quot;pwd&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对多级联查询，ofType表示集合中的元素类型 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;net.biancheng.po.Order&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;oId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;oId&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;ordernum&quot;</span> <span class="attr">column</span>=<span class="string">&quot;ordernum&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserOrderById2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userAndOrder2&quot;</span>&gt;</span></span><br><span class="line">  SELECT u.*,o.id as oId,o.ordernum FROM `user` u,`order` o</span><br><span class="line">  WHERE</span><br><span class="line">  u.id=o.`userId` AND u.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码修改调用方法，如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    <span class="type">User</span> <span class="variable">us</span> <span class="operator">=</span> ss.getMapper(UserMapper.class).selectUserOrderById2(<span class="number">1</span>);</span><br><span class="line">    System.out.println(us);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="多对多关联查询"><a href="#多对多关联查询" class="headerlink" title="多对多关联查询"></a>多对多关联查询</h1><p>实际应用中，由于多对多的关系比较复杂，会增加理解和关联的复杂度，所以应用较少。MyBatis 没有实现多对多级联，推荐通过两个一对多级联替换多对多级联，以降低关系的复杂度，简化程序。</p>
<p>例如，一个订单可以有多种商品，一种商品可以对应多个订单，订单与商品就是多对多的级联关系。可以使用一个中间表（订单记录表）将多对多级联转换成两个一对多的关系。</p>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><p>下面以订单和商品（实现“查询所有订单以及每个订单对应的商品信息”的功能）为例讲解多对多关联查询。</p>
<h3 id="1-创建数据表-2"><a href="#1-创建数据表-2" class="headerlink" title="1. 创建数据表"></a>1. 创建数据表</h3><p>创建<code>order</code>（订单），<code>product</code>（商品）和<code>order_details</code>（订单和商品中间表），SQL 语句如下。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">order</span>` (</span><br><span class="line">  `oid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `ordernum` <span class="type">int</span>(<span class="number">25</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `userId` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`oid`),</span><br><span class="line">  KEY `userId` (`userId`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `order_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`userId`) <span class="keyword">REFERENCES</span> `<span class="keyword">user</span>` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">10</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `<span class="keyword">order</span>`(`oid`,`ordernum`,`userId`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">20200107</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">20200806</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">20206702</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">20200645</span>,<span class="number">1</span>),(<span class="number">5</span>,<span class="number">20200711</span>,<span class="number">2</span>),(<span class="number">6</span>,<span class="number">20200811</span>,<span class="number">2</span>),(<span class="number">7</span>,<span class="number">20201422</span>,<span class="number">3</span>),(<span class="number">8</span>,<span class="number">20201688</span>,<span class="number">4</span>),(<span class="number">9</span>,<span class="keyword">NULL</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `orders_detail`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `orders_detail` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `orderId` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `productId` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">7</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `orders_detail`(`id`,`orderId`,`productId`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>),(<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>),(<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `product`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `product` (</span><br><span class="line">  `pid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">25</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `price` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`pid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `product`(`pid`,`name`,`price`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;Java教程&#x27;</span>,<span class="number">128</span>),(<span class="number">2</span>,<span class="string">&#x27;C语言教程&#x27;</span>,<span class="number">138</span>),(<span class="number">3</span>,<span class="string">&#x27;Python教程&#x27;</span>,<span class="number">132.35</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-创建持久化类-2"><a href="#2-创建持久化类-2" class="headerlink" title="2. 创建持久化类"></a>2. 创建持久化类</h3><p><code>Order</code>类代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> oid;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> ordernum;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Product&gt; products;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Order [id=&quot;</span> + oid + <span class="string">&quot;, ordernum=&quot;</span> + ordernum + <span class="string">&quot;, products=&quot;</span> + products + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Product</code>类方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> pid;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Double price;</span><br><span class="line">  <span class="comment">// 多对多中的一个一对多</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Order&gt; orders;</span><br><span class="line">  <span class="comment">/*省略setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Product [id=&quot;</span> + pid + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, price=&quot;</span> + price + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-创建接口和映射文件"><a href="#3-创建接口和映射文件" class="headerlink" title="3. 创建接口和映射文件"></a>3. 创建接口和映射文件</h3><p><code>OrderMapper</code>接口代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.mapper;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.po.Order;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">selectAllOrdersAndProducts</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>OrderMapper.xml</code>代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;net.biancheng.mapper.OrderMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;net.biancheng.po.Order&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;oid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;oid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;ordernum&quot;</span> <span class="attr">column</span>=<span class="string">&quot;ordernum&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;products&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;net.biancheng.po.Product&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllOrdersAndProducts&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;orderMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT o.oid,o.`ordernum`,p.`pid`,p.`name`,p.`price` FROM</span><br><span class="line">    `order` o</span><br><span class="line">    INNER JOIN orders_detail od ON o.oid=od.`orderId`</span><br><span class="line">    INNER JOIN</span><br><span class="line">    product p</span><br><span class="line">    ON p.pid = od.`productId`</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-创建测试类"><a href="#4-创建测试类" class="headerlink" title="4. 创建测试类"></a>4. 创建测试类</h3><p>测试类代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.test;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.mapper.OrderMapper;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.po.Order;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    List&lt;Order&gt; orderList = ss.getMapper(OrderMapper.class).selectAllOrdersAndProducts();</span><br><span class="line">    <span class="keyword">for</span> (Order or : orderList) &#123;</span><br><span class="line">      System.out.println(or);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/MyBatis/MyBatis 动态SQL"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/12/java/MyBatis/MyBatis%20%E5%8A%A8%E6%80%81SQL/"
    >MyBatis 动态SQL</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/12/java/MyBatis/MyBatis%20%E5%8A%A8%E6%80%81SQL/" class="article-date">
  <time datetime="2021-04-12T08:24:15.000Z" itemprop="datePublished">2021-04-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>开发人员通常根据需求手动拼接 SQL 语句，这是一个极其麻烦的工作，而 MyBatis 提供了对 SQL 语句动态组装的功能，恰能解决这一问题。</p>
<p>MyBatis 的动态 SQL 元素与 JSTL 或 XML 文本处理器相似，常用<code>&lt;if&gt;、&lt;choose&gt;、&lt;when&gt;、&lt;otherwise&gt;、&lt;trim&gt;、&lt;where&gt;、&lt;set&gt;、&lt;foreach&gt;</code>和<code>&lt;bind&gt;</code>等元素。</p>
<h1 id="if"><a href="#if" class="headerlink" title="if"></a>if</h1><p>使用动态 SQL 最常见情景是根据条件包含<code>where</code>子句的一部分。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllWebsite&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;myResult&quot;</span>&gt;</span></span><br><span class="line">  select id,name,url from website</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">    where name like #&#123;name&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上代表表示根据网站名称去查找相应的网站信息，但是网站名称是一个可填可不填的条件，不填写的时候不作为查询条件。</p>
<p>可多个<code>if</code>语句同时使用。以下语句表示为可以按照网站名称（<code>name</code>）或者网址（<code>url</code>）进行模糊查询。如果您不输入名称或网址，则返回所有的网站记录。但是，如果你传递了任意一个参数，它就会返回与给定参数相匹配的记录。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllWebsite&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;myResult&quot;</span>&gt;</span></span><br><span class="line">  select id,name,url from website where 1=1</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">    AND name like #&#123;name&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;url!= null&quot;</span>&gt;</span></span><br><span class="line">    AND url like #&#123;url&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="choose、when、otherwise"><a href="#choose、when、otherwise" class="headerlink" title="choose、when、otherwise"></a>choose、when、otherwise</h1><p>动态语句<code>choose-when-otherwise</code>类似于 Java 中的<code>switch-case-default</code>语句。由于 MyBatis 并没有为<code>if</code>提供对应的<code>else</code>标签，如果想要达到<code>&lt;if&gt;...&lt;else&gt;...&lt;/else&gt; &lt;/if&gt;</code>的效果，可以借助<code>&lt;choose&gt;、&lt;when&gt;、&lt;otherwise&gt;</code>来实现。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;判断条件1&quot;</span>&gt;</span></span><br><span class="line">    SQL语句1</span><br><span class="line">  &lt;/when &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;判断条件2&quot;</span>&gt;</span></span><br><span class="line">    SQL语句2</span><br><span class="line">  &lt;/when &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;判断条件3&quot;</span>&gt;</span></span><br><span class="line">    SQL语句3</span><br><span class="line">  &lt;/when &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    SQL语句4</span><br><span class="line">  <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>choose</code>标签按顺序判断其内部<code>when</code>标签中的判断条件是否成立，如果有一个成立，则执行相应的 SQL 语句，<code>choose</code>执行结束；如果都不成立，则执行<code>otherwise</code>中的 SQL 语句。这类似于 Java 的<code>switch</code>语句，<code>choose</code>为<code>switch</code>，<code>when</code>为<code>case</code>，<code>otherwise</code>则为<code>default</code>。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>以下示例要求：</p>
<ul>
<li>当网站名称不为空时，只用网站名称作为条件进行模糊查询；</li>
<li>当网站名称为空，而网址不为空时，则用网址作为条件进行模糊查询；</li>
<li>当网站名称和网址都为空时，则要求网站年龄不为空。</li>
</ul>
<p><code>WebsiteMapper.xml</code>代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;net.biancheng.mapper.WebsiteMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">    SELECT id,name,url,age,country FROM website WHERE 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        AND name LIKE CONCAT(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;url != null and url !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        AND url LIKE CONCAT(&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        AND age is not null</span><br><span class="line">      <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>WebsiteMapper</code>类中方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Website&gt; <span class="title function_">selectWebsite</span><span class="params">(Website website)</span>;</span><br></pre></td></tr></table></figure>
<p>测试类代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 读取配置文件mybatis-config.xml</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>); <span class="comment">// 根据配置文件构建</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="comment">// 通过SqlSessionFactory创建SqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    <span class="type">Website</span> <span class="variable">site</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Website</span>();</span><br><span class="line">    site.setname(<span class="string">&quot;编程&quot;</span>);</span><br><span class="line">    List&lt;Website&gt; siteList = ss.selectList(<span class="string">&quot;net.biancheng.mapper.WebsiteMapper.selectWebsite&quot;</span>, site);</span><br><span class="line">    <span class="keyword">for</span> (Website ws : siteList) &#123;</span><br><span class="line">      System.out.println(ws);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: SELECT id,name,url,age,country FROM website WHERE 1=1 AND name LIKE CONCAT(&#x27;%&#x27;,?,&#x27;%&#x27;)</span><br><span class="line">DEBUG [main] - ==&gt; Parameters: 编程(String)</span><br><span class="line">DEBUG [main] - &lt;==      Total: 1</span><br><span class="line">Website[id=1,name=百度,url=https://www.baidu.com/,age=10,country=CN,createtime=null]</span><br></pre></td></tr></table></figure>
<h1 id="where"><a href="#where" class="headerlink" title="where"></a>where</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;net.biancheng.mapper.WebsiteMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">    SELECT id,name,url,age,country FROM website WHERE 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        AND name LIKE CONCAT(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;url != null and url !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        AND url LIKE CONCAT(&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        AND age is not null</span><br><span class="line">      <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的 SQL 语句中加入了一个条件<code>1=1</code>，如果没有加入这个条件，那么可能就会变成下面这样一条错误的语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,url,age,country <span class="keyword">FROM</span> website <span class="keyword">AND</span> name <span class="keyword">LIKE</span> CONCAT(<span class="string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>显然以上语句会出现 SQL 语法异常，但加入<code>1=1</code>这样的条件又非常奇怪，所以 MyBatis 提供了<code>where</code>标签。</p>
<p><code>where</code>标签主要用来简化 SQL 语句中的条件判断，可以自动处理<code>AND/OR</code>条件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;判断条件&quot;</span>&gt;</span></span><br><span class="line">    AND/OR ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>if</code>语句中判断条件为<code>true</code>时，<code>where</code>关键字才会加入到组装的 SQL 里面，否则就不加入。<code>where</code>会检索语句，它会将<code>where</code>后的第一个 SQL 条件语句的<code>AND</code>或者<code>OR</code>关键词去掉。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><p>根据网站名称或网址对网站进行模糊查询。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  select id,name,url from website</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">      AND name like #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;url!= null&quot;</span>&gt;</span></span><br><span class="line">      AND url like #&#123;url&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h1><p>在 MyBatis 中除了使用<code>if+where</code>实现多条件查询，还有一个更为灵活的元素<code>trim</code>能够替代之前的做法。</p>
<p><code>trim</code>一般用于去除 SQL 语句中多余的<code>AND</code>关键字、逗号，或者给 SQL 语句前拼接<code>where、set</code>等后缀，可用于选择性插入、更新、删除或者条件查询等操作。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;前缀&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;后缀&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;忽略前缀字符&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;忽略后缀字符&quot;</span>&gt;</span></span><br><span class="line">  SQL语句</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>trim</code>中属性说明如下。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">prefix</td>
<td align="center">给 SQL 语句拼接的前缀，为 trim 包含的内容加上前缀</td>
</tr>
<tr>
<td align="center">suffix</td>
<td align="center">给 SQL 语句拼接的后缀，为 trim 包含的内容加上后缀</td>
</tr>
<tr>
<td align="center">prefixOverrides</td>
<td align="center">去除 SQL 语句前面的关键字或字符，该关键字或者字符由 prefixOverrides 属性指定。</td>
</tr>
<tr>
<td align="center">suffixOverrides</td>
<td align="center">去除 SQL 语句后面的关键字或者字符，该关键字或者字符由 suffixOverrides 属性指定。</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  SELECT id,name,url,age,country FROM website</span><br><span class="line">  <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      AND name LIKE CONCAT (&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;url!= null&quot;</span>&gt;</span></span><br><span class="line">      AND url like concat (&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="set"><a href="#set" class="headerlink" title="set"></a>set</h1><p><code>update</code>语句可以使用<code>set</code>标签动态更新列。<code>set</code>标签可以为 SQL 语句动态的添加<code>set</code>关键字，剔除追加到条件末尾多余的逗号。</p>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><p>根据<code>id</code>修改网站名称或网址。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用set元素动态修改一个网站记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  UPDATE website</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span>name=#&#123;name&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;url!=null&quot;</span>&gt;</span>url=#&#123;url&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h1><p>对于一些 SQL 语句中含有<code>in</code>条件，需要迭代条件集合来生成的情况，可以使用<code>foreach</code>来实现 SQL 条件的迭代。 </p>
<p><code>foreach</code>标签用于循环语句，它很好的支持了数据和<code>List、set</code>接口的集合，并对此提供遍历的功能。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list|array|map key&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">  参数值</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>foreach</code>标签主要有以下属性：</p>
<ul>
<li><code>item</code>：表示集合中每一个元素进行迭代时的别名。</li>
<li><code>index</code>：指定一个名字，表示在迭代过程中每次迭代到的位置。</li>
<li><code>open</code>：表示该语句以什么开始（既然是<code>in</code>条件语句，所以必然以(开始）。</li>
<li><code>separator</code>：表示在每次进行迭代之间以什么符号作为分隔符（既然是<code>in</code>条件语句，所以必然以,作为分隔符）。</li>
<li><code>close</code>：表示该语句以什么结束（既然是<code>in</code>条件语句，所以必然以)开始）。</li>
</ul>
<p>使用<code>foreach</code>标签时，最关键、最容易出错的是<code>collection</code>属性，该属性是必选的，但在不同情况下该属性的值是不一样的，主要有以下 3 种情况：</p>
<ul>
<li>如果传入的是单参数且参数类型是一个<code>List</code>，<code>collection</code>属性值为<code>list</code>。</li>
<li>如果传入的是单参数且参数类型是一个<code>array</code>数组，<code>collection</code>的属性值为<code>array</code>。</li>
<li>如果传入的参数是多个，需要把它们封装成一个<code>Map</code>，当然单参数也可以封装成<code>Map</code>。<code>Map</code>的<code>key</code>是参数名，<code>collection</code>属性值是传入的<code>List</code>或<code>array</code>对象在自己封装的<code>Map</code>中的<code>key</code>。</li>
</ul>
<h2 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h2><p>现有<code>website</code>表包含以下记录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+----------------+----------------------------+-----+---------+---------------------+</span><br><span class="line">| id | name           | url                        | age | country | createtime          |</span><br><span class="line">+----+----------------+----------------------------+-----+---------+---------------------+</span><br><span class="line">|  1 | 百度           | https://www.baidu.com/     |  18 | CN      | 2021-03-08 11:23:53 |</span><br><span class="line">|  2 | 淘宝           | https://www.taobao.com/    |  17 | CN      | 2021-03-10 10:33:54 |</span><br><span class="line">|  3 | Google         | https://www.google.com/    |  23 | US      | 2021-03-10 10:34:34 |</span><br><span class="line">|  4 | GitHub         | https://github.com/        |  13 | US      | 2021-03-10 10:34:34 |</span><br><span class="line">|  5 | Stack Overflow | https://stackoverflow.com/ |  16 | US      | 2021-03-10 10:34:34 |</span><br><span class="line">|  6 | Yandex         | http://www.yandex.ru/      |  11 | RU      | 2021-03-10 10:34:34 |</span><br><span class="line">+----+----------------+----------------------------+-----+---------+---------------------+</span><br></pre></td></tr></table></figure>
<p><code>WebsiteMapper.xml</code>中代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  SELECT id,name,url,age,country FROM website WHERE age in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;age&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">    #&#123;age&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>WebsiteMapper</code>类中相应方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Website&gt; <span class="title function_">selectWebsite</span><span class="params">(List&lt;Integer&gt; ageList)</span>;</span><br></pre></td></tr></table></figure>
<p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 读取配置文件mybatis-config.xml</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>); <span class="comment">// 根据配置文件构建</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="comment">// 通过SqlSessionFactory创建SqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    List&lt;Integer&gt; ageList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    ageList.add(<span class="number">17</span>);</span><br><span class="line">    ageList.add(<span class="number">18</span>);</span><br><span class="line">    List&lt;Website&gt; siteList = ss.selectList(<span class="string">&quot;net.biancheng.mapper.WebsiteMapper.selectWebsite&quot;</span>, ageList);</span><br><span class="line">    <span class="keyword">for</span> (Website ws : siteList) &#123;</span><br><span class="line">      System.out.println(ws);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="script"><a href="#script" class="headerlink" title="script"></a>script</h1><p>要在带注解的映射器接口类中使用动态 SQL，可以使用<code>script</code>元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&#123;&quot;&lt;script&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;update Author&quot;,</span></span><br><span class="line"><span class="meta">  &quot;  &lt;set&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;    &lt;if test=&#x27;username != null&#x27;&gt;username=#&#123;username&#125;,&lt;/if&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;    &lt;if test=&#x27;password != null&#x27;&gt;password=#&#123;password&#125;,&lt;/if&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;    &lt;if test=&#x27;email != null&#x27;&gt;email=#&#123;email&#125;,&lt;/if&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;    &lt;if test=&#x27;bio != null&#x27;&gt;bio=#&#123;bio&#125;&lt;/if&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;  &lt;/set&gt;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;where id=#&#123;id&#125;&quot;,</span></span><br><span class="line"><span class="meta">  &quot;&lt;/script&gt;&quot;&#125;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateAuthorValues</span><span class="params">(Author author)</span>;</span><br></pre></td></tr></table></figure>
<h1 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h1><p>每个数据库的拼接函数或连接符号都不同，例如 MySQL 的<code>concat</code>函数、Oracle 的连接符号<code>||</code>等。这样 SQL 映射文件就需要根据不同的数据库提供不同的实现，显然比较麻烦，且不利于代码的移植。MyBatis 提供了<code>bind</code>标签来解决这一问题。</p>
<p><code>bind</code>标签可以通过 OGNL 表达式自定义一个上下文变量。</p>
<p>比如，按照网站名称进行模糊查询，SQL 映射文件如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+_parameter+&#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT id,name,url,age,country</span><br><span class="line">  FROM website</span><br><span class="line">  WHERE name like #&#123;pattern&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>bind</code>元素属性如下。</p>
<ul>
<li><code>value</code>：对应传入实体类的某个字段，可以进行字符串拼接等特殊处理。</li>
<li><code>name</code>：给对应参数取的别名。</li>
</ul>
<p>以上代码中的<code>_parameter</code>代表传递进来的参数，它和通配符连接后，赋给了<code>pattern</code>，然后就可以在<code>select</code>语句中使用这个变量进行模糊查询，不管是 MySQL 数据库还是 Oracle 数据库都可以使用这样的语句，提高了可移植性。</p>
<p>大部分情况下需要传递多个参数，下面为传递多个参数时<code>bind</code>的用法示例。</p>
<h2 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h2><p><code>WebsiteMapper</code>类中方法代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public List&lt;Website&gt; selectWebsite(Website site);</span><br></pre></td></tr></table></figure>
<p>SQL 映射文件代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+name+&#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+url+&#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT id,name,url,age,country</span><br><span class="line">  FROM website</span><br><span class="line">  WHERE name like #&#123;pattern_name&#125;</span><br><span class="line">  AND url like #&#123;pattern_url&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 读取配置文件mybatis-config.xml</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>); <span class="comment">// 根据配置文件构建</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="comment">// 通过SqlSessionFactory创建SqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    <span class="type">Website</span> <span class="variable">site</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Website</span>();</span><br><span class="line">    site.setname(<span class="string">&quot;编程&quot;</span>);</span><br><span class="line">    site.setUrl(<span class="string">&quot;http&quot;</span>);</span><br><span class="line">    List&lt;Website&gt; siteList = ss.selectList(<span class="string">&quot;net.biancheng.mapper.WebsiteMapper.selectWebsite&quot;</span>, site);</span><br><span class="line">    <span class="keyword">for</span> (Website ws : siteList) &#123;</span><br><span class="line">      System.out.println(ws);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: SELECT id,name,url,age,country FROM website WHERE name like ? AND url like ?</span><br><span class="line">DEBUG [main] - ==&gt; Parameters: %编程%(String), %http%(String)</span><br><span class="line">DEBUG [main] - &lt;==      Total: 1</span><br><span class="line">Website[id=1,name=百度,url=https://www.baidu.com/,age=10,country=CN]</span><br></pre></td></tr></table></figure>
<h1 id="多数据库支持"><a href="#多数据库支持" class="headerlink" title="多数据库支持"></a>多数据库支持</h1><p>如果配置了<code>databaseIdProvider</code>，你就可以在动态代码中使用名为<code>_databaseId</code>的变量来为不同的数据库构建特定的语句。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;oracle&#x27;&quot;</span>&gt;</span></span><br><span class="line">      select seq_users.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;db2&#x27;&quot;</span>&gt;</span></span><br><span class="line">      select nextval for seq_users from sysibm.sysdummy1&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">  insert into users values (#&#123;id&#125;, #&#123;name&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/MyBatis/MyBatis XML映射器"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/12/java/MyBatis/MyBatis%20XML%E6%98%A0%E5%B0%84%E5%99%A8/"
    >MyBatis 映射器</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/12/java/MyBatis/MyBatis%20XML%E6%98%A0%E5%B0%84%E5%99%A8/" class="article-date">
  <time datetime="2021-04-12T07:56:16.000Z" itemprop="datePublished">2021-04-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>映射器文件中包含一组 SQL 语句（例如查询、添加、删除、修改），这些语句称为映射语句或映射 SQL 语句。</p>
<p>映射器由 Java 接口和 XML 文件（或注解）共同组成，它的作用如下：</p>
<ul>
<li>定义参数类型</li>
<li>配置缓存</li>
<li>提供 SQL 语句和动态 SQL</li>
<li>定义查询结果和 POJO 的映射关系</li>
</ul>
<p>映射器有两种实现方式：</p>
<ul>
<li>通过 XML 文件方式实现，比如在<code>mybatis-config.xml</code>文件中描述的 XML 文件，用来生成<code>mapper</code>。</li>
<li>通过注解的方式实现，使用<code>Configuration</code>对象注册<code>Mapper</code>接口。</li>
</ul>
<p>如果 SQL 语句存在动态 SQL 或者比较复杂，使用注解写在 Java 文件里可读性差，且增加了维护的成本。所以一般建议使用 XML 文件配置的方式，避免重复编写 SQL 语句。</p>
<h1 id="XML实现映射器"><a href="#XML实现映射器" class="headerlink" title="XML实现映射器"></a>XML实现映射器</h1><p>XML 定义映射器分为两个部分：接口和 XML。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.mapper;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.po.Website;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WebsiteMapper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> List&lt;Website&gt; <span class="title function_">selectAllWebsite</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebsiteMapper.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;net.biancheng.mapper.WebsiteMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">    select * from website</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>namespace</code>用来定义命名空间，该命名空间和定义接口的全限定名一致。</li>
<li><code>&lt;select&gt;</code>元素表明这是一条查询语句，属性<code>id</code>用来标识这条 SQL。<code>resultType</code>表示返回的是一个<code>Website</code>类型的值。</li>
</ul>
<p>在 MyBatis 配置文件中添加以下代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;net/biancheng/mapper/WebsiteMapper.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>该语句用来引入 XML 文件，MyBatis 会读取<code>WebsiteMapper.xml</code>文件，生成映射器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">config</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(config);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">ss</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">    <span class="type">WebsiteMapper</span> <span class="variable">websiteMapper</span> <span class="operator">=</span> ss.getMapper(WebsiteMapper.class);</span><br><span class="line">    List&lt;Website&gt; websitelist = websiteMapper.selectAllWebsite();</span><br><span class="line">    <span class="keyword">for</span> (Website site : websitelist) &#123;</span><br><span class="line">      System.out.println(site);</span><br><span class="line">    &#125;</span><br><span class="line">    ss.commit();</span><br><span class="line">    ss.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="注解实现映射器"><a href="#注解实现映射器" class="headerlink" title="注解实现映射器"></a>注解实现映射器</h1><p>使用注解的方式实现映射器，只需要在接口中使用 Java 注解，注入 SQL 即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.mapper;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> net.biancheng.po.Website;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WebsiteMapper2</span> &#123;</span><br><span class="line">  <span class="meta">@Select(value = &quot;select * from website&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;Website&gt; <span class="title function_">selectAllWebsite</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果使用注解和 XML 文件两种方式同时定义，那么 XML 方式将覆盖掉注解方式。</p>
</blockquote>
<p>虽然这里注解的方式看起来比 XML 简单，但是现实中我们遇到的 SQL 会复杂得多。如果 SQL 语句中有多个表的关联、多个查询条件、级联、条件分支等，显然这条 SQL 就会复杂的多，所以并不建议使用这种方式。</p>
<p>此外，XML 可以相互引入，而注解是不可以的，所以在一些比较复杂的场景下，使用 XML 方式会更加灵活和方便。因此大部分的企业都以 XML 为主，当然在一些简单的表和应用中使用注解方式也会比较简单。</p>
<p>这个接口可以在 XML 中定义，将在<code>mybatis-config.xml</code>中配置 XML 的语句修改为以下语句即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/mapper/WebsiteMapper2&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以使用<code>configuration</code>对象注册这个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.addMapper(WebsiteMapper2.class);</span><br></pre></td></tr></table></figure>
<h1 id="映射器的主要元素"><a href="#映射器的主要元素" class="headerlink" title="映射器的主要元素"></a>映射器的主要元素</h1><table>
<thead>
<tr>
<th align="center">元素名称</th>
<th align="center">描述</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">mapper</td>
<td align="center">映射文件的根节点，只有 namescape 一个属性</td>
<td align="center">namescape 作用如下：<br>1.用于区分不同的 mapper，全局唯一<br>2.绑定DAO接口，即面向接口编程。当 namescape 绑定某一接口后，可以不用写该接口的实现类，MyBatis 会通过接口的完整限定名查找到对应的 mapper 配置来执行 SQL 语句。因此 namescape 的命名必须要跟接口同名。</td>
</tr>
<tr>
<td align="center">select</td>
<td align="center">查询语句</td>
<td align="center">可以自定义参数，返回结果集等</td>
</tr>
<tr>
<td align="center">insert</td>
<td align="center">插入语句</td>
<td align="center">执行后返回一个整数，代表插入的条数</td>
</tr>
<tr>
<td align="center">update</td>
<td align="center">更新语句</td>
<td align="center">执行后返回一个整数，代表更新的条数</td>
</tr>
<tr>
<td align="center">delete</td>
<td align="center">删除语句</td>
<td align="center">执行后返回一个整数，代表删除的条数</td>
</tr>
<tr>
<td align="center">parameterMap</td>
<td align="center">定义参数映射关系</td>
<td align="center">即将被删除的元素，不建议使用</td>
</tr>
<tr>
<td align="center">sql</td>
<td align="center">允许定义一部分的 SQL，然后在各个地方引用它</td>
<td align="center">例如，一张表列名，我们可以一次定义，在多个 SQL 语句中使用</td>
</tr>
<tr>
<td align="center">resultMap</td>
<td align="center">用来描述数据库结果集与对象的对应关系，它是最复杂、最强大的元素</td>
<td align="center">提供映射规则</td>
</tr>
<tr>
<td align="center">cache</td>
<td align="center">配置给定命名空间的缓存</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">cache-ref</td>
<td align="center">其它命名空间缓存配置的引用</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>SQL 映射文件中的<code>mapper</code>元素的<code>namescape</code>属性有如下要求。</p>
<ul>
<li><code>namescape</code>的命名必须跟某个 DAO 接口同名，同属于 DAO 层，因此代码结构上，映射文件与该接口应放置在同一<code>package</code>下（如<code>net.biancheng.dao.website</code>），并且习惯上是以<code>Mapper</code>结尾（如 <code>WebsiteMapper.java、WebsiteMapper.xml</code>）。</li>
<li>不同的<code>mapper</code>文件中子元素的<code>id</code>可以相同，MyBatis 通过<code>namescape</code>和子元素的<code>id</code>联合区分。接口中的方法与映射文件中的 SQL 语句<code>id</code>应一一对应。</li>
</ul>
<h2 id="select-标签"><a href="#select-标签" class="headerlink" title="select 标签"></a>select 标签</h2><p>在 SQL 映射文件中<code>&lt;select&gt;</code>标签用于映射 SQL 的<code>select</code>语句。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">  SELECT id,NAME,url FROM website WHERE NAME LIKE CONCAT (&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上是一个<code>id</code>为<code>selectAllWebsite</code>的映射语句，参数类型为<code>string</code>，返回结果类型为<code>Website</code>。</p>
<p>执行 SQL 语句时可以定义参数，参数可以是一个简单的参数类型，例如<code>int、float、String</code>；也可以是一个复杂的参数类型，例如<code>JavaBean、Map</code>等。MyBatis 提供了强大的映射规则，执行 SQL 后，MyBatis 会将结果集自动映射到<code>JavaBean</code>中。</p>
<blockquote>
<p>为了使数据库的查询结果和返回值类型中的属性能够自动匹配，通常会对 MySQL 数据库和JavaBean采用同一套命名规则，即 Java 命名驼峰规则，这样就不需要再做映射了（数据库表字段名和属性名不一致时需要手动映射）。</p>
</blockquote>
<p>参数的传递使用<code>#&#123;参数名&#125;</code>，相当于告诉 MyBatis 生成<code>PreparedStatement</code>参数。对于 JDBC，该参数会被标识为<code>?</code>。以上 SQL 语句可以使用 JDBC 实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id,NAME,url FROM website WHERE NAME LIKE CONCAT (&#x27;%&#x27;,?,&#x27;%&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">ps.setString(<span class="number">1</span>,userName);</span><br></pre></td></tr></table></figure>
<h3 id="select-标签常用属性"><a href="#select-标签常用属性" class="headerlink" title="select 标签常用属性"></a>select 标签常用属性</h3><table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td align="center">parameterType</td>
<td align="center">将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td align="center">resultType</td>
<td align="center">期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td align="center">resultMap</td>
<td align="center">对外部 resultMap 的命名引用。resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td align="center">flushCache</td>
<td align="center">将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：false。</td>
</tr>
<tr>
<td align="center">useCache</td>
<td align="center">将其设置为 true 后，将会导致本条语句的结果被二级缓存缓存起来，默认值：对 select 元素为 true。</td>
</tr>
<tr>
<td align="center">timeout</td>
<td align="center">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td align="center">fetchSize</td>
<td align="center">这是一个给驱动的建议值，尝试让驱动程序每次批量返回的结果行数等于这个设置值。 默认值为未设置（unset）（依赖驱动）。</td>
</tr>
<tr>
<td align="center">statementType</td>
<td align="center">可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td align="center">resultSetType</td>
<td align="center">FORWARD_ONLY，SCROLL_SENSITIVE, SCROLL_INSENSITIVE 或 DEFAULT（等价于 unset） 中的一个，默认值为 unset （依赖数据库驱动）。</td>
</tr>
<tr>
<td align="center">databaseId</td>
<td align="center">如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
<tr>
<td align="center">resultOrdered</td>
<td align="center">这个设置仅针对嵌套结果 select 语句：如果为 true，将会假设包含了嵌套结果集或是分组，当返回一个主结果行时，就不会产生对前面结果集的引用。 这就使得在获取嵌套结果集的时候不至于内存不够用。默认值：false。</td>
</tr>
<tr>
<td align="center">resultSets</td>
<td align="center">这个设置仅适用于多结果集的情况。它将列出语句执行后返回的结果集并赋予每个结果集一个名称，多个名称之间以逗号分隔。</td>
</tr>
</tbody></table>
<h3 id="传递多个参数"><a href="#传递多个参数" class="headerlink" title="传递多个参数"></a>传递多个参数</h3><p>现在需要根据<code>id</code>和<code>name</code>来模糊查询网站信息，显然这涉及到了两个参数。给映射器传递多个参数分为以下三种方法。</p>
<ul>
<li>使用<code>Map</code>传递参数</li>
<li>使用注解传递参数</li>
<li>使用<code>JavaBean</code>传递参数</li>
</ul>
<h4 id="使用-Map-传递参数"><a href="#使用-Map-传递参数" class="headerlink" title="使用 Map 传递参数"></a>使用 Map 传递参数</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据name和url模糊查询网站信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsiteByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  SELECT id,NAME,url FROM website</span><br><span class="line">  WHERE name LIKE CONCAT (&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">  AND url LIKE CONCAT (&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>WebsiteMapper</code>接口中，方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Website&gt; <span class="title function_">selectWebsiteByMap</span><span class="params">(Map&lt;String, String&gt; params)</span>;</span><br></pre></td></tr></table></figure>
<p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; paramsMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,String&gt;();</span><br><span class="line">paramsMap.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;编程&quot;</span>);</span><br><span class="line">paramsMap.put(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;biancheng&quot;</span>);</span><br><span class="line">websiteMapper.selectWebsiteByMap(paramsMap);</span><br></pre></td></tr></table></figure>
<p>使用<code>Map</code>传递参数虽然简单易用，但是由于这样设置参数需要键值对应，业务关联性不强，需要深入到程序中看代码，造成可读性下降。</p>
<h4 id="使用注解传递参数"><a href="#使用注解传递参数" class="headerlink" title="使用注解传递参数"></a>使用注解传递参数</h4><p>使用 MyBatis 的注解<code>@Param()</code>传递参数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据name和url模糊查询网站信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsiteByAn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  SELECT id,NAME,url FROM website</span><br><span class="line">  WHERE name LIKE CONCAT (&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">  AND url LIKE CONCAT (&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>WebsiteMapper</code>接口中方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Website&gt; <span class="title function_">selectWebsiteByAn</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;url&quot;)</span> String url)</span>;</span><br></pre></td></tr></table></figure>
<p>当我们把参数传递给后台时，MyBatis 通过<code>@Param</code>提供的名称就会知道<code>#&#123;name&#125;</code>代表<code>name</code>参数，提高了参数可读性。但是如果这条 SQL 拥有 10 个参数的查询，就会造成可读性下降，增强了代码复杂性。</p>
<h4 id="使用JavaBean传递参数"><a href="#使用JavaBean传递参数" class="headerlink" title="使用JavaBean传递参数"></a>使用JavaBean传递参数</h4><p>在参数过多的情况下，MyBatis 允许组织一个<code>JavaBean</code>，通过简单的<code>setter</code>和<code>getter</code>方法设置参数，提高可读性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据name和url模糊查询网站信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWebsiteByAn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  SELECT id,NAME,url FROM website</span><br><span class="line">  WHERE name LIKE CONCAT (&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">  AND url LIKE CONCAT (&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>WebsiteMapper</code>接口中方法如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public List&lt;Website&gt; selectWebsiteByAn(Website website);</span><br></pre></td></tr></table></figure>
<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p>以上 3 种方式的区别如下。</p>
<ul>
<li>使用<code>Map</code>传递参数会导致业务可读性的丧失，继而导致后续扩展和维护的困难，所以在实际应用中我们应该果断废弃该方式。</li>
<li>使用<code>@Param</code>注解传递参数会受到参数个数的影响。当<code>n≤5</code>时，它是最佳的传参方式，因为它更加直观；当<code>n&gt;5</code>时，多个参数将给调用带来困难。</li>
<li>当参数个数大于 5 个时，建议使用<code>JavaBean</code>方式。</li>
</ul>
<h2 id="insert-标签"><a href="#insert-标签" class="headerlink" title="insert 标签"></a>insert 标签</h2><p><code>insert</code>标签用来定义插入语句，执行插入操作。当 MyBatis 执行完一条插入语句后，就会返回其影响数据库的行数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebsiteMapper.xml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 增加网站信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">  insert into website(name) values(#&#123;name&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>WebsiteMapper</code>接口中定义一个<code>add()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addWebsite</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure>
<p>参数为<code>Sting</code>类型的字符串；返回值为<code>int</code>类型，即执行 SQL 后，插入记录的行数。</p>
<p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入 name 为编程帮4 的记录</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;baidu&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.addWebsite(name);</span><br><span class="line">System.out.println(<span class="string">&quot;共插入了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>执行测试代码，控制台输出如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">共插入了 1 条记录</span><br></pre></td></tr></table></figure>
<h3 id="insert-标签常用属性"><a href="#insert-标签常用属性" class="headerlink" title="insert 标签常用属性"></a>insert 标签常用属性</h3><table>
<thead>
<tr>
<th align="center">属性名称</th>
<th align="center">描述</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">它和 Mapper 的命名空间组合起来使用，是唯一标识符，供 MyBatis 调用</td>
<td align="center">如果命名空间+ id 不唯一，那么 MyBatis 抛出异常</td>
</tr>
<tr>
<td align="center">parameterType</td>
<td align="center">传入 SQL 语句的参数类型的全限定名或别名，它是一个可选属性。</td>
<td align="center">支持基本数据类型和 JavaBean、Map 等复杂数据类型</td>
</tr>
<tr>
<td align="center">keyProperty</td>
<td align="center">该属性的作用是将插入操作的返回值赋给 PO 类的某个属性，通常为主键对应的属性。如果是联合主键，可以将多个值用逗号隔开。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">useGeneratedKeys</td>
<td align="center">该属性用来设置，是否使用 JDBC 提供的 getGenereatedKeys() 方法，获取数据库内部产生的主键并赋值到 keyProperty 属性设置的请求对象的属性中，例如 MySQL、SQL Server 等自动递增的字段，其默认值为 false。</td>
<td align="center">该属性值设置为 true 后，会将数据库生成的主键回填到请求对象中，以供其他业务使用。</td>
</tr>
<tr>
<td align="center">flushCache</td>
<td align="center">该属性用于设置执行该操作后，是否会清空二级缓存和本地缓存，默认值为 true。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">timeout</td>
<td align="center">该属性用于设置执行该操作的最大时限，如果超时，就抛异常。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">databaseId</td>
<td align="center">取值范围 oracle、mysql 等，表示数据库厂家；元素内部可通过 <if test="_databaseId = 'oracle'"> 来为特定数据库指定不同的 sql 语句。	MyBatis 可以根据不同的数据库厂商执行不同的语句，这种多厂商的支持是基于映射语句中的 databaseId 属性。 MyBatis 会加载不带 databaseId 属性和带有匹配当前数据库 databaseId 属性的所有语句。 如果同时找到带有 databaseId 和不带 databaseId 的相同语句，则后者会被舍弃。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">keyColumn</td>
<td align="center">该属性用于设置第几列是主键，当主键列不是表中的第 1 列时，就需要设置该属性。如果是联合主键，可以将多个值用逗号隔开。</td>
<td align="center"></td>
</tr>
</tbody></table>
<blockquote>
<p><code>insert</code>标签中没有<code>resultType</code>属性，只有查询操作才需要对返回结果类型进行相应的指定。</p>
</blockquote>
<h3 id="传递多个参数-1"><a href="#传递多个参数-1" class="headerlink" title="传递多个参数"></a>传递多个参数</h3><p>Mybatis 为我们提供以下 3 种方式，来实现给映射器传递多个参数：</p>
<ul>
<li>使用<code>Map</code>传递参数</li>
<li>使用注解传递参数</li>
<li>使用<code>JavaBean</code>传递参数</li>
</ul>
<h4 id="使用-Map-传递参数-1"><a href="#使用-Map-传递参数-1" class="headerlink" title="使用 Map 传递参数"></a>使用 Map 传递参数</h4><p>我们可以将参数封装到一个<code>Map</code>对象中，然后传递给 MyBatis 的映射器。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>addWebsiteByMap()</code>方法，并使用<code>Map</code>传递参数。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int addWebsiteByMap(Map&lt;String, String&gt; params);</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中，使用<code>insert</code>标签定义一条插入语句，并接收通过<code>Map</code>传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--接收 Map 参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addWebsiteByMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  insert into Website (name, url) values (#&#123;name&#125;, #&#123;url&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;https://www.baidu.com/&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.addWebsiteByMap(params);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 Map 成功向数据库中添加了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 Map 成功向数据库中添加了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用注解传递参数-1"><a href="#使用注解传递参数-1" class="headerlink" title="使用注解传递参数"></a>使用注解传递参数</h4><p>我们还可以使用 MyBatis 提供的<code>@Param</code>注解给注解器传递参数。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>addWebsiteByParam()</code>方法，并使用<code>@Param</code>注解传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">addWebsiteByParam</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;url&quot;)</span> String url)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>insert</code>标签定义一条插入语句，并接收通过<code>@Param</code>注解传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--接收 @Param 注解传递的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addWebsiteByParam&quot;</span>&gt;</span></span><br><span class="line">  insert into Website (name, url)  values (#&#123;name&#125;, #&#123;url&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.addWebsiteByParam(<span class="string">&quot;baidu&quot;</span>, <span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 @Param 注解成功向数据库中添加了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 @Param 注解成功向数据库中添加了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用-JavaBean-传递参数"><a href="#使用-JavaBean-传递参数" class="headerlink" title="使用 JavaBean 传递参数"></a>使用 JavaBean 传递参数</h4><p>在参数过多的情况下，我们可以将参数通过<code>setter</code>方法封装到<code>JavaBean</code>（实体类）对象中 ，传递给映射器。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中,定义一个<code>addWebsiteByJavaBean()</code>方法，并使用<code>JavaBean</code>传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">addWebsiteByJavaBean</span><span class="params">(Website website)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>insert</code>标签定义一条插入语句，并接收通过<code>JavaBean</code>传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--接收通过 JavaBean 传递的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addWebsiteByJavaBean&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.www.po.Website&quot;</span>&gt;</span></span><br><span class="line">  insert into Website (name, url) values (#&#123;name&#125;, #&#123;url&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建 JavaBean 对象</span></span><br><span class="line"><span class="type">Website</span> <span class="variable">website</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Website</span>();</span><br><span class="line"><span class="comment">//通过 setter 方法将参数封装</span></span><br><span class="line">website.setName(<span class="string">&quot;编程帮 JavaBean&quot;</span>);</span><br><span class="line">website.setUrl(<span class="string">&quot;www.biancheng.net&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.addWebsiteByJavaBean(website);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 JavaBean 成功向数据库中添加了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 JavaBean 成功向数据库中添加了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="区别-1"><a href="#区别-1" class="headerlink" title="区别"></a>区别</h4><p>以上 3 种方式的区别如下：</p>
<ul>
<li>使用<code>Map</code>传递参数会导致业务可读性的丧失，继而导致后续扩展和维护的困难，所以在实际应用中我们应该果断废弃该方式。</li>
<li>使用<code>@Param</code>注解传递参数会受到参数个数的影响。当<code>n≤5</code>时，它是最佳的传参方式，因为它更加直观；当<code>n&gt;5</code>时，多个参数将给调用带来困难。</li>
<li>当参数个数大于 5 个时，建议使用<code>JavaBean</code>方式。</li>
</ul>
<h3 id="主键（自动递增）回填"><a href="#主键（自动递增）回填" class="headerlink" title="主键（自动递增）回填"></a>主键（自动递增）回填</h3><p>MySQL、SQL Server 等数据库表可以采用自动递增的字段作为其主键，当向这样的数据库表插入数据时，即使不指定自增主键的值，数据库也会根据自增规则自动生成主键并插入到表中。</p>
<p>一些特殊情况下，我们可能需要将这个刚刚生成的主键回填到请求对象（原本不包含主键信息的请求对象）中，供其他业务使用。此时，我们就可以通过在<code>insert</code>标签中添加<code>keyProperty</code>和<code>useGeneratedKeys</code>属性，来实现该功能。</p>
<ol>
<li>为<code>WebsiteMapper.xml</code>中<code>id</code>为<code>addWebsite</code>的<code>insert</code>标签添加<code>keyProperty</code>和<code>useGeneratedKeys</code>属性：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加一个网站信息，成功后将主键值返回填给id(po的属性)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  insert into Website (name,url) values(#&#123;name&#125;,#&#123;url&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加一个网站信息</span></span><br><span class="line"><span class="type">Website</span> <span class="variable">addsite</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Website</span>();</span><br><span class="line"><span class="comment">//插入的对象中不包含主键 id </span></span><br><span class="line">addsite.setName(<span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">addsite.setUrl(<span class="string">&quot;https://www.baidu.com/&quot;</span>);</span><br><span class="line"><span class="comment">//执行插入</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> websiteMapper.addWebsite(addsite);</span><br><span class="line">System.out.println(<span class="string">&quot;添加了 &quot;</span> + num + <span class="string">&quot; 条记录&quot;</span>);</span><br><span class="line"><span class="comment">//获取回填的主键</span></span><br><span class="line">System.out.println(<span class="string">&quot;添加记录的主键是:&quot;</span> + addsite.getId());</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">添加了 1 条记录</span><br><span class="line">添加记录的主键是:3</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="自定义主键"><a href="#自定义主键" class="headerlink" title="自定义主键"></a>自定义主键</h3><p>如果在实际工程中使用的数据库不支持主键自动递增，或者取消了主键自动递增的规则，可以使用 MyBatis 的<code>&lt;selectKey&gt;</code>元素来自定义生成主键。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加一个网站，#&#123;name&#125;为 net.biancheng.po.Website 的属性值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 先使用selectKey标签定义主键，然后再定义SQL语句 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">    select if(max(id) is null,1,max(id)+1) as newId from Website</span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">  insert into Website (id,name,url) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;url&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;selectKey&gt;</code>标签中属性说明如下：</p>
<ul>
<li><code>keyProperty</code>：用于指定主键值对应的<code>PO</code>类的属性。</li>
<li><code>order</code>：该属性取值可以为<code>BEFORE</code>或<code>AFTER</code>。<code>BEFORE</code>表示先执行<code>&lt;selectKey&gt;</code>标签内的语句，再执行插入语句；<code>AFTER</code>表示先执行插入语句再执行<code>&lt;selectKey&gt;</code>标签内的语句。</li>
</ul>
<h2 id="update标签"><a href="#update标签" class="headerlink" title="update标签"></a>update标签</h2><p><code>update</code>标签用于定义更新语句，执行更新操作。当 MyBatis 执行完一条更新语句后，会返回一个整数，表示受影响的数据库记录的行数。</p>
<ol>
<li><p>在<code>WebsiteMapper.xml</code>中添加以下更新语句。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--update 标签--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">    update website set name = #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在<code>WebsiteMapper</code>接口中增加一个<code>updateWebsite()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateWebsite</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure>
<p>参数为<code>String</code>类型的字符串；返回值为<code>int</code>类型，表示执行<code>sql</code>语句后受影响的记录的行数。</p>
</li>
<li><p>测试代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.updateWebsite(<span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;共更新了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>执行测试代码，控制台输出如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">共更新了 9 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="update-标签常用属性"><a href="#update-标签常用属性" class="headerlink" title="update 标签常用属性"></a>update 标签常用属性</h3><table>
<thead>
<tr>
<th align="center">属性名称</th>
<th align="center">描述</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">它和 Mapper 的命名空间组合起来使用，是唯一标识符，供 MyBatis 调用</td>
<td align="center">如果命名空间+ id 不唯一，那么 MyBatis 抛出异常</td>
</tr>
<tr>
<td align="center">parameterType</td>
<td align="center">传入 SQL 语句的参数类型的全限定名或别名，它是一个可选属性。</td>
<td align="center">支持基本数据类型和 JavaBean、Map 等复杂数据类型</td>
</tr>
<tr>
<td align="center">flushCache</td>
<td align="center">该属性用于设置执行该操作后，是否会清空二级缓存和本地缓存，默认值为 true。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">timeout</td>
<td align="center">该属性用于设置 SQL 执行的超时时间，如果超时，就抛异常。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">statementType</td>
<td align="center">执行 SQL 时使用的 statement 类型, 默认为 PREPARED，可选值：STATEMENT，PREPARED 和 CALLABLE。</td>
<td align="center"></td>
</tr>
</tbody></table>
<blockquote>
<p><code>update</code>标签中没有<code>resultType</code>属性，只有查询操作才需要对返回结果类型进行相应的指定。</p>
</blockquote>
<h3 id="传递多个参数-2"><a href="#传递多个参数-2" class="headerlink" title="传递多个参数"></a>传递多个参数</h3><p>Mybatis 为我们提供以下 3 种方式，来实现给映射器传递多个参数：</p>
<ul>
<li>使用<code>Map</code>传递参数</li>
<li>使用注解传递参数</li>
<li>使用<code>JavaBean</code>传递参数</li>
</ul>
<h4 id="使用-Map-传递参数-2"><a href="#使用-Map-传递参数-2" class="headerlink" title="使用 Map 传递参数"></a>使用 Map 传递参数</h4><p>我们可以将参数封装到一个<code>Map</code>对象中，然后传递给 MyBatis 的映射器。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>updateWebsiteByMap()</code>方法，并使用<code>Map</code>传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateWebsiteByMap</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>使用<code>update</code>标签定义一个<code>update</code>语句，并接收通过<code>Map</code>传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--更新语句接收 Map 传递的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWebsiteByMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  update website set name = #&#123;name&#125;,url= #&#123;url&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 Map 向 update 标签传递参数</span></span><br><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">params.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.updateWebsiteByMap(params);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 Map 传递参数，共更新了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 Map 传递参数，共更新了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用注解传递参数-2"><a href="#使用注解传递参数-2" class="headerlink" title="使用注解传递参数"></a>使用注解传递参数</h4><p>我们还可以使用 MyBatis 提供的<code>@Param</code>注解给注解器传递参数。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>updateWebsiteByParam()</code>方法，并使用<code>@Param</code>注解传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateWebsiteByParam</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;url&quot;)</span> String url, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>update</code>标签定义一个<code>update</code>语句，并接收通过<code>@Param</code>注解传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--更新语句接收 @Param 注解传递的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWebsiteByParam&quot;</span>&gt;</span></span><br><span class="line">  update website set name = #&#123;name&#125;,url= #&#123;url&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用@Param 注解传递参数到更新语句中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;编程帮2&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;www.biancheng.net&quot;</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.updateWebsiteByParam(name, url, id);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 @Param 注解传递参数，共更新了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 @Param 注解传递参数，共更新了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用-JavaBean-传递参数-1"><a href="#使用-JavaBean-传递参数-1" class="headerlink" title="使用 JavaBean 传递参数"></a>使用 JavaBean 传递参数</h4><p>在参数过多的情况下，我们还可以将参数通过<code>setter</code>方法封装到<code>JavaBean</code>（实体类）对象中传递给映射器。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>updateWebsiteByJavaBean()</code>方法，并使用<code>JavaBean</code>传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateWebsiteByJavaBean</span><span class="params">(Website website)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>update</code>标签定义一个<code>update</code>语句，并接收通过<code>JavaBean</code>传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--更新语句接收 JavaBean 传递的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWebsiteByJavaBean&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.www.po.Website&quot;</span>&gt;</span></span><br><span class="line">  update website set name = #&#123;name&#125;,url= #&#123;url&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 JavaBean 传递参数到更新语句中</span></span><br><span class="line"><span class="type">Website</span> <span class="variable">website</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Website</span>();</span><br><span class="line">website.setName(<span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">website.setUrl(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line">website.setId(<span class="number">3</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.updateWebsiteByJavaBean(website);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 JavaBean 传递参数，共更新了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 JavaBean 传递参数，共更新了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="区别-2"><a href="#区别-2" class="headerlink" title="区别"></a>区别</h4><p>以上 3 种方式的区别如下：</p>
<ul>
<li>使用<code>Map</code>传递参数会导致业务可读性的丧失，继而导致后续扩展和维护的困难，所以在实际应用中我们应该果断废弃该方式。</li>
<li>使用<code>@Param</code>注解传递参数会受到参数个数的影响。当<code>n≤5</code>时，它是最佳的传参方式，因为它更加直观；当<code>n&gt;5</code>时，多个参数将给调用带来困难。</li>
<li>当参数个数大于 5 个时，建议使用<code>JavaBean</code>方式。</li>
</ul>
<h2 id="delete标签"><a href="#delete标签" class="headerlink" title="delete标签"></a>delete标签</h2><p><code>delete</code>标签用于定义<code>delete</code>语句，执行删除操作。当 MyBatis 执行完一条更新语句后，会返回一个整数，表示受影响的数据库记录的行数。</p>
<ol>
<li>在<code>WebsiteMapper.xml</code>中使用<code>delete</code>标签添加一条<code>delete</code>语句。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteWebsite&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">  delete from website where name = #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper</code>接口中增加一个<code>deleteWebsite()</code>方法。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteWebsite</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure>
参数为<code>String</code>类型的字符串；返回值为<code>int</code>类型，表示执行<code>sql</code>语句后，被删除记录的行数。</li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除 name 为编程帮3 的记录</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;编程帮3&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.deleteWebsite(name);</span><br><span class="line">System.out.println(<span class="string">&quot;共删除了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">共删除了 3 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="delete-标签常用属性"><a href="#delete-标签常用属性" class="headerlink" title="delete 标签常用属性"></a>delete 标签常用属性</h3><table>
<thead>
<tr>
<th align="center">属性名称</th>
<th align="center">描述</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">它和 Mapper 的命名空间组合起来使用，是唯一标识符，供 MyBatis 调用</td>
<td align="center">如果命名空间+ id 不唯一，那么 MyBatis 抛出异常</td>
</tr>
<tr>
<td align="center">parameterType</td>
<td align="center">传入 SQL 语句的参数类型的全限定名或别名，它是一个可选属性。</td>
<td align="center">支持基本数据类型和 JavaBean、Map 等复杂数据类型</td>
</tr>
<tr>
<td align="center">flushCache</td>
<td align="center">该属性用于设置执行该操作后，是否会清空二级缓存和本地缓存，默认值为 true。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">timeout</td>
<td align="center">该属性用于设置 SQL 执行的超时时间，如果超时，就抛异常。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">statementType</td>
<td align="center">执行 SQL 时使用的 statement 类型, 默认为 PREPARED，可选值：STATEMENT，PREPARED 和 CALLABLE。</td>
<td align="center"></td>
</tr>
</tbody></table>
<blockquote>
<p><code>delete</code>标签中没有<code>resultType</code>属性，只有查询操作才需要对返回结果类型进行相应的指定。</p>
</blockquote>
<h3 id="传递多个参数-3"><a href="#传递多个参数-3" class="headerlink" title="传递多个参数"></a>传递多个参数</h3><p>Mybatis 为我们提供以下 3 种方式，来实现给映射器传递多个参数：</p>
<ul>
<li>使用<code>Map</code>传递参数</li>
<li>使用注解传递参数</li>
<li>使用<code>JavaBean</code>传递参数</li>
</ul>
<h4 id="使用-Map-传递参数-3"><a href="#使用-Map-传递参数-3" class="headerlink" title="使用 Map 传递参数"></a>使用 Map 传递参数</h4><p>我们可以将参数封装到一个<code>Map</code>对象中，然后传递给 MyBatis 的映射器。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>deleteWebsiteByMap()</code>方法，并使用<code>Map</code>传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteWebsiteByMap</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>delete</code>标签定义一个<code>delete</code>语句，并接收通过<code>Map</code>传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过 Map 传递参数，执行删除操作--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteWebsiteByMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  delete from website where name = #&#123;name&#125; and url = #&#123;url&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 Map 向 delete 标签传递参数</span></span><br><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.deleteWebsiteByMap(params);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 Map 传递参数，共删除了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 Map 传递参数，共删除了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用注解传递参数-3"><a href="#使用注解传递参数-3" class="headerlink" title="使用注解传递参数"></a>使用注解传递参数</h4><p>我们还可以使用 MyBatis 提供的<code>@Param</code>注解给注解器传递参数。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中，定义一个<code>deleteWebsiteByParam()</code>方法，并使用<code>@Param</code>注解传递参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteWebsiteByParam</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;url&quot;)</span> String url)</span>;</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>delete</code>标签定义一个<code>delete</code>语句，并接收通过<code>@Param</code>注解传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过 @Param 注解传递参数，执行删除操作--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteWebsiteByParam&quot;</span>&gt;</span></span><br><span class="line">    delete from website where name = #&#123;name&#125; and url = #&#123;url&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 @Param 注解传递参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;baidu&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;www.baidu.com&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.deleteWebsiteByParam(name, url);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 @Param 注解传递参数，共删除了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 @Param 注解传递参数，共删除了 1 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="使用-JavaBean-传递参数-2"><a href="#使用-JavaBean-传递参数-2" class="headerlink" title="使用 JavaBean 传递参数"></a>使用 JavaBean 传递参数</h4><p>在参数过多的情况下，我们还可以将参数通过<code>setter</code>方法封装到<code>JavaBean</code>（实体类）对象中传递给映射器。</p>
<ol>
<li>在<code>WebsiteMapper</code>接口中,定义一个<code>deleteWebsiteByJavaBean()</code>方法，并使用<code>JavaBean</code>传递参数。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int deleteWebsiteByJavaBean(Website website);</span><br></pre></td></tr></table></figure></li>
<li>在<code>WebsiteMapper.xml</code>中使用<code>delete</code>标签定义一个<code>delete</code>语句，并接收通过<code>JavaBean</code>传递的参数。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过 JavaBean 传递参数，执行删除操作--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteWebsiteByJavaBean&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;net.biancheng.www.po.Website&quot;</span>&gt;</span></span><br><span class="line">  delete from website where name = #&#123;name&#125; and url = #&#123;url&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码如下。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 JavaBean 传递参数到更新语句中</span></span><br><span class="line"><span class="type">Website</span> <span class="variable">website</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Website</span>();</span><br><span class="line">website.setName(<span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">website.setUrl(<span class="string">&quot;https://www.baidu.com/&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> websiteMapper.deleteWebsiteByJavaBean(website);</span><br><span class="line">System.out.println(<span class="string">&quot;通过 JavaBean 传递参数，共删除了 &quot;</span> + i + <span class="string">&quot; 条记录&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行测试代码，控制台输出如下。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 JavaBean 传递参数，共删除了 3 条记录</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="区别-3"><a href="#区别-3" class="headerlink" title="区别"></a>区别</h4><p>以上 3 种方式的区别如下：</p>
<ul>
<li>使用<code>Map</code>传递参数会导致业务可读性的丧失，继而导致后续扩展和维护的困难，所以在实际应用中我们应该果断废弃该方式。</li>
<li>使用<code>@Param</code>注解传递参数会受到参数个数的影响。当<code>n≤5</code>时，它是最佳的传参方式，因为它更加直观；当<code>n&gt;5</code>时，多个参数将给调用带来困难。</li>
<li>当参数个数大于 5 个时，建议使用<code>JavaBean</code>方式。</li>
</ul>
<h2 id="sql-标签"><a href="#sql-标签" class="headerlink" title="sql 标签"></a>sql 标签</h2><p><code>&lt;sql&gt;</code>标签的作用在于可以定义 SQL 语句的一部分（代码片段），以方便后面的 SQL 语句引用它，例如反复使用的列名。</p>
<p>在 MyBatis 中只需使用<code>&lt;sql&gt;</code>标签编写一次便能在其他元素中引用它。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;comColumns&quot;</span>&gt;</span>id,uname,usex<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.po.MyUser&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;comColumns&quot;</span>&gt;</span> from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="resultMap元素"><a href="#resultMap元素" class="headerlink" title="resultMap元素"></a>resultMap元素</h2><p><code>resultMap</code>主要用于解决实体类属性名与数据库表中字段名不一致的情况，可以将查询结果映射成实体对象。</p>
<p>现有的 MyBatis 版本只支持<code>resultMap</code>查询，不支持更新或者保存，更不必说级联的更新、删除和修改。</p>
<h3 id="resultMap元素的构成"><a href="#resultMap元素的构成" class="headerlink" title="resultMap元素的构成"></a>resultMap元素的构成</h3><p><code>resultMap</code>元素还可以包含以下子元素。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor</span>&gt;</span><span class="comment">&lt;!-- 类再实例化时用来注入结果到构造方法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">idArg</span>/&gt;</span><span class="comment">&lt;!-- ID参数，结果为ID --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span>/&gt;</span><span class="comment">&lt;!-- 注入到构造方法的一个普通结果 --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="comment">&lt;!-- 用于表示哪个列是主键 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span>/&gt;</span><span class="comment">&lt;!-- 注入到字段或JavaBean属性的普通结果 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 用于一对一关联 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 用于一对多、多对多关联 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="comment">&lt;!-- 使用结果值来决定使用哪个结果映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 基于某些值的结果映射 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><code>&lt;resultMap&gt;</code>元素的<code>type</code>属性表示需要的 POJO，<code>id</code>属性是<code>resultMap</code>的唯一标识。</li>
<li>子元素<code>&lt;constructor&gt;</code>用于配置构造方法。当一个 POJO 没有无参数构造方法时使用。</li>
<li>子元素<code>&lt;id&gt;</code>用于表示哪个列是主键。允许多个主键，多个主键称为联合主键。</li>
<li>子元素<code>&lt;result&gt;</code>用于表示 POJO 和 SQL 列名的映射关系。</li>
<li>子元素<code>&lt;association&gt;、&lt;collection&gt;</code>和<code>&lt;discriminator&gt;</code>用在级联的情况下。</li>
</ul>
<p><code>id</code>和<code>result</code>元素都有以下属性。</p>
<table>
<thead>
<tr>
<th align="center">元素</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">property</td>
<td align="center">映射到列结果的字段或属性。如果 POJO 的属性和 SQL 列名（column元素）是相同的，那么 MyBatis 就会映射到 POJO 上</td>
</tr>
<tr>
<td align="center">column</td>
<td align="center">对应 SQL 列</td>
</tr>
<tr>
<td align="center">javaType</td>
<td align="center">配置 Java 类型。可以是特定的类完全限定名或 MyBatis 上下文的别名</td>
</tr>
<tr>
<td align="center">jdbcType</td>
<td align="center">配置数据库类型。这是 JDBC 类型，MyBatis 已经为我们做了限定，基本支持所有常用数据库类型</td>
</tr>
<tr>
<td align="center">typeHandler</td>
<td align="center">类型处理器。允许你用特定的处理器来覆盖 MyBatis 默认的处理器。需要指定 jdbcType 和 javaType 相互转化的规则</td>
</tr>
</tbody></table>
<p>一条 SQL 查询语句执行后会返回结果集，结果集有两种存储方式，即使用<code>Map</code>存储和使用 POJO 存储。</p>
<h3 id="使用Map存储结果集"><a href="#使用Map存储结果集" class="headerlink" title="使用Map存储结果集"></a>使用Map存储结果集</h3><p>任何<code>select</code>语句都可以使用<code>Map</code>存储。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有网站信息存到Map中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllWebsite&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select * from website</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>WebsiteMapper</code>接口中添加以下方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">selectAllWebsite</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p><code>Map</code>的<code>key</code>是<code>select</code>语句查询的字段名（必须完全一样），而<code>Map</code>的<code>value</code>是查询返回结果中字段对应的值，一条记录映射到一个<code>Map</code>对象中。</p>
<p>使用<code>Map</code>存储结果集很方便，但可读性稍差，所以一般推荐使用 POJO 的方式。</p>
<h3 id="使用POJO存储结果集"><a href="#使用POJO存储结果集" class="headerlink" title="使用POJO存储结果集"></a>使用POJO存储结果集</h3><p>因为 MyBatis 提供了自动映射，所以使用 POJO 存储结果集是最常用的方式。但有时候需要更加复杂的映射或级联，这时就需要使用<code>select</code>元素的<code>resultMap</code>属性配置映射集合。</p>
<p>修改<code>Website</code>类，代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.biancheng.po;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Website</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String uname;</span><br><span class="line">  <span class="keyword">private</span> String url;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> String country;</span><br><span class="line">  <span class="keyword">private</span> Date createtime;</span><br><span class="line">  <span class="comment">/* setter和getter方法*/</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Website[id=&quot;</span> + id + <span class="string">&quot;,uname=&quot;</span> + uname + <span class="string">&quot;,url=&quot;</span> + url + <span class="string">&quot;,age=&quot;</span> + age + <span class="string">&quot;,country=&quot;</span> + country</span><br><span class="line">          + <span class="string">&quot;,createtime=&quot;</span> + createtime + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>WebsiteMapper.xml</code>代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用自定义结果集类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;net.biancheng.po.Website&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myResult&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- property 是 net.biancheng.po.Website 类中的属性 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- column是查询结果的列名，可以来自不同的表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;uname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>resultMap</code>元素的属性<code>id</code>代表这个<code>resultMap</code>的标识，<code>type</code>标识需要映射的 POJO。我们可以使用 MyBatis 定义好的类的别名或自定义类的全限定名。</p>
<p>这里使用<code>property</code>元素指定<code>Website</code>的属性名称<code>uname，column</code>表示数据库中<code>website</code>表的 SQL 列名<code>name</code>，将 POJO 和 SQL 的查询结果一 一对应。</p>
<p><code>WebsiteMapper.xml</code>中<code>select</code>元素配置代码如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllWebsite&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;myResult&quot;</span>&gt;</span></span><br><span class="line">  select id,name,url from website</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以发现 SQL 语句的列名和<code>myResult</code>中的<code>column</code>一一对应。</p>
<h3 id="resultType和resultMap的区别"><a href="#resultType和resultMap的区别" class="headerlink" title="resultType和resultMap的区别"></a>resultType和resultMap的区别</h3><p>MyBatis 的每一个查询映射的返回类型都是<code>resultMap</code>，只是当我们提供的返回类型是<code>resultType</code>时，MyBatis 会自动把对应的值赋给<code>resultType</code>所指定对象的属性，而当我们提供的返回类型是<code>resultMap</code>时，MyBatis 会将数据库中的列数据复制到对象的相应属性上，可用于复制查询。</p>
<p>需要注意的是，<code>resultMap</code>和<code>resultType</code>不能同时使用。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/MyBatis/MyBatis XML配置文件"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/10/java/MyBatis/MyBatis%20XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"
    >MyBatis XML配置文件</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/10/java/MyBatis/MyBatis%20XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="article-date">
  <time datetime="2021-04-10T04:11:21.000Z" itemprop="datePublished">2021-04-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>MyBatis 配置文件的所有元素：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span><span class="comment">&lt;!-- 配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span> /&gt;</span><span class="comment">&lt;!-- 属性 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">settings</span> /&gt;</span><span class="comment">&lt;!-- 设置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAliases</span> /&gt;</span><span class="comment">&lt;!-- 类型命名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeHandlers</span> /&gt;</span><span class="comment">&lt;!-- 类型处理器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">objectFactory</span> /&gt;</span><span class="comment">&lt;!-- 对象工厂 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span> /&gt;</span><span class="comment">&lt;!-- 插件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span>&gt;</span><span class="comment">&lt;!-- 配置环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span>&gt;</span><span class="comment">&lt;!-- 环境变量 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> /&gt;</span><span class="comment">&lt;!-- 事务管理器 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> /&gt;</span><span class="comment">&lt;!-- 数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">databaseIdProvider</span> /&gt;</span><span class="comment">&lt;!-- 数据库厂商标识 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span> /&gt;</span><span class="comment">&lt;!-- 映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>MyBatis 配置项的顺序不能颠倒。如果颠倒了它们的顺序，那么在 MyBatis 启动阶段就会发生异常，导致程序无法运行。</p>
</blockquote>
<h1 id="properties元素"><a href="#properties元素" class="headerlink" title="properties元素"></a>properties元素</h1><p><code>properties</code>属性可以给系统配置一些运行参数，可以放在 XML 文件或者 properties 文件中。一般而言，MyBatis 提供了 3 种方式让我们使用<code>properties</code>：<code>property</code>子元素、<code>properties</code>文件、程序代码传递。</p>
<h2 id="property-子元素"><a href="#property-子元素" class="headerlink" title="property 子元素"></a>property 子元素</h2><p>通过<code>properties</code>子元素<code>property</code>配置变量，然后在<code>environments</code>节点中引用这些变量。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1128&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;role&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.mybatis.po.Role&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--数据库环境--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span>    <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 映射文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mybatis/mapper/RoleMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里使用了元素<code>&lt;properties&gt;</code>下的子元素<code>&lt;property&gt;</code>定义，用字符串<code>username</code>定义数据库用户名，然后就可以在数据库定义中引入这个已经定义好的属性参数，如<code>$&#123;username&#125;</code>，这样定义一次就可以到处引用了。但是如果属性参数有成百上千个，显然使用这样的方式不是一个很好的选择，这个时候可以使用<code>properties</code>文件。</p>
<h2 id="使用-properties-文件"><a href="#使用-properties-文件" class="headerlink" title="使用 properties 文件"></a>使用 properties 文件</h2><p>创建一个文件<code>jdbc.properties</code>放到<code>classpath</code>的路径下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">database.<span class="property">driver</span>=com.<span class="property">mysql</span>.<span class="property">jdbc</span>.<span class="property">Driver</span></span><br><span class="line">database.<span class="property">url</span>=<span class="attr">jdbc</span>:<span class="attr">mysql</span>:<span class="comment">//localhost:3306/mybatis</span></span><br><span class="line">database.<span class="property">username</span>=root</span><br><span class="line">database.<span class="property">password</span>=<span class="number">1128</span></span><br></pre></td></tr></table></figure>
<p>通过<code>&lt;properties&gt;</code>的属性<code>resource</code>来引入<code>properties</code>文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以按<code>$&#123;username&#125;</code>的方法引入<code>properties</code>文件的属性参数到 MyBatis 配置文件中。这个时候通过维护<code>properties</code>文件就可以维护我们的配置内容了。</p>
<h2 id="使用程序传递方式传递参数"><a href="#使用程序传递方式传递参数" class="headerlink" title="使用程序传递方式传递参数"></a>使用程序传递方式传递参数</h2><p>在真实的生产环境中，数据库的用户密码是对开发人员和其他人员保密的。运维人员为了保密，一般都需要把用户和密码经过加密成为密文后，配置到<code>properties</code>文件中。</p>
<p>对于开发人员及其他人员而言，就不知道其真实的用户密码了，数据库也不可能使用已经加密的字符串去连接，此时往往需要通过解密才能得到真实的用户和密码了。</p>
<p>现在假设系统已经为提供了这样的一个<code>CodeUtils.decode(str)</code>进行解密，那么我们在创建<code>SqlSessionFactory</code>前，就需要把用户名和密码解密，然后把解密后的字符串重置到<code>properties</code>属性中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">InputStream inputStream;</span><br><span class="line"><span class="type">Inputstream</span> <span class="variable">in</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line"><span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.load(in);</span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;database.username&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;database.password&quot;</span>);</span><br><span class="line"><span class="comment">//解密用户和密码，并在属性中重置</span></span><br><span class="line">props.put(<span class="string">&quot;database.username&quot;</span>, CodeUtils.decode(username));</span><br><span class="line">props.put (<span class="string">&quot;database.password&quot;</span>, CodeUtils.decode(password)); </span><br><span class="line">inputstream = Resources.getResourceAsStream(resource);</span><br><span class="line"><span class="comment">//使用程序传递的方式覆盖原有的properties属性参数</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputstream, props);</span><br></pre></td></tr></table></figure>
<p>首先使用<code>Resources</code>对象读取了一个<code>jdbc.properties</code>配置文件，然后获取了它原来配置的用户和密码，进行解密并重置，最后使用<code>SqlSessionFactoryBuilder</code>的<code>build</code>方法，传递多个<code>properties</code>参数来完成。</p>
<p>这将覆盖之前配置的密文，这样就能连接数据库了，同时也满足了运维人员对数据库用户和密码安全的要求。</p>
<h1 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h1><p><code>settings</code>是最复杂的配置，它能深刻影响 MyBatis 底层的运行，但是在大部分情况下使用默认值便可以运行，所以在大部分情况下不需要大量配置它，只需要修改一些常用的规则即可，比如自动映射、驼峰命名映射、级联规则、是否启动缓存、执行器（<code>Executor</code>）类型等。</p>
<table>
<thead>
<tr>
<th align="center">配置项</th>
<th align="center">作用</th>
<th align="center">配置选项</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cacheEnabled</td>
<td align="center">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存</td>
<td align="center">true&#x2F;false</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">lazyLoadingEnabled</td>
<td align="center">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 fetchType 属性来覆盖该项的开关状态</td>
<td align="center">true&#x2F;false</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">multipleResultSetsEnabled</td>
<td align="center">是否允许单个语句返回多结果集（需要数据库驱动支持）</td>
<td align="center">true&#x2F;false</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">useColumnLabel</td>
<td align="center">使用列标签代替列名。不同的驱动会有不同的表现</td>
<td align="center">true&#x2F;false</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">useGeneratedKeys</td>
<td align="center">允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作</td>
<td align="center">true&#x2F;false</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">autoMappingBehavior</td>
<td align="center">指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td>
<td align="center">NONE<br>PARTIAL<br>FULL</td>
<td align="center">PARTIAL</td>
</tr>
<tr>
<td align="center">autoMappingUnknownColumnBehavior</td>
<td align="center">指定自动映射当中未知列（或未知属性类型）时的行为。 默认是不处理，只有当日志级别达到 WARN 级别或者以下，才会显示相关日志，如果处理失败会抛出 SqlSessionException 异常</td>
<td align="center">NONE<br>WARNING<br>FAILING</td>
<td align="center">NONE</td>
</tr>
<tr>
<td align="center">defaultExecutorType</td>
<td align="center">配置默认的执行器。SIMPLE 是普通的执行器；REUSE 会重用预处理语句（prepared statements）；BATCH 执行器将重用语句并执行批量更新</td>
<td align="center">SIMPLE<br>REUSE<br>BATCH</td>
<td align="center">SIMPLE</td>
</tr>
<tr>
<td align="center">defaultStatementTimeout</td>
<td align="center">设置超时时间，它决定驱动等待数据库响应的秒数</td>
<td align="center">任何正整数</td>
<td align="center">未设置 (null)</td>
</tr>
<tr>
<td align="center">defaultFetchSize</td>
<td align="center">为驱动的结果集获取数量（fetchSize）设置一个建议值。此参数只可以在查询设置中被覆盖。</td>
<td align="center">任意正整数</td>
<td align="center">未设置 (null)</td>
</tr>
<tr>
<td align="center">safeRowBoundsEnabled</td>
<td align="center">是否允许在嵌套语句中使用分页（RowBounds）。如果允许使用则设置为 false。</td>
<td align="center">true&#x2F;false</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">mapUnderscoreToCamelCase</td>
<td align="center">是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。</td>
<td align="center">true&#x2F;false</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">localCacheScope</td>
<td align="center">MyBatis 利用本地缓存机制（Local Cache）防止循环引用和加速重复的嵌套查询。 默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。</td>
<td align="center">SESSION<br>STATEMENT</td>
<td align="center">SESSION</td>
</tr>
<tr>
<td align="center">jdbcTypeForNull</td>
<td align="center">当没有为参数指定特定的 JDBC 类型时，空值的默认 JDBC 类型。 某些数据库驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。</td>
<td align="center">JdbcType 常量<br>常用值：NULL<br>VARCHAR<br>OTHER。</td>
<td align="center">OTHER</td>
</tr>
<tr>
<td align="center">lazyLoadTriggerMethods</td>
<td align="center">指定对象的哪些方法触发一次延迟加载。</td>
<td align="center">用逗号分隔的方法列表。</td>
<td align="center">equals<br>clone<br>hashCode<br>toString</td>
</tr>
<tr>
<td align="center">logPrefix</td>
<td align="center">指定 MyBatis 增加到日志名称的前缀</td>
<td align="center">任何字符串</td>
<td align="center">未设置</td>
</tr>
<tr>
<td align="center">loglmpl</td>
<td align="center">指定 MyBatis 所用日志的具体实现，未指定时将自动査找</td>
<td align="center">SLF4J&#x2F;LOG4J&#x2F;LOG4J2<br>JDK_LOGGING<br>COMMONS_LOGGING<br>ST DOUT_LOGGING<br>NO_LOGGING</td>
<td align="center">未设置</td>
</tr>
<tr>
<td align="center">proxyFactory</td>
<td align="center">指定 MyBatis 创建具有延迟加栽能力的对象所用到的代理工具</td>
<td align="center">CGLIB<br>JAVASSIST</td>
<td align="center">JAVASSIST</td>
</tr>
</tbody></table>
<p>全量的配置样例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useColumnLabel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useGeneratedKeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PARTIAL&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingUnknownColumnBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;WARNING&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SIMPLE&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultStatementTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultFetchSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;safeRowBoundsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;localCacheScope&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SESSION&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;OTHER&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> <span class="attr">value</span>=<span class="string">&quot;equals,clone,hashCode,toString&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h1><p>类型别名可为 Java 类型设置一个缩写名字。它仅用于 XML 配置，意在降低冗余的全限定类名书写。别名分为系统定义别名和自定义别名。</p>
<p>在 MyBatis 中别名由类<code>TypeAliasRegistry(org.apache.ibatis.type.TypeAliasRegistry)</code>去定义。注意，在 MyBatis 中别名不区分大小写。</p>
<h2 id="系统定义别名"><a href="#系统定义别名" class="headerlink" title="系统定义别名"></a>系统定义别名</h2><p>在 MyBatis 的初始化过程中，系统自动初始化了一些别名。</p>
<table>
<thead>
<tr>
<th align="center">别名</th>
<th align="center">Java 类型</th>
<th align="center">是否支持数组</th>
</tr>
</thead>
<tbody><tr>
<td align="center">_byte</td>
<td align="center">byte</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">string</td>
<td align="center">String</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">map</td>
<td align="center">Map</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">iterator</td>
<td align="center">Iterator</td>
<td align="center">否</td>
</tr>
</tbody></table>
<p>如果需要使用对应类型的数组型，要看其是否能支持数据，如果支持只需要使用别名加<code>[]</code>即可，比如<code>_int</code>数组的别名就是<code>_int[]</code>。而类似<code>list</code>这样不支持数组的别名，则不能那么写。</p>
<h2 id="自定义别名"><a href="#自定义别名" class="headerlink" title="自定义别名"></a>自定义别名</h2><p>MyBatis 也提供了用户自定义别名的规则。我们可以通过<code>TypeAliasRegistry</code>类的<code>registerAlias</code>方法注册，也可以采用配置文件或者扫描方式来自定义它。</p>
<p>使用配置文件定义：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span><span class="comment">&lt;!--别名--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;role&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.mybatis.po.Role&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;role&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.mybatis.po.User&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MyBatis 还支持扫描别名。比如上面的两个类都在包<code>com.mybatis.po</code>之下，那么就可以定义为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span><span class="comment">&lt;!--别名--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mybatis.po&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样 MyBatis 将扫描这个包里面的类，将其第一个字母变为小写作为其别名，比如类<code>Role</code>的别名会变为<code>role</code>，而<code>User</code>的别名会变为<code>user</code>。使用这样的规则，有时候会出现重名。</p>
<p>比如<code>com.mybatis.po.User</code>这个类，MyBatis 还增加了对包<code>com.mybatis.po</code>的扫描，那么就会出现异常，这个时候可以使用 MyBatis 提供的注解<code>@Alias(&quot;user3&quot;)</code>进行区分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis.po;</span><br><span class="line"><span class="meta">@Alias(&quot;user3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Class User &#123;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就能够避免因为别名重名导致的扫描失败的问题。</p>
<h1 id="typeHandlers标签"><a href="#typeHandlers标签" class="headerlink" title="typeHandlers标签"></a>typeHandlers标签</h1><p>MyBatis 在设置预处理语句（<code>PreparedStatement</code>）中的参数或从结果集中取出一个值时， 都会用类型处理器将获取到的值以合适的方式转换成 Java 类型。在<code>typeHandler</code>中，分为<code>jdbcType</code>和<code>javaType</code>，其中<code>jdbcType</code>用于定义数据库类型，而<code>javaType</code>用于定义 Java 类型，<code>typeHandler</code>的作用就是承担<code>jdbcType</code>和<code>javaType</code>之间的相互转换。</p>
<p>MyBatis 支持自定义处理类型，在自定义处理类型时，需要实现<code>org.apache.ibatis.type.TypeHandler</code>接口或继承<code>org.apache.ibatis.type.BaseTypeHandle</code>类。</p>
<h1 id="environments"><a href="#environments" class="headerlink" title="environments"></a>environments</h1><p>在<code>environments</code>标签中，可以配置 MyBatis 的多套运行环境，将 SQL 映射到多个不同的数据库上。</p>
<p><code>environment</code>是<code>environments</code> 的子标签，用来配置 MyBatis 的一套运行环境，需指定运行环境 ID、事务管理、数据源配置等相关信息。</p>
<p>我们可以通过配置多个<code>environment</code>标签来连接多个数据库，需要注意的是必须指定其中一个为默认运行环境（通过<code>default</code>指定）。</p>
<p><code>environment</code>标签提供了两个子标签，即<code>transactionManager</code>和<code>dataSource</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="transactionManager（事务管理器）"><a href="#transactionManager（事务管理器）" class="headerlink" title="transactionManager（事务管理器）"></a>transactionManager（事务管理器）</h2><p>在 MyBatis 中，<code>transactionManager</code>提供了两个实现类，它需要实现接口<code>Transaction（org.apache.ibatis.transaction.Transaction）</code>，它的定义代码如下所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">  Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">  Integer <span class="title function_">getTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从方法可知，它主要的工作就是提交（<code>commit</code>）、回滚（<code>rollback</code>）和关闭（<code>close</code>）数据库的事务。MyBatis 为<code>Transaction</code>提供了两个实现类<code>JdbcTransaction</code>和<code>ManagedTransaction</code>。</p>
<p>于是它对应着两种工厂：<code>JdbcTransactionFactory</code>和<code>ManagedTransactionFactory</code>，这个工厂需要实现<code>TransactionFactory</code>接口，通过它们会生成对应的<code>Transaction</code>对象。于是可以把事务管理器配置成为以下两种方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>JDBC 使用<code>JdbcTransactionFactory</code>生成的<code>JdbcTransaction</code>对象实现。它是以 JDBC 的方式对数据库的提交和回滚进行操作。</p>
<p><code>MANAGED</code>使用<code>ManagedTransactionFactory</code>生成的<code>ManagedTransaction</code>对象实现。它的提交和回滚方法不用任何操作，而是把事务交给容器处理。在默认情况下，它会关闭连接，然而一些容器并不希望这样，因此需要将<code>closeConnection</code>属性设置为<code>false</code>来阻止它默认的关闭行为。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;closeConnection&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="dataSource"><a href="#dataSource" class="headerlink" title="dataSource"></a>dataSource</h2><p>用于配置数据库的连接属性，例如要连接的数据库的驱动程序名称、URL、用户名和密码等。</p>
<p><code>dataSource</code>中的<code>type</code>属性用于指定数据源类型，有以下 3 种类型。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;UNPOOLED&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-UNPOOLED"><a href="#1-UNPOOLED" class="headerlink" title="1. UNPOOLED"></a>1. UNPOOLED</h3><p><code>UNPOOLED</code>采用非数据库池的管理方式，每次请求都会打开一个新的数据库连接，所以创建会比较慢。在一些对性能没有很高要求的场合可以使用它。</p>
<p>对有些数据库而言，使用连接池并不重要，那么它也是一个比较理想的选择。<code>UNPOOLED</code>类型的数据源可以配置以下几种属性：</p>
<ul>
<li><code>driver</code>数据库驱动名。</li>
<li><code>url</code>连接数据库的 URL。</li>
<li><code>username</code>用户名。</li>
<li><code>password</code>密码。</li>
<li><code>defaultTransactionIsolationLevel</code>默认的连接事务隔离级别。</li>
</ul>
<p>传递属性给数据库驱动也是一个可选项，注意属性的前缀为<code>driver.</code>，例如<code>driver.encoding=UTF8</code>。它会通过<code>DriverManager.getConnection(url,driverProperties)</code>方法传递值为<code>UTF8</code>的<code>encoding</code>属性给数据库驱动。</p>
<h3 id="2-POOLED"><a href="#2-POOLED" class="headerlink" title="2. POOLED"></a>2. POOLED</h3><p>数据源<code>POOLED</code>利用“池”的概念将 JDBC 的<code>Connection</code>对象组织起来，它开始会有一些空置，并且已经连接好的数据库连接，所以请求时，无须再建立和验证，省去了创建新的连接实例时所必需的初始化和认证时间。它还控制最大连接数，避免过多的连接导致系统瓶颈。</p>
<p>除了<code>UNPOOLED</code>下的属性外，还有更多属性用来配置<code>POOLED</code>的数据源：</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">poolMaximumActiveConnections</td>
<td align="center">是在任意时间都存在的活动（也就是正在使用）连接数量，默认值为 10</td>
</tr>
<tr>
<td align="center">poolMaximumIdleConnections</td>
<td align="center">是任意时间可能存在的空闲连接数</td>
</tr>
<tr>
<td align="center">poolMaximumCheckoutTime</td>
<td align="center">在被强制返回之前，池中连接被检出（checked out）的时间，默认值为 20 000 毫秒（即 20 秒）</td>
</tr>
<tr>
<td align="center">poolPingQuery</td>
<td align="center">为发送到数据库的侦测查询，用来检验连接是否处在正常工作秩序中，并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动失败时带有一个恰当的错误消息。</td>
</tr>
<tr>
<td align="center">poolPingEnabled</td>
<td align="center">为是否启用侦测查询。若开启，也必须使用一个可执行的 SQL 语句设置 poolPingQuery 属性（最好是一个非常快的 SQL），默认值为 false。</td>
</tr>
<tr>
<td align="center">poolPingConnectionsNotUsedFor</td>
<td align="center">为配置 poolPingQuery 的使用频度。这可以被设置成匹配具体的数据库连接超时时间，来避免不必要的侦测，默认值为 0（即所有连接每一时刻都被侦测——仅当 poolPingEnabled 为 true 时适用）。</td>
</tr>
</tbody></table>
<h3 id="3-JNDI"><a href="#3-JNDI" class="headerlink" title="3. JNDI"></a>3. JNDI</h3><p>数据源 JNDI 的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的引用。这种数据源配置只需要两个属性：</p>
<ol>
<li><code>initial_context</code><br>用来在<code>InitialContext</code>中寻找上下文（即，<code>initialContext.lookup（initial_context）</code>）。<code>initial_context</code>是个可选属性，如果忽略，那么<code>data_source</code>属性将会直接从<code>InitialContext</code>中寻找。</li>
<li><code>data_source</code><br>是引用数据源实例位置上下文的路径。当提供<code>initial_context</code>配置时，<code>data_source</code>会在其返回的上下文中进行查找；当没有提供<code>initial_context</code>时<code>data_source</code>直接在<code>InitialContext</code>中查找。</li>
</ol>
<p>与其他数据源配置类似，它可以通过添加前缀<code>env.</code>直接把属性传递给初始上下文（<code>InitialContext</code>）。比如<code>env.encoding=UTF8</code>，就会在初始上下文实例化时往它的构造方法传递值为<code>UTF8</code>的<code>encoding</code>属性。</p>
<p>MyBatis 也支持第三方数据源，例如使用 DBCP 数据源，那么需要提供一个自定义的<code>DataSourceFactory</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbcpDataSourceFactory</span> <span class="keyword">implements</span> <span class="title class_">DataSourceFactory</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties props)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props = props;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> DataSource <span class="title function_">getDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    dataSource = BasicDataSourceFactory.createDataSource(props);</span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后进行如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;com.mybatis.dataSource.DbcpDataSourceFactory&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;database.password&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样 MyBatis 就会采用配置的数据源工厂来生成数据源了。</p>
<h1 id="映射器（mappers）"><a href="#映射器（mappers）" class="headerlink" title="映射器（mappers）"></a>映射器（mappers）</h1><p><code>mappers</code>标签用于指定 MyBatis SQL 映射文件的路径。</p>
<p><code>mapper</code>是<code>mappers</code>的子标签，<code>mapper</code>中的<code>resource</code>属性用于指定 SQL 映射文件的路径（类资源路径）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这些配置会告诉 MyBatis 去哪里找映射文件，剩下的细节就应该是每个 SQL 映射文件了。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/MyBatis/MyBatis 核心对象"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/09/java/MyBatis/MyBatis%20%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/"
    >MyBatis 核心对象</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/09/java/MyBatis/MyBatis%20%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/" class="article-date">
  <time datetime="2021-04-09T08:24:15.000Z" itemprop="datePublished">2021-04-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>使用 MyBatis 的主要 Java 接口就是<code>SqlSession</code>。可以通过这个接口来执行命令，获取映射器实例和管理事务。</p>
<p><code>SqlSessions</code>是由<code>SqlSessionFactory</code>实例创建的。<code>SqlSessionFactory</code>对象包含创建<code>SqlSession</code>实例的各种方法。而<code>SqlSessionFactory</code>本身是由<code>SqlSessionFactoryBuilder</code>创建的，它可以从 XML、注解或 Java 配置代码来创建<code>SqlSessionFactory</code>。</p>
<img src="/2021/04/09/java/MyBatis/MyBatis%20%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/1.png" class="">

<p>当 Mybatis 与一些依赖注入框架（如 Spring ）搭配使用时，<code>SqlSession</code>将被依赖注入框架创建并注入，所以不需要使用<code>SqlSessionFactoryBuilder</code>或者<code>SqlSessionFactory</code>。</p>
<h1 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h1><p><code>SqlSessionFactoryBuilder</code>有五个<code>build()</code>方法，每一种都允许你从不同的资源中创建一个<code>SqlSessionFactory</code>实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, String environment)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, Properties properties)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, String env, Properties props)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(Configuration config)</span></span><br></pre></td></tr></table></figure>
<p>第一种方法是最常用的，它接受一个指向 XML 文件的<code>InputStream</code>实例。可选的参数是<code>environment</code>和<code>properties</code>。<code>environment</code>决定加载哪种环境，包括数据源和事务管理器。</p>
<p>如果你调用了带<code>environment</code>参数的<code>build</code>方法，那么 MyBatis 将使用该环境对应的配置。当然，如果你指定了一个无效的环境，会收到错误。如果你调用了不带<code>environment</code>参数的<code>build</code>方法，那么就会使用默认的环境配置。</p>
<p>如果你调用了接受<code>properties</code>实例的方法，那么 MyBatis 就会加载这些属性，并在配置中提供使用。绝大多数场合下，可以用<code>$&#123;propName&#125;</code>形式引用这些配置值。</p>
<p>在<code>mybatis-config.xml</code>中，可以引用属性值，也可以直接指定属性值。因此，理解属性的优先级是很重要的。</p>
<p>如果一个属性存在于下面的多个位置，那么 MyBatis 将按照以下顺序来加载它们：</p>
<ul>
<li>首先，读取在<code>properties</code>元素体中指定的属性；</li>
<li>其次，读取在<code>properties</code>元素的类路径<code>resource</code>或<code>url</code>指定的属性，且会覆盖已经指定了的重复属性；</li>
<li>最后，读取作为方法参数传递的属性，且会覆盖已经从<code>properties</code>元素体和<code>resource</code>或<code>url</code>属性中加载了的重复属性。</li>
</ul>
<p>因此，通过方法参数传递的属性的优先级最高，<code>resource</code>或<code>url</code>指定的属性优先级中等，在<code>properties</code>元素体中指定的属性优先级最低。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;org/mybatis/builder/mybatis-config.xml&quot;</span>;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsReader(resource);</span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> builder.build(inputStream);</span><br></pre></td></tr></table></figure>
<h1 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h1><p><code>SqlSessionFactory</code>有六个方法创建<code>SqlSession</code>实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">()</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(Connection connection)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(TransactionIsolationLevel level)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, TransactionIsolationLevel level)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, <span class="type">boolean</span> autoCommit)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, Connection connection)</span></span><br><span class="line">Configuration <span class="title function_">getConfiguration</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>默认的<code>openSession()</code>方法没有参数，它会创建具备如下特性的<code>SqlSession</code>：</p>
<ul>
<li>事务作用域将会开启（也就是不自动提交）。</li>
<li>将由当前环境配置的<code>DataSource</code>实例中获取<code>Connection</code>对象。</li>
<li>事务隔离级别将会使用驱动或数据源的默认设置。</li>
<li>预处理语句不会被复用，也不会批量处理更新。</li>
</ul>
<p>向<code>autoCommit</code>可选参数传递<code>true</code>值即可开启自动提交功能。若要使用自己的<code>Connection</code>实例，传递一个<code>Connection</code>实例给<code>connection</code>参数即可。注意，我们没有提供同时设置<code>Connection</code>和<code>autoCommit</code>的方法，这是因为 MyBatis 会依据传入的<code>Connection</code>来决定是否启用<code>autoCommit</code>。对于事务隔离级别，MyBatis 使用了一个 Java 枚举包装器来表示，称为<code>TransactionIsolationLevel</code>，事务隔离级别支持 JDBC 的五个隔离级别（<code>NONE、READ_UNCOMMITTED、READ_COMMITTED、REPEATABLE_READ</code>和<code>SERIALIZABLE</code>），并且与预期的行为一致。</p>
<p><code>ExecutorType</code>这个枚举类型定义了三个值:</p>
<ul>
<li><code>ExecutorType.SIMPLE</code>：该类型的执行器没有特别的行为。它为每个语句的执行创建一个新的预处理语句。</li>
<li><code>ExecutorType.REUSE</code>：该类型的执行器会复用预处理语句。</li>
<li><code>ExecutorType.BATCH</code>：该类型的执行器会批量执行所有更新语句，如果<code>SELECT</code>在多个更新中间执行，将在必要时将多条更新语句分隔开来，以方便理解。</li>
</ul>
<p>在<code>SqlSessionFactory</code>中还有一个方法就是<code>getConfiguration()</code>。这个方法会返回一个<code>Configuration</code>实例，你可以在运行时使用它来检查 MyBatis 的配置。</p>
<h1 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h1><p><code>SqlSession</code>类包含了所有执行语句、提交或回滚事务以及获取映射器实例的方法。<code>SqlSession</code>类的方法超过了 20 个，为了方便理解，我们将它们分成几种组别。</p>
<h2 id="语句执行方法"><a href="#语句执行方法" class="headerlink" title="语句执行方法"></a>语句执行方法</h2><p>这些方法被用来执行定义在 SQL 映射 XML 文件中的<code>SELECT、INSERT、UPDATE</code>和<code>DELETE</code>语句。每一方法都接受语句的 ID 以及参数对象，参数可以是原始类型（支持自动装箱或包装类）、<code>JavaBean</code>、<code>POJO</code>或<code>Map</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement, Object parameter)</span></span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter)</span></span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement, Object parameter)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement, Object parameter)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement, Object parameter)</span></span><br></pre></td></tr></table></figure>
<p><code>selectOne</code>和<code>selectList</code>的不同仅仅是<code>selectOne</code>必须返回一个对象或<code>null</code>值。如果返回值多于一个，就会抛出异常。如果你不知道返回对象会有多少，请使用<code>selectList</code>。如果需要查看某个对象是否存在，最好的办法是查询一个<code>count</code> 值（0 或 1）。<code>selectMap</code>稍微特殊一点，它会将返回对象的其中一个属性作为<code>key</code>值，将对象作为<code>value</code>值，从而将多个结果集转为<code>Map</code>类型值。由于并不是所有语句都需要参数，所以这些方法都具有一个不需要参数的重载形式。</p>
<p><code>insert、update</code>以及<code>delete</code>方法返回的值表示受该语句影响的行数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement)</span></span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement)</span></span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, String mapKey)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement)</span></span><br></pre></td></tr></table></figure>
<p>最后，还有<code>select</code>方法的三个高级版本，它们允许你限制返回行数的范围，或是提供自定义结果处理逻辑，通常在数据集非常庞大的情形下使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span> <span class="params">(String statement, Object parameter, RowBounds rowBounds)</span></span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey, RowBounds rowbounds)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span> <span class="params">(String statement, Object parameter, ResultHandler&lt;T&gt; handler)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span> <span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler&lt;T&gt; handler)</span></span><br></pre></td></tr></table></figure>
<p><code>RowBounds</code>参数会告诉 MyBatis 略过指定数量的记录，并限制返回结果的数量。<code>RowBounds</code>类的<code>offset</code>和<code>limit</code>值只有在构造函数时才能传入，其它时候是不能修改的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"><span class="type">RowBounds</span> <span class="variable">rowBounds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RowBounds</span>(offset, limit);</span><br></pre></td></tr></table></figure>
<p>数据库驱动决定了略过记录时的查询效率。为了获得最佳的性能，建议将<code>ResultSet</code>类型设置为<code>SCROLL_SENSITIVE</code>或<code>SCROLL_INSENSITIVE</code>（换句话说：不要使用<code>FORWARD_ONLY</code>）。</p>
<p><code>ResultHandler</code>参数允许自定义每行结果的处理过程。你可以将它添加到<code>List</code>中、创建<code>Map</code>和<code>Set</code>，甚至丢弃每个返回值，只保留计算后的统计结果。你可以使用<code>ResultHandler</code>做很多事，这其实就是 MyBatis 构建 结果列表的内部实现办法。</p>
<p><code>ResultHandler</code>会在存储过程的<code>REFCURSOR</code>输出参数中传递使用的<code>CALLABLE</code>语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.ibatis.session;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResultHandler</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">handleResult</span><span class="params">(ResultContext&lt;? extends T&gt; context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ResultContext</code>参数允许你访问结果对象和当前已被创建的对象数目，另外还提供了一个返回值为<code>Boolean</code>的<code>stop</code>方法，你可以使用此<code>stop</code>方法来停止 MyBatis 加载更多的结果。</p>
<p>使用<code>ResultHandler</code>的时候需要注意以下两个限制：</p>
<ul>
<li>使用带<code>ResultHandler</code>参数的方法时，收到的数据不会被缓存。</li>
<li>当使用高级的结果映射集（<code>resultMap</code>）时，MyBatis 很可能需要数行结果来构造一个对象。如果你使用了<code>ResultHandler</code>，你可能会接收到关联（<code>association</code>）或者集合（<code>collection</code>）中尚未被完整填充的对象。</li>
</ul>
<h2 id="立即批量更新方法"><a href="#立即批量更新方法" class="headerlink" title="立即批量更新方法"></a>立即批量更新方法</h2><p>当你将<code>ExecutorType</code>设置为<code>ExecutorType.BATCH</code>时，可以使用这个方法清除（执行）缓存在 JDBC 驱动类中的批量更新语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;BatchResult&gt; <span class="title function_">flushStatements</span><span class="params">()</span></span><br></pre></td></tr></table></figure>
<h2 id="事务控制方法"><a href="#事务控制方法" class="headerlink" title="事务控制方法"></a>事务控制方法</h2><p>有四个方法用来控制事务作用域。当然，如果你已经设置了自动提交或你使用了外部事务管理器，这些方法就没什么作用了。然而，如果你正在使用由<code>Connection</code>实例控制的 JDBC 事务管理器，那么这四个方法就会派上用场：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(<span class="type">boolean</span> force)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(<span class="type">boolean</span> force)</span></span><br></pre></td></tr></table></figure>
<p>默认情况下 MyBatis 不会自动提交事务，除非它侦测到调用了插入、更新或删除方法改变了数据库。如果你没有使用这些方法提交修改，那么你可以在<code>commit</code>和<code>rollback</code>方法参数中传入<code>true</code>值，来保证事务被正常提交（注意，在自动提交模式或者使用了外部事务管理器的情况下，设置<code>force</code>值对<code>session</code>无效）。大部分情况下你无需调用<code>rollback()</code>，因为 MyBatis 会在你没有调用<code>commit</code>时替你完成回滚操作。不过，当你要在一个可能多次提交或回滚的<code>session</code>中详细控制事务，回滚操作就派上用场了。</p>
<h2 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h2><p>Mybatis 使用到了两种缓存：本地缓存（<code>local cache</code>）和二级缓存（<code>second level cache</code>）。</p>
<p>每当一个新<code>session</code>被创建，MyBatis 就会创建一个与之相关联的本地缓存。任何在<code>session</code>执行过的查询结果都会被保存在本地缓存中，所以，当再次执行参数相同的相同查询时，就不需要实际查询数据库了。本地缓存将会在做出修改、事务提交或回滚，以及关闭<code>session</code>时清空。</p>
<p>默认情况下，本地缓存数据的生命周期等同于整个<code>session</code>的周期。由于缓存会被用来解决循环引用问题和加快重复嵌套查询的速度，所以无法将其完全禁用。但是你可以通过设置<code>localCacheScope=STATEMENT</code>来只在语句执行时使用缓存。</p>
<p>注意，如果<code>localCacheScope</code>被设置为<code>SESSION</code>，对于某个对象，MyBatis 将返回在本地缓存中唯一对象的引用。对返回的对象（例如<code>list</code>）做出的任何修改将会影响本地缓存的内容，进而将会影响到在本次<code>session</code>中从缓存返回的值。因此，不要对 MyBatis 所返回的对象作出更改，以防后患。</p>
<p>你可以随时调用以下方法来清空本地缓存：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">clearCache</span><span class="params">()</span></span><br></pre></td></tr></table></figure>
<h2 id="确保-SqlSession-被关闭"><a href="#确保-SqlSession-被关闭" class="headerlink" title="确保 SqlSession 被关闭"></a>确保 SqlSession 被关闭</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span></span><br></pre></td></tr></table></figure>
<p>对于你打开的任何<code>session</code>，你都要保证它们被妥善关闭，这很重要。</p>
<p>和<code>SqlSessionFactory</code>一样，你可以调用当前使用的<code>SqlSession</code>的<code>getConfiguration</code>方法来获得<code>Configuration</code>实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configuration <span class="title function_">getConfiguration</span><span class="params">()</span></span><br></pre></td></tr></table></figure>
<h2 id="使用映射器"><a href="#使用映射器" class="headerlink" title="使用映射器"></a>使用映射器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">getMapper</span><span class="params">(Class&lt;T&gt; type)</span></span><br></pre></td></tr></table></figure>
<p>上述的各个<code>insert、update、delete</code>和<code>select</code>方法都很强大，但也有些繁琐，它们并不符合类型安全，对你的 IDE 和单元测试也不是那么友好。因此，使用映射器类来执行映射语句是更常见的做法。</p>
<p>一个映射器类就是一个仅需声明与<code>SqlSession</code>方法相匹配方法的接口。下面的示例展示了一些方法签名以及它们是如何映射到<code>SqlSession</code>上的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorMapper</span> &#123;</span><br><span class="line">  <span class="comment">// (Author) selectOne(&quot;selectAuthor&quot;,5);</span></span><br><span class="line">  Author <span class="title function_">selectAuthor</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">  <span class="comment">// (List&lt;Author&gt;) selectList(“selectAuthors”)</span></span><br><span class="line">  List&lt;Author&gt; <span class="title function_">selectAuthors</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">// (Map&lt;Integer,Author&gt;) selectMap(&quot;selectAuthors&quot;, &quot;id&quot;)</span></span><br><span class="line">  <span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line">  Map&lt;Integer, Author&gt; <span class="title function_">selectAuthors</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">// insert(&quot;insertAuthor&quot;, author)</span></span><br><span class="line">  <span class="type">int</span> <span class="title function_">insertAuthor</span><span class="params">(Author author)</span>;</span><br><span class="line">  <span class="comment">// updateAuthor(&quot;updateAuthor&quot;, author)</span></span><br><span class="line">  <span class="type">int</span> <span class="title function_">updateAuthor</span><span class="params">(Author author)</span>;</span><br><span class="line">  <span class="comment">// delete(&quot;deleteAuthor&quot;,5)</span></span><br><span class="line">  <span class="type">int</span> <span class="title function_">deleteAuthor</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总之，每个映射器方法签名应该匹配相关联的<code>SqlSession</code>方法，字符串参数<code>ID</code>无需匹配。而是由方法名匹配映射语句的<code>ID</code>。</p>
<p>此外，返回类型必须匹配期望的结果类型，返回单个值时，返回类型应该是返回值的类，返回多个值时，则为数组或集合类，另外也可以是游标（<code>Cursor</code>）。所有常用的类型都是支持的，包括：原始类型、<code>Map、POJO</code>和<code>JavaBean</code>。</p>
<p>映射器接口不需要去实现任何接口或继承自任何类。只要方法签名可以被用来唯一识别对应的映射语句就可以了。</p>
<p>映射器接口可以继承自其他接口。在使用 XML 来绑定映射器接口时，保证语句处于合适的命名空间中即可。唯一的限制是，不能在两个具有继承关系的接口中拥有相同的方法签名（这是潜在的危险做法，不可取）。</p>
<p>你可以传递多个参数给一个映射器方法。在多个参数的情况下，默认它们将会以<code>param</code>加上它们在参数列表中的位置来命名，比如：<code>#&#123;param1&#125;、#&#123;param2&#125;</code>等。如果你想（在有多个参数时）自定义参数的名称，那么你可以在参数上使用<code>@Param(&quot;paramName&quot;)</code>注解。</p>
<p>你也可以给方法传递一个<code>RowBounds</code>实例来限制查询结果。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-java/MyBatis/MyBatis 注解"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/08/java/MyBatis/MyBatis%20%E6%B3%A8%E8%A7%A3/"
    >MyBatis 注解</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/08/java/MyBatis/MyBatis%20%E6%B3%A8%E8%A7%A3/" class="article-date">
  <time datetime="2021-04-08T08:24:15.000Z" itemprop="datePublished">2021-04-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/MyBatis/">MyBatis</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>MyBatis 注解主要分为三大类，即 SQL 语句映射、结果集映射和关系映射。</p>
<h1 id="SQL-语句映射"><a href="#SQL-语句映射" class="headerlink" title="SQL 语句映射"></a>SQL 语句映射</h1><h2 id="Insert：实现新增功能"><a href="#Insert：实现新增功能" class="headerlink" title="@Insert：实现新增功能"></a>@Insert：实现新增功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into user(id,name) values(#&#123;id&#125;,#&#123;name&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Select：实现查询功能"><a href="#Select：实现查询功能" class="headerlink" title="@Select：实现查询功能"></a>@Select：实现查询功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;Select * from user&quot;)</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">  @Result(id = true, column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">  @Result(column = &quot;name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">  @Result(column = &quot;sex&quot;, property = &quot;sex&quot;),</span></span><br><span class="line"><span class="meta">  @Result(column = &quot;age&quot;, property = &quot;age&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">queryAllUser</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<h2 id="SelectKey：插入后，获取id的值"><a href="#SelectKey：插入后，获取id的值" class="headerlink" title="@SelectKey：插入后，获取id的值"></a>@SelectKey：插入后，获取id的值</h2><p>以 MySQL 为例，MySQL 在插入一条数据后，使用<code>select last_insert_id()</code>可以获取到自增<code>id</code>的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into user(id,name) values(#&#123;id&#125;,#&#123;name&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@SelectKey(statement = &quot;select last_insert_id()&quot;, keyProperty = &quot;id&quot;, keyColumn = &quot;id&quot;, resultType = int,before = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>
<p><code>@SelectKey</code>各个属性含义如下。</p>
<ul>
<li><code>statement</code>：表示要运行的 SQL 语句；</li>
<li><code>keyProperty</code>：可选项，表示将查询结果赋值给代码中的哪个对象；</li>
<li><code>keyColumn</code>：可选项，表示将查询结果赋值给数据表中的哪一列；</li>
<li><code>resultType</code>：指定 SQL 语句的返回值；</li>
<li><code>before</code>：默认值为<code>true</code>，在执行插入语句之前，执行<code>select last_insert_id()</code>。值为<code>false</code>，则在执行插入语句之后，执行<code>select last_insert_id()</code>。</li>
</ul>
<h2 id="Insert：实现插入功能"><a href="#Insert：实现插入功能" class="headerlink" title="@Insert：实现插入功能"></a>@Insert：实现插入功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into user(name,sex,age) values(#&#123;name&#125;,#&#123;sex&#125;,#&#123;age&#125;&quot;)</span></span><br><span class="line"><span class="meta">int saveUser(User user);</span></span><br></pre></td></tr></table></figure>
<h2 id="Update：实现更新功能"><a href="#Update：实现更新功能" class="headerlink" title="@Update：实现更新功能"></a>@Update：实现更新功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;update user set name= #&#123;name&#125;,sex = #&#123;sex&#125;,age =#&#123;age&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateUserById</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Delete：实现删除功能"><a href="#Delete：实现删除功能" class="headerlink" title="@Delete：实现删除功能"></a>@Delete：实现删除功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from  user  where id =#&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Param：映射多个参数"><a href="#Param：映射多个参数" class="headerlink" title="@Param：映射多个参数"></a>@Param：映射多个参数</h2><p><code>@Param</code>用于在<code>Mapper</code>接口中映射多个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">saveUser</span><span class="params">(<span class="meta">@Param(value=&quot;user&quot;)</span> User user,<span class="meta">@Param(&quot;name&quot;)</span> String name,<span class="meta">@Param(&quot;age&quot;)</span> Int age)</span>;</span><br></pre></td></tr></table></figure>
<p><code>@Param</code>中的<code>value</code>属性可省略，用于指定参数的别名。</p>
<h1 id="结果集映射"><a href="#结果集映射" class="headerlink" title="结果集映射"></a>结果集映射</h1><p><code>@Result、@Results、@ResultMap</code>是结果集映射的三大注解。</p>
<p>声明结果集映射关系代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&#123;&quot;select id, name, class_id from student&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Results(id=&quot;studentMap&quot;, value=&#123;</span></span><br><span class="line"><span class="meta">  @Result(column=&quot;id&quot;, property=&quot;id&quot;, jdbcType=JdbcType.INTEGER, id=true),</span></span><br><span class="line"><span class="meta">  @Result(column=&quot;name&quot;, property=&quot;name&quot;, jdbcType=JdbcType.VARCHAR),</span></span><br><span class="line"><span class="meta">  @Result(column=&quot;class_id &quot;, property=&quot;classId&quot;, jdbcType=JdbcType.INTEGER)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p><code>@Results</code>各个属性的含义。</p>
<ul>
<li><code>id</code>：表示当前结果集声明的唯一标识；</li>
<li><code>value</code>：表示结果集映射关系；</li>
<li><code>@Result</code>：代表一个字段的映射关系。其中，<code>column</code>指定数据库字段的名称，<code>property</code>指定实体类属性的名称，<code>jdbcType</code>数据库字段类型，<code>id</code>为<code>true</code>表示主键，默认<code>false</code>。</li>
</ul>
<p>可使用<code>@ResultMap</code>来引用映射结果集，其中<code>value</code>可省略。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&#123;&quot;select id, name, class_id from student where id = #&#123;id&#125;&quot;&#125;)</span></span><br><span class="line"><span class="meta">@ResultMap(value=&quot;studentMap&quot;)</span></span><br><span class="line">Student <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<p>这样不需要每次声明结果集映射时都复制冗余代码，简化开发，提高了代码的复用性。</p>
<h1 id="关系映射"><a href="#关系映射" class="headerlink" title="关系映射"></a>关系映射</h1><h2 id="one：用于一对一关系映射"><a href="#one：用于一对一关系映射" class="headerlink" title="@one：用于一对一关系映射"></a>@one：用于一对一关系映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from student&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">  @Result(id=true,property=&quot;id&quot;,column=&quot;id&quot;), </span></span><br><span class="line"><span class="meta">  @Result(property=&quot;name&quot;,column=&quot;name&quot;), </span></span><br><span class="line"><span class="meta">  @Result(property=&quot;age&quot;,column=&quot;age&quot;), </span></span><br><span class="line"><span class="meta">  @Result(property=&quot;address&quot;,column=&quot;address_id&quot;,one=@One(select=&quot;net.biancheng.mapper.AddressMapper.getAddress&quot;)) </span></span><br><span class="line"><span class="meta">&#125;)</span> </span><br><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getAllStudents</span><span class="params">()</span>;</span><br><span class="line">```  </span><br><span class="line">## <span class="meta">@many</span>：用于一对多关系映射</span><br><span class="line">```java</span><br><span class="line"><span class="meta">@Select(&quot;select * from t_class where id=#&#123;id&#125;&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">  @Result(id=true,column=&quot;id&quot;,property=&quot;id&quot;), </span></span><br><span class="line"><span class="meta">  @Result(column=&quot;class_name&quot;,property=&quot;className&quot;), </span></span><br><span class="line"><span class="meta">  @Result(property=&quot;students&quot;, column=&quot;id&quot;, many=@Many(select=&quot;net.biancheng.mapper.StudentMapper.getStudentsByClassId&quot;)) </span></span><br><span class="line"><span class="meta">&#125;)</span> </span><br><span class="line"><span class="keyword">public</span> Class <span class="title function_">getClass</span><span class="params">(<span class="type">int</span> id)</span>; </span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/14/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><a class="extend next" rel="next" href="/page/16/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2017-2023
        <i class="ri-heart-fill heart_icon"></i> WSQ
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="学海无涯"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>